function parseQuery(e){if(e=(e||"").split("?"),e.length<2)return{};for(var t=e[1],n={},r=t.split("&"),o=0;o<r.length;o++){var a=r[o].split("=");n[decodeURIComponent(a[0])]=decodeURIComponent(a[1]||"")}return n}function randNumber(){do var e=parseInt(blocktrailSDK.randomBytes(1).toString("hex").substr(0,1),16);while(e>9);return e}function randDigits(e){for(var t=[],n=0;n<e;n++)t.push(randNumber());return t.join("")}var blocktrail=angular.module("blocktrail.wallet",["ui.router","ui.bootstrap","ui.bootstrap.dropdown","ui.bootstrap.pagination","toggle-switch","infinite-scroll","angularMoment","ja.qr","ngImgCrop",window.Raven&&"ngRaven","angulartics","angulartics.google.analytics","blocktrail.config","blocktrail.core","blocktrail.setup","blocktrail.templates"].filter(function(e){return!!e}));angular.module("blocktrail.wallet").config(function(){Object.keys(blocktrailSDK).forEach(function(e){blocktrailSDK[e].super_==Error&&(blocktrail[e]=blocktrailSDK[e])}),blocktrail.ContactsPermissionError=Error.extend("ContactsPermissionError",400),blocktrail.ContactsError=Error.extend("ContactsError",400),blocktrail.ContactAddressError=Error.extend("ContactAddressError",400),blocktrail.WalletPinError=Error.extend("WalletPinError",400),blocktrail.WalletPollError=Error.extend("WalletPollError",400)}),angular.module("blocktrail.wallet").run(["$rootScope","$state","$log","$interval","$timeout","$locale","$translate","CONFIG","amMoment","blocktrailLocalisation","sdkService",function(e,t,n,r,o,a,i,l,c,s,u){var d=[],p="";e.sdkReadOnlySdkData=u.getReadOnlySdkData(),e.CONFIG=l||{},e.$state=t,e.appVersion=l.VERSION||l.VERSION_REV,e.getBodyClasses=function(){return d.concat([p])},e.changeLanguage=function(e){e=e||s.preferredAvailableLanguage()||l.FALLBACK_LANGUAGE||"en";var t=e;"cn"==t&&(t="zh-cn"),c.changeLocale(t),i.use(e)},e.$watch("sdkReadOnlySdkData.networkType",function(e){var t=l.NETWORKS[e].NETWORK;"t"===t.substr(0,1)&&(t=t.substr(1)),p=e?("network-"+t).toLowerCase():""}),e.$on("$stateChangeError",function(e,r,o,a,i,l){n.error("Error transitioning to "+r.name+" from  "+a.name,r,a,l),t.go("app.error"),e.preventDefault()}),e.$on("$stateChangeStart",function(e,t,r,o,a){n.debug("$stateChangeStart",t.name,Object.keys(r).map(function(e){return e+":"+r[e]})),window.Raven&&Raven.setTagsContext({to_state:t&&t.name})}),e.$on("$stateChangeSuccess",function(e,t,r,o,a){n.debug("$stateChangeSuccess",t.name,Object.keys(r).map(function(e){return e+":"+r[e]}));var i=[];d=[],window.Raven&&Raven.setTagsContext({state:t&&t.name,to_state:null}),t.name.split(".").forEach(function(e){i.push(e),d.push("state-"+i.join("_"))})}),e.$on("$stateChangeError",function(e,t,r,o,a){n.debug("$stateChangeError",t.name,Object.keys(r).map(function(e){return e+":"+r[e]}))})}]),angular.module("blocktrail.wallet").constant("angularMomentConfig",{}).run(["TRANSLATIONS","CONFIG","$filter",function(e,t,n){var r=function(n,r){if(!e[r])throw new Error(r);return e[r][n]||t.FALLBACK_LANGUAGE&&e.english[n]||n},o={en:"english","en-US":"english"};Object.keys(o).forEach(function(e){var t=o[e];moment.locale(e,{calendar:{lastDay:"["+r("YESTERDAY",t).sentenceCase()+"]",sameDay:"["+r("TODAY",t).sentenceCase()+"]",nextDay:"["+r("TOMORROW",t).sentenceCase()+"]",lastWeek:"MMMM D",nextWeek:"MMMM Do YYYY",sameElse:"MMMM Do YYYY"}})}),moment.locale("es",{calendar:{lastDay:"["+r("YESTERDAY","spanish").sentenceCase()+"]",sameDay:"["+r("TODAY","spanish").sentenceCase()+"]",nextDay:"["+r("TOMORROW","spanish").sentenceCase()+"]",lastWeek:"D [de] MMMM",nextWeek:"D [de] MMMM [de] YYYY",sameElse:"D [de] MMMM [de] YYYY"}});var a={ru:"russian",fr:"french",nl:"dutch",de:"german",pt:"portuguese"};Object.keys(a).forEach(function(e){var t=a[e];moment.locale(e,{calendar:{lastDay:"["+r("YESTERDAY",t).sentenceCase()+"]",sameDay:"["+r("TODAY",t).sentenceCase()+"]",nextDay:"["+r("TOMORROW",t).sentenceCase()+"]",lastWeek:"YYYY-MM-DD",nextWeek:"YYYY-MM-DD",sameElse:"YYYY-MM-DD"}})});var i={"zh-cn":"chinese",sw:"swahili",ar:"arabic",hi:"hindi",ko:"korean",jp:"japanese"};Object.keys(i).forEach(function(e){var t=i[e];moment.locale(e,{calendar:{lastDay:"["+r("YESTERDAY",t).sentenceCase()+"]",sameDay:"["+r("TODAY",t).sentenceCase()+"]",nextDay:"["+r("TOMORROW",t).sentenceCase()+"]",lastWeek:"YYYY-MM-DD",nextWeek:"YYYY-MM-DD",sameElse:"YYYY-MM-DD"}})})}]),angular.module("blocktrail.wallet").config(["$compileProvider","$stateProvider","$urlRouterProvider","$logProvider","$analyticsProvider","$sceDelegateProvider","CONFIG",function(e,t,n,r,o,a,i){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|bitcoin):/),r.debugEnabled(i.DEBUG);var l=["self"];i.CDN&&l.push(i.CDN+"**"),o.firstPageview(!1),o.settings.ga.additionalAccountNames=["globalGA"],o.queryKeysBlacklist(["token"]),a.resourceUrlWhitelist(l),t.state("app",{"abstract":!0,templateUrl:"templates/common/base.html"}).state("app.error",{views:{"mainView@app.wallet":{template:"<h1 style='text-align: center; margin-top: 5rem'>Ooops!<br><small>Something went wrong</small></h1>"}}}),n.otherwise("/setup/register")}]),"undefined"!=typeof Promise&&(Promise.prototype.done=function(){return this.then(function(e){return e},function(e){setTimeout(function(){throw e})})}),"undefined"==typeof PouchDB.utils.Promise.prototype.done&&(PouchDB.utils.Promise.prototype.done=function(){return this.then(function(e){return e},function(e){setTimeout(function(){throw e})})}),String.prototype.sentenceCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.capitalize=function(){return this.replace(/\w\S*/g,function(e){return e.sentenceCase()})},Array.prototype.unique=function(){return this.filter(function(e,t,n){return e&&n.indexOf(e)===t})},Array.prototype.any=function(e){var t=null;return this.forEach(function(n,r){!t&&e(n,r)&&(t=n)}),t},Array.prototype.clean=function(){return this.filter(function(e){return e})},Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),Array.prototype.sample||(Array.prototype.sample=function(e){for(var t,n,r=this.slice(0),o=this.length;o--;)n=Math.floor((o+1)*Math.random()),t=r[n],r[n]=r[o],r[o]=t;return r.slice(0,e)}),window.repeat||(window.repeat=function(e,t){for(var n=[],r=0;r<e;r++)n.push(t(r));return n}),angular.module("blocktrail.wallet").factory("AppVersionService",["AppVersionBaseService","$q","$translate","$timeout","$rootScope","$state","settingsService","CONFIG","dialogService","$sce","$filter",function(e,t,n,r,o,a,i,l,c,s,u){var d=e.CHECKS,p=(e.isCheck,[["4.3.0","UPDATE_NOTICE_040300"],["3.4.7","UPDATE_NOTICE_030407"],["3.3.4","UPDATE_NOTICE_030304"]].clean()),f={SETUP:0,LOGGEDIN:d.UPDATED},g=function(t,r,o){var a=e.checkVersion(t,r,o,p);if(a){var i=a[0],l=a.length>1?a[1]:null;i===d.UPDATED&&l&&c.alert({bodyHtml:u("nl2br")(n.instant(l)),title:n.instant("UPDATED_NOTICE")})}};return{CHECKS:f,checkVersion:g}}]).factory("AppVersionBaseService",["$translate","$log","CONFIG",function(e,t,n){var r={DEPRECATED:1,OUTDATED:2,UPDATED:4,UNSUPPORTED:8};r.SETUP=r.DEPRECATED|r.UNSUPPORTED,r.LOGGEDIN=r.DEPRECATED|r.UNSUPPORTED|r.OUTDATED|r.UPDATED;var o=function(e,t){return(e&t)===t},a=function(e,a,i,l){if(t.debug("latestVersion: "+e),t.debug("versionInfo: "+JSON.stringify(a,null,4)),o(i,r.UNSUPPORTED)&&a.unsupported&&semver.lte(n.VERSION,a.unsupported))return[r.UNSUPPORTED];if(o(i,r.DEPRECATED)&&a.deprecated&&semver.lte(n.VERSION,a.deprecated))return[r.DEPRECATED];if(o(i,r.OUTDATED)&&a.latest&&semver.lt(n.VERSION,a.latest))return[r.OUTDATED];if(o(i,r.UPDATED)&&l&&e&&semver.lt(e,n.VERSION)){var c;return l.forEach(function(t){!c&&semver.gt(t[0],e)&&(c=t)}),[r.UPDATED,c&&c[1]]}};return{CHECKS:r,isCheck:o,checkVersion:a}}]),angular.module("blocktrail.wallet").factory("buyBTCService",["CONFIG","$log","$q","$translate","$http","$timeout","_","glideraService","launchService",function(e,t,n,r,o,a,i,l,c){var s=["glidera"],u=[{code:"NL",name:"NETHERLANDS"}],d=[{code:"US-AL",name:"Alabama"},{code:"US-AK",name:"Alaska"},{code:"US-AZ",name:"Arizona"},{code:"US-AR",name:"Arkansas"},{code:"US-CA",name:"California"},{code:"US-CO",name:"Colorado"},{code:"US-CT",name:"Connecticut"},{code:"US-DE",name:"Delaware"},{code:"US-DC",name:"District of Columbia"},{code:"US-FL",name:"Florida"},{code:"US-GA",name:"Georgia"},{code:"US-HI",name:"Hawaii"},{code:"US-ID",name:"Idaho"},{code:"US-IL",name:"Illinois"},{code:"US-IN",name:"Indiana"},{code:"US-IA",name:"Iowa"},{code:"US-KS",name:"Kansas"},{code:"US-KY",name:"Kentucky"},{code:"US-LA",name:"Louisiana"},{code:"US-ME",name:"Maine"},{code:"US-MD",name:"Maryland"},{code:"US-MA",name:"Massachusetts"},{code:"US-MI",name:"Michigan"},{code:"US-MN",name:"Minnesota"},{code:"US-MS",name:"Mississippi"},{code:"US-MO",name:"Missouri"},{code:"US-MT",name:"Montana"},{code:"US-NE",name:"Nebraska"},{code:"US-NV",name:"Nevada"},{code:"US-NH",name:"New Hampshire"},{code:"US-NJ",name:"New Jersey"},{code:"US-NM",name:"New Mexico"},{code:"US-NY",name:"New York"},{code:"US-NC",name:"North Carolina"},{code:"US-ND",name:"North Dakota"},{code:"US-OH",name:"Ohio"},{code:"US-OK",name:"Oklahoma"},{code:"US-OR",name:"Oregon"},{code:"US-PA",name:"Pennsylvania"},{code:"US-RI",name:"Rhode Island"},{code:"US-SC",name:"South Carolina"},{code:"US-SD",name:"South Dakota"},{code:"US-TN",name:"Tennessee"},{code:"US-TX",name:"Texas"},{code:"US-UT",name:"Utah"},{code:"US-VT",name:"Vermont"},{code:"US-VA",name:"Virginia"},{code:"US-WA",name:"Washington"},{code:"US-WV",name:"West Virginia"},{code:"US-WI",name:"Wisconsin"},{code:"US-WY",name:"Wyoming"}],p=[],f=function(){return c.getWalletConfig().then(function(e){return l.setClientId(e.glidera_client_id),e.brokers}).then(function(t){e.DEBUG_OVERLOAD_BROKERS&&Object.keys(e.DEBUG_OVERLOAD_BROKERS).forEach(function(n){t[n]=e.DEBUG_OVERLOAD_BROKERS[n]}),i.each(u,function(e,n){t[e.code]?(u[n].brokers=t[e.code].filter(function(e){return s.indexOf(e)!==-1}),p=p.concat(u[n].brokers).unique()):u[n].brokers=[]}),i.each(d,function(e,n){t[e.code]&&e.code?(d[n].brokers=t[e.code].filter(function(e){return s.indexOf(e)!==-1}),p=p.concat(d[n].brokers).unique()):d[n].brokers=[]})}).then(function(){return p},function(e){console.error("getBrokers"+(e.msg||e.message||""+e));var t=n.defer();return a(function(){t.resolve(f())},3e3),t.promise})},g=null,h=function(){return g||(g=f()),g};h();var _=function(){return h().then(function(){return u})},S=function(){return h().then(function(){return d})},m=function(e){return e?e.match(/^US-..$/)?S().then(function(t){var n=[];return t.filter(function(t){t.code==e&&(n=t.brokers)}),n}):_().then(function(t){var n=[];return t.filter(function(t){t.code==e&&(n=t.brokers)}),n}):n.when([])};return{BROKERS:{glidera:{name:"glidera",displayName:"Glidera",avatarUrl:"/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wgARCABkAGQDAREAAhEBAxEB/8QAHAAAAgMBAQEBAAAAAAAAAAAAAAcEBQYDAggB/8QAGwEBAAEFAQAAAAAAAAAAAAAAAAECAwQFBgf/2gAMAwEAAhADEAAAAfqkAAAAAAAAAAAAAAAABRXbQdUsrCryXF00OgjjZSspo+kq1/X1LjziiHhRtO1q+POwxgfGFeuvK5g4C43Mzc1UaeOVozfTq1/59TCw4Y/pFaF3NnpBn8Ncy3HRruvq2faVB5pQ8OJ2dK08yohYcMb0etD7qzq6KrPy2qr1UNn1uvvfnGcXTX6+AttvNDz8QsOGH6JXQbimwicr5dTW6w2/XbnW6wnB0VmsVmrjQ9DMTEQsOGH6JWk95ap6ocHntzL8rG37mrVdVUHmkofH7eg6CYmIhYcMP0Su02sqi7bvMCaHy2ONloujmfnzVaqKLQxoujmHhIWHDD9ErtdrK/uUREbrVV4jh6afTx+Uut5oehnZdnUvvPaYmHDB9CrtNrIAAc7Tnbjtfn1UDzSD1IkAAAAAAAAAAAAAAAAH/8QAKhAAAQQBAgQFBQEAAAAAAAAABAECAwUABjQQEhQzBxEVFzETFiEkQCD/2gAIAQEAAQUC/q9yAs9yAsj8RBZpFKbGOTdyPV5Eki8y5GZNFgl4uMe2Rtov7wyr1Fh3uGiKRgYpZby5cHqpyEWhmwgKYbB4HEyijNFhtd+LuSBPrv8Abc/GeG5vPbvSCPKevR6cHNRyDhxCrlrvxdyS5Uf7kHZprWJV3aWjuc5PysLEiiw+0nHK9aJz1onKyxmKJtd+LuSu59s0uA01aBPZt5Tk/Cxu548sQZ5jPTCeFHvbXfi7kruaq0oYtnTUdxX2l7ByzZTHI6Pg74X5o97a78XcldxfifxDGHmrL4TVMM0LoJEXyUe7miT7gTCLiadMo0/ctd+LuSu5lvosK3MB0KNXFFgxmMJqp4MVFTgyJ8ii0kkmQDsGZaNXrhmr1BXc/wAuja/OnixEROPkmcqf2f/EAB4RAAICAwADAQAAAAAAAAAAAAABEBECEiAhQEFQ/9oACAEDAQE/Afa3RujeL4uHDnFfZorhzozQcLpzuzHK2PhlliHOqKS5ZUIc5Yu/Ak7HC5Q+NxPabLLhD4eNmlRXFQ/yv//EADERAAEDAgMGBAUFAQAAAAAAAAEAAgQDBRAREhMhMTIzcRQ0QVEVQGGBkRYgIkJTof/aAAgBAgEBPwH5rZlbMrZlV69OM3XUO5Sr5VfuobgnyK1Te9xK1H3VOZIo8jyol9PLIH3THtqN1MOYV1J8Y9RSduzuFceqO2Mmu2gwvdwCmS3zKmt2Ee1SZA1AZD6o2GR6OCkQq8XqNUeO+TUFNiixmxaQptV1849ReuzuFIh7d2rNbQLaBX+Sc20B3OFmt4ePEVR2xc0PGTlHhUYpJpDjhdfOPUXrs7hSXOa/cVswnMACur9cx6G8qjTFKm1g9MJ90kR5DqbOAXxuX7j8L43L9x+FbLlXlV9nU4K6+ceovXZ3Clc61ORJKubdMt6G4qk4PYHD1wuUCTWkuexmYXwyZ/nhY/NfZXXzj1F67O4UrnTXDLeiWkK/UNNUVh64WWcHM8O/iOGLuBR4qx+a+yuvnHqL12dwpXPhs1NiCTSNNyrUXx3mm8b0CQcwo98r0hlUGpfqAf5/9Um8yK40t/iMLED4nP6K6+ceovXZ3Clc+AeQi/NTINKY3J/H3Um0yI/Aah9EQW7jgyjUqnJjc1FsdWpvr7gqEenGbopjJXVp8Y9RWnbs3eoUrn/c6mx/MM14aiP6D8INDeGOQWke3zn/xAAzEAABAwEEBwYFBQAAAAAAAAABAAIDEQQQEiEiMTRBUXFyEzIzgpGhBUBCYYEgI1KS0f/aAAgBAQAGPwL5rZpvZbNN7JrGWSdz3ZACiEsw7Ko7p1qkQwN471pPcfyta0ZHD8rDOPMEHNNQVKouoIdN5+KWkaR8MHcOKxO1bhwurhwji5ZOYVpsoOKDGayhG1SqLqCxYqZLaLP7/wCJuO0QYa50qobJHkxg1XdvIK/xF9CKhOMbaYrpVF1BChpktng902zSQxMZhJJbVS+lzGjcLnsYRhH2WtvotbfRYHkUpwUqi6ghyWyw+q7Sywxxy0pVpUvO5rhvFz3MjJad68E3eVSqLqCHJOmsMTpIpdIhp7pVmndZJcLH557k2Xc4Uu7Bx0h3bzd5VKouoIcrnxSWSdr2GhGSmiYHRSN+l+vmix4oQqhUeBIF4PuqD9tv2u8qlUXUEOVxtL3SRPdrwb0yeC12hkjeSo7vbnLJuNvFqzyu0Wl3JVl0G8N6wsbQKXJRZfUEOX6s2g8wvCZ/VZCl+pavnP/EACcQAQABAgUEAgIDAAAAAAAAAAEAESEQMUFRYZGhsfCB0UBxIOHx/9oACAEBAAE/Ifyvd+0937Ro2XIr1jqHUXqHaPuVLqVs7zFDV1jdeMulUVJ72gs8skYvOZ4men+yPpPLjavj7BVjpuxGAQh+CFLptViN7Y3IM1dTaZChm7s7g8T0W8o2RopSf7UtJCvV010hcU2zYsGFqBW55xRmTMZXUFf6w7g8T0W8HkGxnpfaNCFyVvmOp0aOkFA3hlUCMCKaFK8Me9rhK7aidweJ6LfCE2j1P3CtZFxadYgXWqKg7Q8qA4U5qUFNoifTh5E7g8T0W+EdSxxElI4ja4Ou0YIzD9mBKi1Wptj2UzJ5E7g8T0W+EJEhV2iYSubE+ZdzmUPgphaEhJRNSCCLVsxoWVZeU0+fXBlNGgrzuDxPRb4wKki+UW9yMkGo1v4bZSkGgyMyKr6RlFaBWzhTz3CKD8S8BDd5jKSbmnEzk/RzB/IeW8gbYPhBaAODFbMPxOB0lPy//9oADAMBAAIAAwAAABCSSSSSSSSSSSST8XtMIMtioNtq28pCCxUV5eYCKwjrTxNWIVWSJqwRtEZFWSP6KO5qSSJ6TRSSSSSSSSSSSSSf/8QAHxEBAQADAAMAAwEAAAAAAAAAAQAQETEgIUFAUWFQ/9oACAEDAQE/EPyv5X8rR+W/W2f0t42x+2Oo7dZ1m0u8CbaRINwauo7JvFvenrA++ABjqOziXQ3WDCRtraSt1HZv4wj1PfAK22OrqOzewgw6h9wvnj1dR2cIPWofSTWBYqcdXUdnArcBbGTco8BfYNXUdnz0f4P/xAAoEQEAAQEGBwADAQEAAAAAAAABABEQITFBUaFhcZGxwdHwQIHh8SD/2gAIAQIBAT8Q/K4k4kQxY9oxvyiaXGxfRHf2RYDeLrHKg/dToyoLto8nqHiJgkEI5nYmKf8AQiSlo7tr20Cr6ixbsjILBlSZ3NsYYqjr6i18GpedYSdV2NWZWeLq5s3p2J8zUhG6aFMOfucKOQRCV3+FgysMj39WpSqOTKS1XwcLN6difM1IIGLvLOJKiIiXJp0IKBMIsBtY/ZcUqcLUIrdLi3FJvTsT5mpMPl5ZxoNRYw3Nr1I6DpMF4DtYhpKUbtOcQKq29xKXTvvE3p2J8zUmHy8suyHBWKEuFHmfywM9OoNOZbspiTvvE3p2J8zUmHy8tgkqMza8HRyZTJD6sBJRIAIDNuev8jSuvfNIkoJpj1sUwXCm9OxPmakw+XlsJpFFElBFBgMT2RJeI+RjHKNGysEuBEBuFi/yHaNu82JUHE7ECqv6ECimnl/6wZ5gYKqdN6hVCBwtXaoSjklB/L//xAAnEAEAAgECBgICAwEAAAAAAAABABExIVEQQWGhsfBx8cHRIECRgf/aAAgBAQABPxD+19hL7CQYEjosAQLgBBI25fiGsuoD9AiRqzcn+QdYbuKA6NzIf4wBpdKKT5/SEE612JBsIxD0RhLG90RitTiBldGo8lBuaHT5jOwtXfYmZq0mF1HQzLP0QPxNhUNR/wCkfijXkPNekupdV8tlnptk9BshLOhVbCv54JDIo0Ha+F51Ah8poB2RfAiPRHsayjxMcB1PQ7EmvQRLaGzY4em2T0GyLhgaQ1tn1kxgF1TQqrRlIoFh9AASkMoIZQVDocEmDQa6hzPoE+gTBtTcsrnPTbJ6DZOw+WLgE0R0pYCAuVZKVtAYrR/CDOuwY1AnU6nBxuWFHRuxIogW6/tEpRyTJ64nptk9BsnYfLBZakjUxKaLqfLKus1Qu4eoxB2sdsXbxwKVfsvvHHunidwzJ64nptk9BsnYfLGUkKBq3aA9gtUUkE0Ab0OVhsHRi9WU3hOSbkWA6xKRgEwofumZ30dPiN8ZSZj5fiZgza5BoYnptk9BsnYfLwLTwSmKsJrVSkddVDmGawkDKLo6/cdIvA8FbXXIjM45NPAU9clYEnMtZ+CHSGXKbrzieE6wtkOyYaytkZoF0+X+SX+WeRLUhuD+J08oQcVbSeaICiGnREOQf7f/2Q=="}},brokers:h,regions:_,usStates:S,regionBrokers:m}}]),angular.module("blocktrail.wallet").factory("Contacts",["$log","$rootScope","cryptoJS","settingsService","launchService","sdkService","storageService",function(e,t,n,r,o,a,i){var l=function(){var e=this;e.contactsCache=i.db("contacts"),e._list=null};return l.prototype.list=function(e){var t=this;return t._list&&!e||(t._list=t._sync()),t._list},l.prototype._sync=function(t){var r=this;return r.contactsCache.get("synced").then(function(t){return e.debug("Contacts.sync: previous sync"),t},function(){return e.debug("Contacts.sync: no previous sync"),{_id:"synced",lastSynced:0,contacts:[]}}).then(function(i){var l=i.lastSynced;return i.lastSynced=Math.floor((new Date).getTime()/1e3),o.getAccountInfo().then(function(o){return a.getSdkByActiveNetwork().contacts(t?null:l).then(function(t){var a={};return i.contacts.forEach(function(e){a[e.hash]=e}),t.forEach(function(t){var r=null;if(t.encrypted_display_name&&o.secret)try{if(r=n.AES.decrypt(t.encrypted_display_name,o.secret).toString(n.enc.Utf8),!r)throw new Error("Failed to decrypt encrypted_display_name")}catch(l){e.error(l)}if(a[t.hash])a[t.hash].displayName=r,a[t.hash].category=t.category,a[t.hash].avatarUrl=t.avatar_url;else{var c={hash:t.hash,displayName:r,category:t.category,avatarUrl:t.avatar_url};i.contacts.push(c),a[c.hash]=c}}),r.contactsCache.put(i).then(function(){return e.debug("Contacts.sync: synced ["+t.length+"]"),{contacts:i.contacts,contactsByHash:a}})})})})},l.prototype.findByHash=function(e){var t=this;return t.list().then(function(t){return t.contactsByHash[e]})},l.prototype.getSendingAddress=function(t,n){var r=this;return n=n?n:0,a.getSdkByActiveNetwork().then(function(o){return o.requestContactAddress(t.hashes[n]).then(function(e){return e},function(o){if(t.hashes.length>n+1)return n++,r.getSendingAddress(t,n);throw e.error(o),o})})},new l}]),angular.module("blocktrail.wallet").service("Currencies",["$rootScope","storageService","$log","sdkService","CONFIG",function(e,t,n,r,o){var a=this;a.cache=t.db("currency-rates-cache"),a.mainCurrencies=["EUR","USD","CNY"];var i={BTC:{code:"BTC",ticker:"BTC",symbol:"฿",isFiat:!1},BCC:{code:"BCC",ticker:"BCC",symbol:"฿",isFiat:!1},tBTC:{code:"tBTC",ticker:"tBTC",symbol:"t฿",isFiat:!1},tBCC:{code:"tBCC",ticker:"tBCC",symbol:"t฿",isFiat:!1},GBP:{code:"GBP",symbol:"£"},EUR:{code:"EUR",symbol:"€"},USD:{code:"USD",symbol:"$"},CAD:{code:"CAD",symbol:"$"},CNY:{code:"CNY",symbol:"¥"},PAB:{code:"PAB",symbol:"B/"},ARS:{code:"ARS",symbol:"$"},BOB:{code:"BOB",symbol:"$b"},CLP:{code:"CLP",symbol:"$"},PEN:{code:"PEN",symbol:"S/"},PYG:{code:"PYG",symbol:"Gs"},UYU:{code:"UYU",symbol:"$U"},VEF:{code:"VEF",symbol:"Bs"},CRC:{code:"CRC",symbol:"₡"},MXN:{code:"MXN",symbol:"$"},NGN:{code:"NGN",symbol:"₦"},INR:{code:"INR",symbol:"₹"},RUB:{code:"RUB",symbol:"₽"},AUD:{code:"AUD",symbol:"$"},BRL:{code:"BRL",symbol:"R$"},ZAR:{code:"ZAR",symbol:"R"},ILS:{code:"ILS",symbol:"₪"},SAR:{code:"SAR",symbol:"﷼"},JPY:{code:"JPY",symbol:"¥"},KRW:{code:"KRW",symbol:"₩"},COP:{code:"COP",symbol:"$"},GHS:{code:"GHS",symbol:"GH¢"},PLN:{code:"PLN",symbol:"zł"},PHP:{code:"PHP",symbol:"₱"}};a.currencies={},a.getCurrencies=function(){var e=this;return Object.keys(e.currencies).map(function(t){return e.currencies[t]})},a.getFiatCurrencies=function(){var e=this;return e.getCurrencies().filter(function(e){return!!e.isFiat})},a.price=function(e){var t=this;return"undefined"==typeof t.currencies[e]?0:t.currencies[e].price||0},a.prices=function(){var e={};return Object.keys(a.currencies).forEach(function(t){e[t]=a.currencies[t].price}),e};var l=null;a.updatePrices=function(e){var t=this,o=!e;return l?l.forceFetch!==o?l.then(function(){return t.updatePrices(e)}):l:(l=t.cache.get("price").then(function(e){return e},function(){return o=!0,{_id:"price"}}).then(function(e){return o?r.getSdkByActiveNetwork().price().then(function(n){return angular.extend(e,n),t.cache.put(e).then(function(){return e})}):e}).then(function(e){return Object.keys(t.currencies).forEach(function(n){t.currencies[n].price=parseFloat(e[n]||0)}),e},function(e){throw n.error("prices ERR "+e),e}).then(function(e){return l=null,e}),l.forceFetch=o,l)},a.enableCurrency=function(t){var n=this;if("undefined"==typeof i[t])return!1;var r="undefined"==typeof n.currencies[t];n.currencies[t]=i[t],n.currencies[t].isFiat="undefined"==typeof n.currencies[t].isFiat||n.currencies[t].isFiat,n.currencies[t].btcRate=0,r&&e.$broadcast("enabled_currency",t);var o={};return n.mainCurrencies.forEach(function(e){n.currencies[e]&&(o[e]=n.currencies[e])}),Object.keys(n.currencies).sort().forEach(function(e){n.mainCurrencies.indexOf(e)===-1&&(o[e]=n.currencies[e])}),n.currencies=o,!0},o.CURRENCIES.forEach(function(e){a.enableCurrency(e)})}]).service("CurrencyConverter",["$rootScope","Currencies",function(e,t){var n=this,r=1e8,o=8;n.fromBTC=function(e,n,r){return"undefined"==typeof r&&(r=2),t.price(n)?(parseFloat(e)*t.price(n)).toFixed(r):(0).toFixed(r)},n.toBTC=function(e,n,r){return"undefined"==typeof r&&(r=8),t.price(n)?(parseFloat(e)/t.price(n)).toFixed(r):(0).toFixed(r)},n.fromSatoshi=function(e,n,a){var i=parseFloat((e/r).toFixed(o));return"undefined"==typeof a&&(a=2),t.price(n)?(i*t.price(n)).toFixed(a):(0).toFixed(a)},n.toSatoshi=function(e,t){var a;return a="BTC"===t?parseFloat(e):n.toBTC(e,t,o),parseFloat((a*r).toFixed(0))}}]).filter("currencySymbol",["Currencies",function(e){return function(t){return e.currencies[t].symbol}}]),angular.module("blocktrail.wallet").service("FormHelper",function(){this.setAllDirty=function(e){e.$setDirty(),angular.forEach(e.$error,function(e,t){angular.forEach(e,function(e,t){e.$dirty=!0,e.$touched=!0,e.$pristine=!1})})},this.setAllPristine=function(e){e.$setPristine(),angular.forEach(e.$error.required,function(e,t){e.$setPristine()})},this.setValidityOnce=function(e,t,n){"undefined"==typeof e.$validators[t]&&(e.$validators[t]=function(){return!0}),e.$setValidity(t,n||!1),e.$setDirty()}}),angular.module("blocktrail.wallet").factory("glideraService",["CONFIG","$log","$q","walletsManagerService","dialogService","$state","$rootScope","$translate","$http","_","$timeout","$interval","settingsService","launchService","sdkService","trackingService",function(e,t,n,r,o,a,i,l,c,s,u,d,p,f,g,h){var _,S=p.getReadOnlySettingsData(),m=e.WALLET_URL+"/#/wallet/buy/glidera/oaoth2/callback",y=null,w=18e5,E={INVALID_ACCESS_TOKEN:2001,ACCESS_TOKEN_REVOKED:2002},v=function(e){return e.replace("#","%23")},b=function(e){t.debug("setDecryptedAccessToken"),y=e,u(function(){y=null},w)},A=function(t,n,r){t=t||{};var o={};return n&&(o.Authorization="Bearer "+n),r&&(o["X-2FA-CODE"]=r),t=s.defaults({},t||{},{https:!0,host:e.GLIDERA_URL.replace(/https?:\/\//,""),endpoint:"/api/v1",params:{platform:"web"},headers:s.defaults({},t.headers||{},o),contentMd5:!1}),new blocktrailSDK.Request(t)},T=function(){var n=Math.ceil((new Date).getTime()/1e3),r=["transact","transaction_history"].join(" "),o=["response_type=code","client_id="+_,"state="+n,"scope="+r,"required_scope="+r,"login_hint="+(S.email||"").replace(/\+.*@/,"@"),"redirect_uri="+m],a=e.GLIDERA_URL+"/oauth2/auth?"+o.join("&");t.debug("oauth2",a),window.open(v(a),"_self")},k=function(){return P().then(function(n){var r=["redirect_uri="+m,"access_token="+n],o=e.GLIDERA_URL+"/user/setup?"+r.join("&");t.debug("setup",o),window.open(v(o),"_self")})},I=function(e){if(!e)return n.reject(new Error("no glideraCallback"));var a;return n.when(e).then(function(e){var n=parseQuery(e);if(t.debug("qs? ",JSON.stringify(n,null,4)),!n.code)throw new Error(n.error_message.replace("+"," "));a=o.spinner({title:"WORKING"});var i=r.getActiveWallet(),c=i.getSdkWallet().sdk;return c.glideraOauth(n.code,m).then(function(e){t.debug("oauthtoken",JSON.stringify(e,null,4)),h.trackEvent(h.EVENTS.BUYBTC.GLIDERA_SETUP_DONE);var n=e.access_token,r={scope:e.scope};return o.prompt({body:l.instant("MSG_BUYBTC_PASSWORD_TO_ENCRYPT"),title:l.instant("ENTER_CURRENT_PASSWORD"),input_type:"password",icon:"key"}).result.then(function(e){return i.unlockWithPassword(e)}).then(function(e){var t=e.secret;"v2"===e.walletVersion&&(t=new blocktrailSDK.Buffer(t,"hex"));var o=new blocktrailSDK.Buffer(n,"utf8");r.encryptedAccessToken=blocktrailSDK.Encryption.encrypt(o,t,blocktrailSDK.KeyDerivation.subkeyIterations).toString("base64"),e.lock()}).then(function(){b(n);var e={glideraAccessToken:r};return p.updateSettingsUp(e).then(M.bind(this))})})}).then(function(e){return a.close(),e},function(e){throw a&&a.close(),t.log(e),e})},C=function(e){if(e.code===E.ACCESS_TOKEN_REVOKED||e.code===E.INVALID_ACCESS_TOKEN){b(null);var t={glideraAccessToken:null};return p.updateSettingsUp(t).then(function(){a.go("app.wallet.buybtc.choose")}),!0}return!1},R=function(){return n.when().then(function(){return!!S.glideraAccessToken&&(S.glideraAccessToken.userCanTransact===!0?S.glideraAccessToken.userCanTransact:P().then(function(e){if(!e)return!1;var r=A(null,e);return r.request("GET","/user/status ",{},null).then(function(e){t.debug("status",JSON.stringify(e,null,4)),S.glideraAccessToken.userCanTransact=e.userCanTransact,S.glideraAccessToken.userCanTransactInfo=s.defaults({},e.userCanTransactInfo);var n={glideraAccessToken:S.glideraAccessToken};return p.updateSettingsUp(n).then(function(){return e.userCanTransact})},function(e){if(C(e))return n.reject("dismiss");throw e})}))}).then(function(e){return e},function(e){throw t.log(e),e})},D=function(){return O().then(function(e){return"NONE"===e?void 0:o.prompt({body:l.instant("MSG_BUYBTC_GLIDERA_2FA_BODY",{mode:e}),title:l.instant("MSG_BUYBTC_GLIDERA_2FA_TITLE")}).result})},O=function(){return n.when().then(function(){return!!S.glideraAccessToken&&P().then(function(e){if(!e)return!1;var n=A(null,e);return n.request("GET","/authentication/get2faCode",{},null).then(function(e){return t.debug("get2faCode",JSON.stringify(e,null,4)),e.mode})})}).then(function(e){return e},function(e){throw t.log(e),e})},N=function(e){return n.when().then(function(){return t.debug("glideraAccessToken",JSON.stringify(S.glideraAccessToken,null,4)),S.glideraAccessToken?S.glideraAccessToken.encryptedAccessToken:null}).then(function(t){if(t){var n=blocktrailSDK.Encryption.decrypt(new blocktrailSDK.Buffer(t,"base64"),e).toString("utf8");return b(n),n}})},L=null,P=function(){var e=r.getActiveWallet();return n.when().then(function(){if(y)return t.debug("decryptedAccessToken"),y;if(L)return t.debug("accessTokenPromise"),L;if(!S.glideraAccessToken)return null;var r=n.defer();return L=r.promise,u(function(){var n=function(){return o.prompt({body:l.instant("MSG_BUYBTC_PASSWORD_TO_DECRYPT"),title:l.instant("ENTER_CURRENT_PASSWORD"),input_type:"password",icon:"key"}).result.then(function(t){return e.unlockWithPassword(t)["catch"](function(e){return n()})})};return n().then(function(e){var t=e.secret;return"v2"===e.walletVersion&&(t=new blocktrailSDK.Buffer(t,"hex")),e.lock(),N(t)}).then(function(e){t.debug("DONE"),L=null,r.resolve(e)},function(e){t.debug("DONE ERR"),L=null,t.debug(e),r.reject(e)})},100),L})},B=function(e,t){var n=r.getActiveWallet(),o=n.getSdkWallet().sdk;return o.glideraBuyPrices(e,t).then(function(e){return console.log("buyPrices "+JSON.stringify(e)),e})},U=function(e,t){return P().then(function(r){var o=A(null,r,null);return o.request("POST","/prices/buy",{},e&&{qty:e}||{fiat:t}).then(function(e){return console.log("buyPricesUuid "+JSON.stringify(e)),e},function(e){if(C(e))return n.reject("dismiss");throw e})})},W=function(e,n){var o=r.getActiveWallet();return R().then(function(r){if(!r)throw new Error("User can't transact!");return P().then(function(r){return o.getNewAddress().then(function(a){return D().then(function(i){var l=A(null,r,i);return l.request("POST","/buy",{},{destinationAddress:a,qty:e,priceUuid:n,useCurrentPrice:!1}).then(function(e){t.debug("buy",JSON.stringify(e,null,4));var n={address:a,time:Math.floor((new Date).getTime()/1e3),transactionUuid:e.transactionUuid,transactionHash:e.transactionHash||null,status:e.status,qty:e.qty,price:e.price,total:e.total,currency:e.currency,walletIdentifier:o._sdkWallet.identifier};return p.addGlideraTransaction(n).then(function(){return $(),e})})})})})})},G=function(e){_=e},F=!0,$=function(){var e=function(){F=!1;var r=1e4;return n.when(y).then(function(e){if(e){var t={};return n.all(S.glideraTransactions.map(function(r){if("PROCESSING"!==r.status&&r.transactionHash)return n.when(null);F=!0;var o=A(null,e);return o.request("GET","/transaction/"+r.transactionUuid,{}).then(function(e){t[r.transactionUuid]=e})})).then(function(){var e=S.glideraTransactions.map(function(e){if("undefined"!=typeof t[e.transactionUuid]){var n=t[e.transactionUuid],o=e.status;"COMPLETE"!==n.status||n.transactionHash?(e.qty=n.qty,e.status=n.status,e.transactionHash=n.transactionHash,"PROCESSING"===o&&"COMPLETE"===e.status&&i.$broadcast("glidera_complete",e)):r=0}return e});return p.updateGlideraTransactions(e)})}}).then(function(){},function(e){t.error("updatePendingTransactions "+e)}).then(function(){return r?void(F&&u($,r)):e()})};e()},M=function(e){return P().then(function(e){if(e){var t=[],n=A(null,e);return n.request("GET","/transaction",{}).then(function(e){e.transactions.forEach(function(e){t.push(e)})}).then(function(){var e={};S.glideraTransactions.forEach(function(t){e[t.transactionUuid]=t});var n=t.map(function(t){var n=e[t.transactionUuid]||{};return{address:n.address||null,time:n.time||null,transactionUuid:t.transactionUuid,transactionHash:t.transactionHash||n.transactionHash||null,qty:t.qty,status:t.status,price:t.price,total:t.total,currency:t.currency,walletIdentifier:null}});return p.updateGlideraTransactions(n)})}return!1}).then(function(e){return e},function(e){t.error("updateAllTransactions "+e)}).then(function(t){e&&(t?u($,1e4):u(M,1e4))})},q=!1,H=function(){q||e.NETWORKS[r.getActiveWallet().getReadOnlyWalletData().networkType].BUYBTC&&(q=!0,n.when(f.getWalletSecret()).then(function(e){if(e){var t=new blocktrailSDK.Buffer(e,"hex");return N(t)}}).then(function(){return $()},function(e){t.debug("initDecryptAccessToken2 ERR "+e)}))};return{init:H,setClientId:G,createRequest:A,oauth2:T,setup:k,decryptAccessToken:N,twoFactor:D,handleOauthCallback:I,accessToken:P,userCanTransact:R,buyPrices:B,buyPricesUuid:U,buy:W}}]),angular.module("blocktrail.wallet").factory("launchService",["storageService","$q","$log","$http","CONFIG","sdkService",function(e,t,n,r,o,a){var i=function(){var t=this;t.storage=e.db("launch"),t._accountInfo=null,t._walletInfo=null,t._backupInfo=null,t._walletConfig=null};i.prototype.getWalletConfig=function(){var e=this;return(!e._walletConfig||e._walletConfig.ts>(new Date).getTime()+6e5)&&(e._walletConfig=e.getAccountInfo(!0)["catch"](function(){return{}}).then(function(e){var t=o.API_URL+"/v1/"+o.API_NETWORK+"/mywallet/config?",n=["v="+(o.VERSION||""),"platform=web"];return e&&e.api_key&&n.push("api_key="+e.api_key),r.get(t+n.join("&")).then(function(e){return e.data})}),e._walletConfig.ts=(new Date).getTime()),e._walletConfig},i.prototype.handleSetupState=function(e,t){var r=this;return r.determineSetupState().then(function(r){var o=!!r.allowed.any(function(t){return 0===e.indexOf(t)});return n.debug("handleSetupState "+[e,o].join(";")),!!o||void t.go(r._default)})},i.prototype.determineSetupState=function(){var e=this;return e.getAccountInfo(!0).then(function(t){return a.setAccountInfo(t),e.getWalletInfo(!0).then(function(t){return e.getBackupInfo(!0).then(function(e){return{allowed:["app.setup.walletBackup"],_default:"app.setup.walletBackup"}},function(){return{allowed:["app.wallet"],_default:"app.wallet.summary"}})},function(){return{allowed:["app.setup.wallet","app.setup.login","app.setup.register","app.setup.loggedout","app.setup.forgotPassword","app.setup.changePassword"],_default:"app.setup.login"}})})["catch"](function(){return{allowed:["app.setup.login","app.setup.register","app.setup.loggedout"],_default:"app.setup.login"}})},i.prototype.getAccountInfo=function(e){var n=this;return e&&n._accountInfo||(n._accountInfo=t.when(n.storage.get("account_info")).then(function(e){return e},function(){n._accountInfo=null})),n._accountInfo},i.prototype.storeAccountInfo=function(e){var n=this;return n._accountInfo=null,t.when(n.storage.get("account_info")).then(function(e){return e},function(){return{_id:"account_info"}}).then(function(t){return t.username=e.username,t.email=e.email,t.api_key=e.api_key,t.api_secret=e.api_secret,t.testnet=e.testnet,t.secret=e.secret,t.requires2FA="undefined"!=typeof e.requires_2fa?e.requires_2fa:e.requires2FA,n.storage.put(t).then(function(){return t})})},i.prototype.updateAccountInfo=function(e){
var t=this;return t.getAccountInfo().then(function(n){return Object.keys(e).forEach(function(t){n[t]=e[t]}),t.storeAccountInfo(n)})},i.prototype.clearAccountInfo=function(){var e=this;return e._accountInfo=null,t.when(e.storage.get("account_info")).then(function(t){return e.storage.remove(t)},function(){return!0})},i.prototype.getWalletInfo=function(e){var n=this;return e&&n._walletInfo||(n._walletInfo=t.when(n.storage.get("wallet_info")).then(function(e){return e})),n._walletInfo},i.prototype.storeWalletInfo=function(e,n){var r=this;return r._walletInfo=null,t.when(r.storage.get("wallet_info")).then(function(e){return e},function(){return{_id:"wallet_info"}}).then(function(t){return t.identifier=e,t.networkType=n,r.storage.put(t).then(function(){return!0})})};var l=null;return i.prototype.stashWalletSecret=function(e){l=e},i.prototype.getWalletSecret=function(){var e=l;return l=null,e},i.prototype.clearWalletInfo=function(){var e=this;return e._walletInfo=null,t.when(e.storage.get("wallet_info")).then(function(t){return e.storage.remove(t)},function(){return!0})},i.prototype.getBackupInfo=function(e){var n=this;return e&&n._backupInfo||(n._backupInfo=t.when(n.storage.get("wallet_backup")).then(function(e){return e})),n._backupInfo},i.prototype.storeBackupInfo=function(e){var n=this;return n._backupInfo=null,t.when(n.storage.get("wallet_backup")).then(function(e){return e},function(){return{_id:"wallet_backup"}}).then(function(t){return t.identifier=e.identifier,t.walletVersion=e.walletVersion||null,t.encryptedPassword=e.encryptedPassword||null,t.encryptedPrimarySeed=e.encryptedPrimarySeed,t.backupSeed=e.backupSeed,t.encryptedSecret=e.encryptedSecret,t.recoveryEncryptedSecret=e.recoveryEncryptedSecret,t.blocktrailPublicKeys=e.blocktrailPublicKeys,t.supportSecret=e.supportSecret,n.storage.put(t).then(function(){return t})})},i.prototype.clearBackupInfo=function(){var e=this;return e._backupInfo=null,t.when(e.storage.get("wallet_backup")).then(function(t){return e.storage.remove(t)},function(){return!0})},new i}]),angular.module("blocktrail.wallet").service("QRMock",["$log","$q","$interval",function(e,t,n){var r=this;this.canvasElm=null,this.videoElm=null,this.videoStream=null,this.interval=null,this.scan=function(t,o){e.log("start scanning"),this._webcamToCanvas().then(function(){r.interval=n(function(){r.canvasElm[0].getContext("2d").drawImage(r.videoElm[0],0,0,600,480),r.decode().then(function(e){r.stop(),t(e)},function(e){})},500)},o)},this.decode=function(n){var r=t.defer();qrcode.callback=function(t){e.debug("decoded QR image",t),r.resolve(t)};try{"undefined"!=typeof n?qrcode.decode(n):qrcode.decode()}catch(o){e.debug(o),r.reject(o)}return r.promise},this._webcamToCanvas=function(){var n=t.defer();return window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({video:!0},function(e){r.videoStream=e,r.videoElm[0].src=window.URL&&window.URL.createObjectURL(e)||e,r.videoElm[0].play(),n.resolve(e)},function(t){e.error(t),n.reject(t)}),n.promise},this.stop=function(){this.interval&&n.cancel(this.interval),this.videoStream&&this.videoStream.stop()},this.init=function(e){this.canvasElm=angular.element(e);var t=600,n=480;r.videoElm=angular.element('<video style="background:#666; margin-top: 160px" width="'+t+'px" height="'+n+'px"></video>'),r.canvasElm.after(r.videoElm),r.canvasElm.attr("id","qr-canvas").attr({width:t,height:n}),r.canvasElm.css("display","none")}}]).service("QR",["$log","$rootScope",function(e,t){var n="undefined"!=typeof cloudSky&&!!cloudSky.zBar;e.debug("qrScanner enabled? "+n),this.scan=function(r,o){if(n){e.log("start scanning");var a={text_title:"Scan QR Code",text_instructions:"",camera:"back",flash:"auto",drawSight:!0};cloudSky.zBar.scan(a,function(e){t.$evalAsync(function(){r(e)})},function(e){t.$evalAsync(function(){r(e)})})}}}]),angular.module("blocktrail.wallet").factory("setupService",["storageService","$q",function(e,t){var n="user-info",r=function(){var t=this;t.storage=e.db("setup")};return r.prototype.setUserInfo=function(e){var r=this;return t.when(r.storage.get(n)).then(function(e){return e},function(){return{_id:n}}).then(function(t){return angular.forEach(e,function(n,r){t[r]=e[r]}),r.storage.put(t).then(function(){return!0})})},r.prototype.getUserInfo=function(){var e=this;return t.when(e.storage.get(n)).then(function(e){return e},function(){return{_id:n}})},r.prototype.clearUserInfo=function(){var e=this;return t.when(e.storage.get(n)).then(function(t){return e.storage.remove(t)},function(){return!0})},new r}]),angular.module("blocktrail.wallet").factory("storageService",["CONFIG","$log","PouchDB",function(e,t,n){var r={},o=e.POUCHDB_DRIVER;t.debug("window.supportsIndexedDB: "+window.supportsIndexedDB),window.supportsIndexedDB===!1&&(o="memory");var a=function(e){return r[e]||(r[e]=new n(e,{adapter:o})),r[e]},i=function(e){return a(e).destroy().then(function(t){delete r[e]})},l=function(){return Q.all(Object.keys(r).map(function(e){var t=a(e).adapter;return a(e).destroy().then(function(){return"idb"===t&&indexedDB.deleteDatabase("_pouch_"+e),a(e)})})).then(function(e){return!0},function(e){console.error(e)})};return a("launch"),a("contacts"),a("wallet"),a("wallet_info"),a("settings"),a("LOCK"),{db:a,destroy:i,resetAll:l}}]),angular.module("blocktrail.wallet").factory("trackingService",["CONFIG","$q","$analytics",function(e,t,n){var r={ACTIVATED:"activated",SIGN_UP:"sign_up",LOGIN:"login",RECEIVE_CUSTOM_AMOUNT:"receive_custom_amount",BUYBTC:{REGION_OK:"region_ok",REGION_NOTOK:"region_notok",GLIDERA_SETUP_INIT:"glidera_setup_init",GLIDERA_SETUP_UPDATE:"glidera_setup_update",GLIDERA_SETUP_DONE:"glidera_setup_done",GLIDERA_OPEN:"glidera_open",GLIDERA_BUY:"glidera_buy",GLIDERA_BUY_CONFIRM:"glidera_buy_confirm",GLIDERA_BUY_ERR:"glidera_buy_error",GLIDERA_BUY_DONE:"glidera_buy_done"},SWEEP:{SWEEP_START:"sweep_start",SWEEP_NO_BALANCE:"sweep_no_balance",SWEEP_BALANCE:"sweep_balance",SWEEP_SUCCESS:"sweep_success",SWEEP_FAIL:"sweep_fail"}},o={};Object.keys(r.BUYBTC).forEach(function(e){var t=r.BUYBTC[e];o[t]={category:"BuyBTC"}});var a=function(){var e=t.defer();return new Fingerprint2({excludeFlashFonts:!0}).get(function(t,n){t||e.reject(),e.resolve({hash:t,components:n})}),e.promise},i=function(t){if(n.eventTrack(t,o[t]||{category:"Events"}),t===r.LOGIN)window.fbq?fbq("track","Other"):console.error("`fbq` doesn't exist!");else if(t===r.ACTIVATED)window.fbq?fbq("track","Lead"):console.error("`fbq` doesn't exist!");else if(t===r.SIGN_UP&&(e.FBTRACKING_ID&&(window.fbq?fbq("track","CompleteRegistration"):console.error("`fbq` doesn't exist!")),e.GOOGLEADWORDS_ID&&e.GOOGLEADWORDS_LABEL)){var a=new Image(1,1);a.src="https://www.googleadservices.com/pagead/conversion/"+e.GOOGLEADWORDS_ID+"/?label="+e.GOOGLEADWORDS_LABEL+"&amp;guid=ON&amp;script=0",document.body.appendChild(a)}};return{EVENTS:r,trackEvent:i,getBrowserFingerprint:a}}]),function(){"use strict";angular.module("blocktrail.core",["pascalprecht.translate","blocktrail.translations","blocktrail.config"])}(),function(){"use strict";angular.module("blocktrail.setup",["ui.router"])}(),function(){"use strict";function e(e,t,n,r){function o(e){var t={};return angular.forEach(e,function(e,n){Array.isArray(e)?t[n]=e.join("\n"):t[n]=e}),t}e.translations("en-US",o(angular.extend({},t.english,t.americanEnglish))),e.translations("en",o(t.english)),e.translations("fr",o(t.french)),e.translations("nl",o(t.dutch)),e.translations("ru",o(t.russian)),e.translations("cn",o(t.chinese)),e.translations("es",o(t.spanish)),e.translations("sw",o(t.swahili)),e.translations("ar",o(t.arabic)),e.translations("hi",o(t.hindi)),e.translations("ko",o(t.korean)),e.translations("de",o(t.german)),e.translations("jp",o(t.japanese)),e.translations("pt",o(t.portuguese)),n.FALLBACK_LANGUAGE&&e.fallbackLanguage(n.FALLBACK_LANGUAGE),e.useSanitizeValueStrategy(["escapeParameters"]),r.registerLanguages(),r.setupPreferredLanguage()}e.$inject=["$translateProvider","TRANSLATIONS","CONFIG","blocktrailLocalisationProvider"],angular.module("blocktrail.core").config(e)}(),function(){"use strict";angular.module("blocktrail.core").constant("blocktrailSDK",window.blocktrailSDK).constant("bip39EN",window.blocktrailSDK.bip39wordlist).constant("_",window.blocktrailSDK.lodash).constant("cryptoJS",window.blocktrailSDK.CryptoJS).constant("bitcoinJS",window.blocktrailSDK.bitcoin).constant("BlocktrailBitcoinService",window.blocktrailSDK.BlocktrailBitcoinService).constant("bip39",window.blocktrailSDK.bip39).constant("randomBytesJS",window.blocktrailSDK.randomBytes).constant("bowserJS",window.bowser).constant("PouchDB",window.PouchDB).constant("powtcha",window.powtcha).constant("navigator",window.navigator).constant("zxcvbn",window.zxcvbn)}(),function(){"use strict";function e(e,t,n,r){e.message=n,e.dismiss=function(){t.dismiss("dismiss")},e.close=function(){t.close()},e.$on("dialog:"+r,function(t,n){e.message=n})}e.$inject=["$scope","$modalInstance","message","dialogId"],angular.module("blocktrail.core").controller("DialogAlertModalCtrl",e)}(),function(){"use strict";function e(e,t,n,r){e.message=n,e.form={prompt:n.prefill||""},e.dismiss=function(){t.dismiss("dismiss")},e.submit=function(){t.close(e.form.prompt)},e.$on("dialog:"+r,function(t,n){e.message=n})}e.$inject=["$scope","$modalInstance","message","dialogId"],angular.module("blocktrail.core").controller("DialogPromptModalCtrl",e)}(),function(){"use strict";function e(e,t,n,r){e.message=n,e.dismiss=function(){t.dismiss("dismiss")},e.$on("dialog:"+r,function(t,n){e.message=n})}e.$inject=["$scope","$modalInstance","message","dialogId"],angular.module("blocktrail.core").controller("DialogSpinnerModalCtrl",e)}(),function(){"use strict";function e(e,t){return{restrict:"E",transclude:!0,scope:{title:"="},templateUrl:"js/modules/core/directives/app-wrapper/app-wrapper.tpl.html",link:function(n){n.CONFIG=e,n.$state=t}}}e.$inject=["CONFIG","$state"],angular.module("blocktrail.core").directive("appWrapper",e)}(),function(){"use strict";function e(){return{restrict:"EA",replace:!0,transclude:!0,scope:{btnFileDataName:"=",btnFileDataUpdate:"&"},templateUrl:"js/modules/core/directives/btn-file-data/btn-file-data.tpl.html",link:function(e,t){function n(t){var n=t.currentTarget.files[0],o=new FileReader;o.onload=function(t){r.val(null),e.btnFileDataUpdate({name:e.btnFileDataName,data:t.target.result})},o.readAsDataURL(n)}var r=t.find("input");r.on("change",n),e.triggerClickOnInputFile=function(){r[0].click()}}}}angular.module("blocktrail.core").directive("btnFileData",e)}(),function(){"use strict";function e(){return{link:function(e,t,n){n.capsOnBlurNull&&t.on("blur",function(){e[n.capsOn]=null}),t.on("keypress",function(r){if(t.val()){var o=String.fromCharCode(r.keyCode||r.which);o.toUpperCase()!==o.toLowerCase()&&(r.shiftKey&&o.toLowerCase()===o||!r.shiftKey&&o.toUpperCase()===o?e[n.capsOn]=!0:e[n.capsOn]=!1)}})}}}angular.module("blocktrail.core").directive("capsOn",e)}(),function(){"use strict";function e(){return{restrict:"EA",transclude:!1,scope:{loadingSpinnerSize:"@"},template:'<div class="loading-spinner loading-spinner-{{ loadingSpinnerSize }}"><div class="loading loading-0"></div><div class="loading loading-1"></div><div class="loading loading-2"></div></div>'}}angular.module("blocktrail.core").directive("loadingSpinner",e)}(),function(){"use strict";function e(e,t){return{link:function(n,r,o){var a=function(e){var t=r[0].contains(e.target),a=r[0]===e.target,i=t||a;i||n.$apply(o.clickAnywhereButHere)};n.$watch(o.isActive,function(n,r){n!==r&&n===!0?t(function(){e.bind("click",a)}):n!==r&&n===!1&&t(function(){e.unbind("click",a)})})}}}e.$inject=["$document","$timeout"],angular.module("blocktrail.core").directive("clickAnywhereButHere",e)}(),function(){"use strict";function e(e){return{restrict:"E",replace:!0,scope:{form:"=",networkTypes:"="},templateUrl:"js/modules/core/directives/network-custom-select/network-custom-select.tpl.html",link:function(t){function n(){t.networkTypes.sort(function(e,n){return e.value===t.form.networkType?-1:n.value===t.form.networkType?1:r.indexOf(e)<r.indexOf(n)?-1:1})}t.CONFIG=e;var r=t.networkTypes.slice();t.$watch("form.networkType",function(){n()})}}}e.$inject=["CONFIG"],angular.module("blocktrail.wallet").directive("networkCustomSelect",e)}(),function(){"use strict";function e(e,t){return{restrict:"E",replace:!0,scope:{mode:"="},templateUrl:"js/modules/core/directives/top-header/top-header.tpl.html",link:function(n){n.CONFIG=e,n.$state=t}}}e.$inject=["CONFIG","$state"],angular.module("blocktrail.core").directive("topHeader",e)}(),function(){"use strict";function e(){return function(e,t,n){if(isNaN(t))return e;if(t<=0)return"";if(e&&e.length>=t){if(e=e.substring(0,t),n)for(;" "===e.charAt(e.length-1);)e=e.substr(0,e.length-1);else{var r=e.lastIndexOf(" ");r!==-1&&(e=e.substr(0,r))}return e+"..."}return e}}angular.module("blocktrail.core").filter("characters",e)}(),function(){"use strict";function e(){function e(e,t){var n=t.split(" ");return t=n[n.length-1],e.filter(function(e){return 0==e.indexOf(t)})}return e}angular.module("blocktrail.core").filter("filterERS",e)}(),function(){"use strict";function e(e){var t=e.getActiveWallet(),n=t.getReadOnlyWalletData();return function(e){return e?parseInt(n.blockHeight)-parseInt(e)+1:0}}e.$inject=["walletsManagerService"],angular.module("blocktrail.core").filter("confirmations",e)}(),function(){"use strict";function e(){return function(e){if(!e)return e;var t=/\S+\s*/g,n=e.trim().match(t);return n&&n.length>=2?(n[0][0]+n[n.length-1][0]).toUpperCase():n?n[0][0].toUpperCase():e}}angular.module("blocktrail.core").filter("contactInitials",e)}(),function(){"use strict";function e(e){return function(t){return e.duration(t).humanize()}}angular.module("blocktrail.core").filter("duration",["moment",e])}(),function(){"use strict";function e(e){return function(t){return e.languageName(t)}}e.$inject=["blocktrailLocalisation"],angular.module("blocktrail.core").filter("languageName",e)}(),function(){"use strict";function e(){return function(e){return Math.abs(e)}}angular.module("blocktrail.core").filter("mathAbs",e)}(),function(){"use strict";function e(e){return function(t){return e.trustAsHtml((t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2"))}}e.$inject=["$sce"],angular.module("blocktrail.core").filter("nl2br",e)}(),function(){"use strict";function e(e,t,n){var r=1e8,o=8,a={SHORT:"short",HIDE:"hide",LONG:"long"};return function(n,i,l,c,s,u){if("undefined"==typeof u||u===!1?u=a.SHORT:u===!0&&(u=a.HIDE),i=i.toUpperCase(),"BTC"===i)throw new Error("use satoshiToCoin filter instead");c="undefined"==typeof c?2:parseInt(c);var d,p,f,g,h=parseFloat((n/r).toFixed(o));return"undefined"==typeof l&&(l=e.bitcoinPrices),d="undefined"!=typeof l[i]?(h*l[i]).toFixed(c):(0).toFixed(c),"undefined"==typeof t.currencies[i]?(p=i,f=i):(p=t.currencies[i].symbol||i,f=t.currencies[i].code||i),g=u===a.LONG?f:p,g=s?'<span class="disp">'+g+"</span>":" "+g,u===a.HIDE?d:g+d}}e.$inject=["$rootScope","Currencies","$filter"],angular.module("blocktrail.core").filter("satoshiToCurrency",e)}(),function(){"use strict";function e(e){var t=1e8,n=8,r={SHORT:"short",HIDE:"hide",LONG:"long"};return function(o,a,i,l,c){if(!a||"undefined"==typeof e.NETWORKS[a])throw new Error("Unknown networkType ["+a+"]");"undefined"==typeof c||c===!1?c=r.SHORT:c===!0&&(c=r.HIDE),i="undefined"==typeof i?8:parseInt(i);var s=e.NETWORKS[a].TICKER,u=e.NETWORKS[a].TICKER_LONG,d=parseFloat((o/t).toFixed(n)),p=c===r.LONG?u:s;return p=l?'<span class="disp">'+p+"</span>":" "+p,c===r.HIDE?d.toFixed(i):d.toFixed(i)+p}}e.$inject=["CONFIG"],angular.module("blocktrail.core").filter("satoshiToCoin",e)}(),function(){"use strict";function e(e){return function(t){return"undefined"==typeof e.currencies[t]?t:e.currencies[t].symbol||t}}e.$inject=["Currencies"],angular.module("blocktrail.core").filter("toCurrencySymbol",e)}(),function(){"use strict";function e(e){return function(t){return"undefined"==typeof e.currencies[t]?t:e.currencies[t].ticker||e.currencies[t].code||t}}e.$inject=["Currencies"],angular.module("blocktrail.core").filter("toCurrencyTicker",e)}(),function(){"use strict";function e(e){e.state("app.logout",{url:"/logout?continue",controller:"LogoutCtrl"}).state("app.bannedip",{url:"/bannedip?bannedIp",cache:!1,controller:"BannedIpCtrl",templateUrl:"js/modules/setup/controllers/banned-ip/banned-ip.tpl.html"}).state("app.lostlock",{url:"/lostlock?refresh",cache:!1,controller:"LostLockCtrl",templateUrl:"js/modules/setup/controllers/lost-lock/lost-lock.tpl.html",resolve:{preferredLanguage:t}}).state("app.loggedout",{url:"/loggedout",cache:!1,controller:"SetupLoggedoutCtrl",templateUrl:"js/modules/setup/controllers/loggedout/loggedout.tpl.html",resolve:{preferredLanguage:t}}).state("app.setup",{url:"/setup","abstract":!0,controller:"SetupWrapperCtrl",templateUrl:"js/modules/setup/controllers/wrapper/wrapper.tpl.html",resolve:{globalLock:["globalLockService",function(e){e.init()}],preferredLanguage:t,sdkSetAccountInfo:["launchService","sdkService",function(e,t){return e.getAccountInfo().then(function(e){return t.setAccountInfo(e)})}]}}).state("app.setup.login",{url:"/login",cache:!1,controller:"SetupLoginCtrl",templateUrl:"js/modules/setup/controllers/login/login.tpl.html",resolve:{handleSetupState:n}}).state("app.setup.register",{url:"/register",cache:!1,controller:"SetupNewAccountCtrl",templateUrl:"js/modules/setup/controllers/new-account/new-account.tpl.html",resolve:{handleSetupState:n}}).state("app.setup.forgotPassword",{url:"/forgot-password",cache:!1,controller:"SetupForgotPasswordCtrl",templateUrl:"js/modules/setup/controllers/forgot-password/forgot-password.tpl.html",resolve:{handleSetupState:n}}).state("app.setup.changePassword",{url:"/change-password?token&recovery&version&requires_2fa",cache:!1,controller:"SetupChangePasswordCtrl",templateUrl:"js/modules/setup/controllers/change-password/change-password.tpl.html",resolve:{handleSetupState:n}}).state("app.setup.wallet",{url:"/wallet",cache:!1,controller:"SetupWalletInitCtrl",templateUrl:"js/modules/setup/controllers/wallet-init/wallet-init.tpl.html",resolve:{handleSetupState:n}}).state("app.setup.walletBackup",{url:"/wallet-backup",cache:!1,controller:"SetupWalletBackupCtrl",templateUrl:"js/modules/setup/controllers/wallet-backup/wallet-backup.tpl.html",resolve:{handleSetupState:n,backupInfo:r}}).state("app.setup.rebrand",{url:"/rebrand?goto",controller:"SetupRebrandCtrl",templateUrl:"js/modules/setup/controllers/rebrand/rebrand.tpl.html"})}function t(e,t,n,r,o){var a=!1;return o.getWalletConfig().then(function(e){return a=e.is_banned_ip,e.extraLanguages.concat(n.EXTRA_LANGUAGES).unique()}).then(function(e){var n,o=r.parseExtraLanguages(e);n=o?o[1]:r.setupPreferredLanguage(),t.changeLanguage(n)}).then(function(){a&&e.go("app.bannedip",{bannedIp:a})},function(e){console.error(e)})}function n(e,t){return t.handleSetupState(this.toString(),e)}function r(e){return e.getBackupInfo(!0)}e.$inject=["$stateProvider"],t.$inject=["$state","$rootScope","CONFIG","blocktrailLocalisation","launchService"],n.$inject=["$state","launchService"],r.$inject=["launchService"],angular.module("blocktrail.setup").config(e)}(),function(){"use strict";function e(e,t){var n=this;n._$modal=e,n._$rootScope=t,n.dialogId=0}angular.module("blocktrail.wallet").factory("dialogService",["$modal","$rootScope",function(t,n){return new e(t,n)}]),e.prototype.isCancel=function(e){return"CANCELED"===e||"dismiss"===e||"backdrop click"===e},e.prototype.alert=function(e,t,n,r){var o=this,a=++o.dialogId,i=o._getMessage(e,t,n,r),l=o._getModalInstanceByType("alert",i,a);return l.message=i,l.update=function(e,t,n,r){var i=o._getMessage(e,t,n,r);o._$rootScope.$broadcast("dialog:"+a,i)},l},e.prototype.alertSingleton=function(){var e=this,t=function(n,r,o,a){return t.modalInstance?t.modalInstance.update(n,r,o,a):(t.modalInstance=e.alert(n,r,o,a),t.modalInstance.result.then(function(){t.modalInstance=null},function(){t.modalInstance=null})),t.modalInstance};return t.modalInstance=null,t.dismiss=function(){t.modalInstance&&t.modalInstance.dismiss()},t},e.prototype.prompt=function(e,t,n,r){var o=this,a=++o.dialogId,i=o._getMessage(e,t,n,r,!0);"undefined"==typeof i.prompt&&(i.prompt=!0);var l=o._getModalInstanceByType("prompt",i,a);return l.message=i,l.update=function(e,t,n){var i=o._getMessage(e,t,n,r,!0);o._$rootScope.$broadcast("dialog:"+a,i)},l},e.prototype.spinner=function(e,t){var n=this,r=++n.dialogId,o=n._getMessage(e,t,!1,!1);"undefined"==typeof o.title&&(o.title="LOADING");var a=n._getModalInstanceByType("spinner",o,r);return a.message=o,a.update=function(e,t){var o=n._getMessage(e,t,!1,!1);n._$rootScope.$broadcast("dialog:"+r,o)},a},e.prototype._getMessage=function(e,t,n,r,o){var a;return"undefined"==typeof o&&(o=!1),"object"==typeof e?(a=e,"undefined"==typeof a.ok&&(a.ok=!0),"undefined"==typeof a.cancel&&(a.cancel=o)):a={title:e,body:t,ok:"undefined"==typeof n||n,cancel:"undefined"==typeof r?o:r},a},e.prototype._getModalInstanceByType=function(e,t,n){var r=this,o="",a="",i=t.cancel!==!1&&t.ok!==!1||"static";switch(e){case"alert":o="DialogAlertModalCtrl",a="js/modules/core/controllers/dialog-alert-modal/dialog-alert-modal.tpl.html";break;case"prompt":o="DialogPromptModalCtrl",a="js/modules/core/controllers/dialog-prompt-modal/dialog-prompt-modal.tpl.html";break;case"spinner":o="DialogSpinnerModalCtrl",a="js/modules/core/controllers/dialog-spinner-modal/dialog-spinner-modal.tpl.html";break;default:throw new Error("Modal type should be defined. Blocktrail core module, dialog service.")}return r._$modal.open({controller:o,templateUrl:a,size:t.size||"md",backdrop:t.backdrop?t.backdrop:i,resolve:{message:function(){return t},dialogId:function(){return n}}})}}(),function(){"use strict";function e(e,t,n){function r(){return e.go("app.lostlock",{refresh:1})}function o(){return s.get("LOCK").then(function(e){return e.uuid===c?(e.ts=(new Date).getTime(),s.put(e).then(function(){return!0})):(console.log("Lost our lock"),void r())},function(e){if("InvalidStateError"===e.name&&11===e.code)return!1;throw e})}function a(){setTimeout(function(){o().then(function(e){e&&a()})},100)}function i(){return s.get("LOCK")["catch"](function(){return{_id:"LOCK",uuid:null,ts:null}}).then(function(e){var t=e.ts;e.uuid=c,e.ts=(new Date).getTime();var n=t&&t>e.ts-1e3;return s.put(e).then(function(){return n})})}function l(){if(!u)return u=!0,i()["catch"](function(){console.log("Can't get lock"),r()}).then(function(e){console.log(e?"Took lock":"Got lock"),a()})}var c=n(32).toString("hex"),s=t.db("LOCK"),u=!1;return{init:l}}e.$inject=["$state","storageService","randomBytesJS"],angular.module("blocktrail.wallet").factory("globalLockService",e)}(),function(){"use strict";function e(e,t,n){function r(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function o(){if(angular.isFunction(e.getLocale))return e.getLocale();var n,r,o=t.$get().navigator,a=["language","browserLanguage","systemLanguage","userLanguage"];if(angular.isArray(o.languages))for(n=0;n<o.languages.length;n++)if(r=o.languages[n],r&&r.length)return r;for(n=0;n<a.length;n++)if(r=o[a[n]],r&&r.length)return r;return null}function a(e){for(var t=h,n=_,o=[],a=angular.lowercase(e),i=0,l=t.length;i<l;i++)o.push(angular.lowercase(t[i]));if(r(o,a)>-1)return e;if(n){var c;for(var s in n){var u=!1,d=Object.prototype.hasOwnProperty.call(n,s)&&angular.lowercase(s)===angular.lowercase(e);if("*"===s.slice(-1)&&(u=s.slice(0,-1)===e.slice(0,s.length-1)),(d||u)&&(c=n[s],r(o,angular.lowercase(c))>-1))return c}}if(e){var p=e.split("_");if(p.length>1&&r(o,angular.lowercase(p[0]))>-1)return p[0]}return e}function i(e){return S[e.replace("_","-")]}function l(){n.registerAvailableLanguageKeys(h,_)}function c(){return h}function s(e,t){h.indexOf(e)===-1&&(h.push(e),angular.forEach(t,function(e,t){_[t]=e}),l())}function u(e){return h.indexOf(e)!==-1}function d(){return a(o())}function p(){var e=d();return u(e)?e:null}function f(){var e=p()||"en";return n.preferredLanguage(e),e}function g(e){var t=c(),n=e.filter(function(e){return t.indexOf(e)===-1});if(0!==n.length)return angular.forEach(n,function(e){s(e,{})}),[n,f()]}var h=["en-US","en"],_={"en-US":"en-US","en-*":"en","fr-*":"fr","nl-*":"nl","es-*":"es","ru-*":"ru","zh-cn":"cn","sw-*":"sw","ar-*":"ar","hi-*":"hi","ko-*":"ko","de-*":"de","jp-*":"jp","pt-*":"pt"},S={nl:"DUTCH",en:"ENGLISH","en-US":"ENGLISH_US",fr:"FRENCH",es:"SPANISH",cn:"CHINESE",ru:"RUSSIAN",sw:"SWAHILI",ar:"ARABIC",hi:"HINDI",ko:"KOREAN",de:"GERMAN",jp:"JAPANESE",pt:"PORTUGUESE"};this.isAvailableLanguage=u,this.preferredAvailableLanguage=p,this.getFirstBrowserLanguage=o,this.setupPreferredLanguage=f,this.enableLanguage=s,this.registerLanguages=l,this.determinePreferredLanguage=d,this.languageName=i,this.getLanguages=c,this.parseExtraLanguages=g,this.$get=function(){return{isAvailableLanguage:u,preferredAvailableLanguage:p,getFirstBrowserLanguage:o,setupPreferredLanguage:f,enableLanguage:s,registerLanguages:l,determinePreferredLanguage:d,languageName:i,getLanguages:c,parseExtraLanguages:g}}}e.$inject=["pascalprechtTranslateOverrider","$windowProvider","$translateProvider"],angular.module("blocktrail.core").provider("blocktrailLocalisation",e)}(),function(){"use strict";function e(e,t,n,r,o){function a(){var a=((new Date).getTime()/1e3).toFixed(0),l=c.registerURIHandlerNotifyCounter,s=c.registerURIHandlerNotifyTimestamp;l<c.registerURIHandlerNotifyCounterMax&&a-s>c.registerURIHandlerNotifyTimestampDelta&&!c.registerURIHandlerExecuted&&n.updateSettingsUp({registerURIHandlerNotifyCounter:l+1,registerURIHandlerNotifyTimestamp:a}).then(function(){return i(!0).result.then(function(){n.updateSettingsUp({registerURIHandlerExecuted:!0}).then(function(){try{o.log("Trying to register bitcoin URI scheme"),navigator.registerProtocolHandler("bitcoin",e.WALLET_URL+"/#/wallet/handleURI/%s","BTC.com Bitcoin Wallet")}catch(n){if(o.error("Couldn't register bitcoin: URL scheme",n,n.message),"SecurityError"===n.name)return t.alert(r.instant("ERROR_TITLE_2"),r.instant("BROWSER_SECURITY_ERROR"),r.instant("OK")).result}})})})}function i(e){return t.alert(r.instant("MAKE_DEFAULT_BROWSER_WALLET"),r.instant("MAKE_DEFAULT_BROWSER_WALLET_DETAILS")+(e?" "+r.instant("DO_THIS_LATER_IN_SETTINGS"):"")+(l()?" "+r.instant("MAKE_DEFAULT_BROWSER_WALLET_DETAILS_CHROME"):""),r.instant("YES"),r.instant("NO"))}function l(){return null!==navigator.userAgent.match(/Chrome\/\d+/)}var c=n.getReadOnlySettingsData();return{checkAndPromptBitcoinURIHandler:a,promptBitcoinURIHandler:i}}e.$inject=["CONFIG","dialogService","settingsService","$translate","$log"],angular.module("blocktrail.core").factory("NotificationsService",e)}(),function(){"use strict";function e(e,t,n,r,o){function a(n){return e.post(t.API_URL+"/v1/"+t.API_NETWORK+"/recovery/request-link",{email:n})}function i(r){return e.post(t.API_URL+"/v1/"+t.API_NETWORK+"/recovery/request-recovery-secret",{token:r}).then(function(e){if(e.data&&e.data.recovery_secret)return e.data.recovery_secret},function(e){throw n.alert(o.instant("RECOVERY_ERROR"),o.instant("MSG_REQUEST_RECOVERY_SECRET_FAILED"),!1,!1),e})}function l(e,t,n){var o,a,i,l=null;if(n===blocktrailSDK.Wallet.WALLET_VERSION_V2)o=r.AES.encrypt(e,t).toString(r.format.OpenSSL),a=blocktrailSDK.bip39.entropyToMnemonic(blocktrailSDK.convert(o,"base64","hex"));else{if("string"!=typeof t)throw new Error("New password must be provided as a string");l=new blocktrailSDK.Buffer(t),o=blocktrailSDK.Encryption.encrypt(e,l),a=blocktrailSDK.EncryptionMnemonic.encode(o),o=o.toString("base64")}return i=r.SHA512(t).toString(),{password_hash:i,encrypted_secret:o,secret_mnemonic:a}}function c(e,t){var n=blocktrailSDK.EncryptionMnemonic.decode(e),r=blocktrailSDK.Encryption.decrypt(n,new blocktrailSDK.Buffer(t,"hex"));return r}function s(e,t){var n;try{return[c(e,t),blocktrailSDK.Wallet.WALLET_VERSION_V3]}catch(r){console.log("decryptSecretMnemonicWithPasswordV3 ERR",r),n=r}throw new Error("Failed to decrypt; v3="+n)}return{requestRecoveryMail:a,requestRecoverySecret:i,encryptSecretWithPassword:l,decryptSecretMnemonicWithPassword:s}}e.$inject=["$http","CONFIG","dialogService","cryptoJS","$translate"],angular.module("blocktrail.core").factory("passwordRecoveryService",e)}(),function(){"use strict";function e(e){var t=this;t._$q=e,t._zxcvbn=zxcvbn}angular.module("blocktrail.wallet").factory("passwordStrengthService",["$q","zxcvbn",function(t,n){return new e(t,n)}]),e.prototype.checkPassword=function(e,t){var n=this;return n._$q.when(n._zxcvbn(e,t||[]))}}(),function(){"use strict";function e(e,t,n){function r(){return e.get(t.API_URL+"/v1/mywallet/powtcha").then(function(e){return e.data})}function o(){return r().then(function(e){var t=new n.PoWtcha({salt:n.Buffer.from(e.salt,"hex"),target:e.target});return t})}return{newPoWtcha:o}}e.$inject=["$http","CONFIG","powtcha"],angular.module("blocktrail.wallet").factory("powtchaService",e)}(),function(){"use strict";function e(e,t){var n=this;n._blocktrailSDK=e,n._CONFIG=t,n._accountInfo=null,n._sdkList={},n._sdkData={networkType:t.NETWORKS_ENABLED[0]},n._readonlyDoc={readonly:!0},angular.forEach(n._sdkData,function(e,t){Object.defineProperty(n._readonlyDoc,t,{set:function(){throw new Error("Read only object. Blocktrail core module, SDK service.")},get:function(){return n._sdkData[t]}})}),n.activeNetworkType=null}function t(e){e.prototype.updateMetadata=function(e,t){var n=this;return n.client.post("/metadata",null,e,t)},e.prototype.getAllWallets=function(){var e=this;return e.client.get("/mywallet/wallets")},e.prototype.syncContacts=function(e,t){var n=this;return n.client.post("/contacts",null,e,t)},e.prototype.getProfile=function(){var e=this;return e.client.get("/mywallet/profile")},e.prototype.syncProfile=function(e){var t=this;return t.client.post("/mywallet/profile",null,e)},e.prototype.getSettings=function(e){var t=this;return t.client.get("/mywallet/settings")},e.prototype.syncSettings=function(e){var t=this;return t.client.post("/mywallet/settings",null,e)},e.prototype.requestContactAddress=function(e,t){var n=this;return n.client.get("/contact/"+e+"/new-address",null,!1,t)},e.prototype.updatePhone=function(e,t){var n=this;return n.client.post("/mywallet/phone",null,e,t)},e.prototype.removePhone=function(e){var t=this;return t.client["delete"]("/mywallet/phone",null,null,e)},e.prototype.verifyPhone=function(e,t){var n=this;return n.client.post("/mywallet/phone/verify",null,{token:e},t)},e.prototype.glideraOauth=function(e,t){var n=this;return n.client.post("/mywallet/glidera/oauth",{platform:"web"},{code:e,redirect_uri:t})},e.prototype.glideraBuyPrices=function(e,t){var n=this;return n.client.get("/mywallet/glidera/prices/buy",{qty:e,fiat:t,platform:"web"})},e.prototype.passwordChange=function(e,t,n,r,o){var a=this;return a.client.post("/mywallet/password-change",null,{password:e,new_password:t,encrypted_secret:n,two_factor_token:r,wallets:o})},e.prototype.setMainMobileWallet=function(e,t){var n=this;return n.client.post("/mywallet/main",null,{identifier:e},t)},e.prototype.getSignedBitonicUrl=function(e,t){var n=this;return n.client.post("/mywallet/"+e+"/bitonic/oauth",null,t)},e.prototype.setup2FA=function(e,t){var n=this;return n.client.post("/mywallet/2fa/setup",null,{password:e},t)},e.prototype.enable2FA=function(e,t){var n=this;return n.client.post("/mywallet/2fa/enable",null,{two_factor_token:e},t)},e.prototype.disable2FA=function(e,t){var n=this;return n.client.post("/mywallet/2fa/disable",null,{two_factor_token:e},t)},e.prototype.contacts=function(e,t){var n=this;return n.client.get("/mywallet/contacts",{last_synced:e},t)},e.prototype.walletTransaction=function(e,t){var n=this;return n.client.get("/wallet/"+e+"/transaction/"+t)},e.prototype.sendFeedback=function(e,t){var n=this;return n.client.post("/mywallet/feedback",null,e,t);
}}angular.module("blocktrail.core").factory("sdkService",["blocktrailSDK","CONFIG",function(n,r){return t(n),new e(n,r)}]),e.prototype.getReadOnlySdkData=function(){var e=this;return e._readonlyDoc},e.prototype.getNetworkType=function(){var e=this;return e._sdkData.networkType},e.prototype.setNetworkType=function(e){var t=this;if(t._CONFIG.NETWORKS_ENABLED.indexOf(e)===-1)throw new Error("Blocktrail core module, sdk service. Network type "+e+"is not enable.");return t._sdkData.networkType=e,t._readonlyDoc},e.prototype.getSdkByActiveNetwork=function(){var e=this;if(null===e._sdkData.networkType)throw new Error("Blocktrail core module, sdk service. Network type is not set up");return e._sdkList[e._sdkData.networkType]},e.prototype.getSdkByNetworkType=function(e){var t=this;if(!t._accountInfo)throw new Error("Blocktrail core module, sdk service. Can't get the SDK without accountInfo.");if(!t._sdkList[e])throw new Error("Blocktrail core module, sdk service. The type is not exist "+type+".");return t._sdkList[e]},e.prototype.setAccountInfo=function(e){var t=this;t._accountInfo=e,t._initSdkList()},e.prototype._initSdkList=function(){var e=this;e._CONFIG.NETWORKS_ENABLED.forEach(function(t){var n="t"===t.substr(0,1),r=e._CONFIG.NETWORKS[t].NETWORK;n&&(r=r.substr(1));var o={apiKey:e._accountInfo?e._accountInfo.api_key:null,apiSecret:e._accountInfo?e._accountInfo.api_secret:null,testnet:n,host:e._CONFIG.API_HOST||null,network:r,https:"undefined"==typeof e._CONFIG.API_HTTPS||e._CONFIG.API_HTTPS};e._sdkList[t]=new e._blocktrailSDK(o)})}}(),function(){"use strict";function e(e,t,n){var r=this,o="user_settings",a={_id:o,displayName:null,username:"",email:null,language:null,extraLanguages:[],knownLanguages:[],timezone:"GMT+1",localCurrency:"EUR",profilePic:null,profileSynced:!0,receiveNewsletter:1,profilePosX:50,profilePosY:50,twoFactorWarningLastDisplayed:null,contactsLastSync:null,useTestnet:!1,walletActivated:!1,showArchived:!1,glideraRequest:null,glideraAccessToken:null,glideraTransactions:[],latestVersionWeb:null,glideraActivationNoticePending:null,hideBCCSweepWarning:!1,buyBTCRegion:null,registerURIHandlerExecuted:!1,registerURIHandlerNotifyCounter:0,registerURIHandlerNotifyCounterMax:3,registerURIHandlerNotifyTimestamp:null,registerURIHandlerNotifyTimestampDelta:604800};r._$q=e,r._sdkService=t,r._id=o,r._syncingSettingsDown=null,r._syncingProfileDown=null,r._loaded=!1,r.$_updateLocalStorage=null,r._storage=n.db("settings"),r._doc={_id:o},r._pending={},r._pendingSettingsPropertyList=["localCurrency","language","receiveNewsletter","glideraAccessToken","glideraTransactions","latestVersionWeb","glideraActivationNoticePending","buyBTCRegion","username","email","hideBCCSweepWarning","walletActivated","knownLanguages","showArchived"],r._pendingProfilePropertyList=["profilePic"],angular.forEach(a,function(e,t){Object.defineProperty(r._doc,t,{set:function(e){r._syncingSettingsDown&&r._pendingSettingsPropertyList.indexOf(t)!==-1?r._pending[t]=e:r._syncingProfileDown&&r._pendingProfilePropertyList.indexOf(t)!==-1?r._pending[t]=e:a[t]=e},get:function(){return a[t]},enumerable:!0})}),r._readonlyDoc={readonly:!0},angular.forEach(a,function(e,t){Object.defineProperty(r._readonlyDoc,t,{set:function(){throw new Error("Read only object. Blocktrail core module, settings service.")},get:function(){return a[t]}})})}angular.module("blocktrail.core").factory("settingsService",["$q","storageService","sdkService",function(t,n,r){return new e(t,r,n)}]),e.prototype.getSettings=function(){var e,t=this;return e=t._loaded===!1?t._loadSettings():t._loaded===!0?t._$q.when(!0).then(t._getSettings.bind(t)):t._loaded},e.prototype.updateSettingsUp=function(e){var t,n=this;if(n._syncingSettingsDown)n._syncingSettingsDown.then(function(){t=n.updateSettingsUp(e)});else{var r=n.checkOnPropertyUpList(e,n._pendingSettingsPropertyList),o=n.checkOnPropertyUpList(e,n._pendingProfilePropertyList);if(angular.extend(n._doc,e),t=n._updateLocalStorage(),r&&o){var a=n._$q.all([n._syncSettingsUp(),n._syncProfileUp()]);t=t.then(a)}else r?t=t.then(n._syncSettingsUp.bind(this)):o&&(t=t.then(n._syncProfileUp.bind(this)));t=t.then(function(){return n._readonlyDoc})}return t},e.prototype.checkOnPropertyUpList=function(e,t){for(var n=!1,r=0;r<t.length&&!n;)angular.isDefined(e[t[r]])&&(n=!0),r++;return n},e.prototype.addGlideraTransaction=function(e){var t,n=this;return n._syncingSettingsDown?n._syncingSettingsDown.then(function(){t=n.addGlideraTransaction(e)}):(n._doc.glideraTransactions.push(e),t=n._updateLocalStorage().then(n._syncSettingsUp.bind(this)).then(function(){return n._readonlyDoc})),t},e.prototype.updateGlideraTransactions=function(e){var t,n=this;return n._syncingSettingsDown?n._syncingSettingsDown.then(function(){t=n.updateGlideraTransactions(e)}):(n._doc.glideraTransactions=e,t=n._updateLocalStorage().then(n._syncSettingsUp.bind(this)).then(function(){return n._readonlyDoc})),t},e.prototype.getReadOnlySettingsData=function(){var e=this;return e._readonlyDoc},e.prototype.syncSettingsDown=function(){var e=this;return this._syncingSettingsDown||(this._syncingSettingsDown=e._$q.when(e._syncSettingsDown()).then(e._syncSettingsFromPendingObject.bind(e)).then(e._updateLocalStorage.bind(e))["finally"](function(){return e._readonlyDoc})),this._syncingSettingsDown},e.prototype.syncProfileDown=function(){var e=this;return e._syncingProfileDown||(e._syncingProfileDown=e._$q.when(e._syncProfileDown()).then(this._syncSettingsFromPendingObject.bind(e)).then(e._updateLocalStorage.bind(e))["finally"](function(){return e._readonlyDoc})),this._syncingProfileDown},e.prototype._loadSettings=function(){var e=this;return e._loaded=e._$q.when(e._syncDocWithLocalStorage()).then(e._syncSettingsAndProfileDown.bind(e)).then(e._getSettings.bind(e))["finally"](function(){e._loaded=!0}),e._loaded},e.prototype._syncDocWithLocalStorage=function(){var e=this;return e._$q.when(e._storage.get(e._id)).then(function(t){return angular.extend(e._doc,t),e._doc},function(){return e._doc})},e.prototype._syncSettingsAndProfileDown=function(){var e=this;return e._$q.all([e.syncSettingsDown(),e.syncProfileDown()])},e.prototype._syncSettingsDown=function(){var e=this;return e._$q.when(e._sdkService.getSdkByActiveNetwork()).then(e._getSDKSettings.bind(e)).then(e._setSDKSettingsToDoc.bind(e))},e.prototype._getSDKSettings=function(e){return e.getSettings()},e.prototype._setSDKSettingsToDoc=function(e){var t=this;return t._syncingSettingsDown=null,t._doc.receiveNewsletter=null!==e.receiveNewsletter?e.receiveNewsletter:t._doc.receiveNewsletter,t._doc.language=null!==e.language?e.language:t._doc.language,t._doc.localCurrency=null!==e.localCurrency?e.localCurrency:t._doc.localCurrency,t._doc.glideraAccessToken=e.glideraAccessToken,t._doc.glideraTransactions=e.glideraTransactions||[],t._doc.username=e.username,t._doc.email=e.email,t._doc.buyBTCRegion=e.buyBTCRegion,t._doc.latestVersionWeb=e.latestVersionWeb,t._doc.glideraActivationNoticePending=e.glideraActivationNoticePending,t._doc.hideBCCSweepWarning=e.hideBCCSweepWarning,t._doc.walletActivated=e.walletActivated,t._doc.knownLanguages=e.knownLanguages,t._doc.showArchived=e.showArchived,t._doc},e.prototype._syncProfileDown=function(){var e=this;return this._$q.when(this._sdkService.getSdkByActiveNetwork()).then(this._getSDKProfile.bind(e)).then(this._setSDKProfileToDoc.bind(e))},e.prototype._getSDKProfile=function(e){return e.getProfile()},e.prototype._setSDKProfileToDoc=function(e){var t=this;return t._syncingProfileDown=null,t._doc.profilePic=e.profilePic&&"data:image/jpeg;base64,"+e.profilePic||null,t._doc},e.prototype._getSettings=function(){var e=this;return e._readonlyDoc},e.prototype._syncSettingsFromPendingObject=function(){var e=this;return Object.keys(e._pending).length&&angular.forEach(e._pending,function(t,n){e._syncingSettingsDown||e._pendingSettingsPropertyList.indexOf(n)===-1||(e._doc[n]=e._pending[n],delete e._pending[n]),e._syncingProfileDown||e._pendingProfilePropertyList.indexOf(n)===-1||(e._doc[n]=e._pending[n],delete e._pending[n])}),e._doc},e.prototype._updateLocalStorage=function(){var e=this;return e.$_updateLocalStorage?e.$_updateLocalStorage.then(function(){return e._updateLocalStorage()}):(e.$_updateLocalStorage=e._$q.when(this._storage.get(e._id)["catch"](function(){}).then(function(t){return t&&t._rev!==e._doc._rev&&(e._doc._rev=t._rev),e._storage.put(angular.copy(e._doc))["catch"](function(e){}).then(function(){return e.$_updateLocalStorage=null,e._doc})})),e.$_updateLocalStorage)},e.prototype._syncSettingsUp=function(){var e=this;return this._$q.when(e._sdkService.getSdkByActiveNetwork()).then(function(t){var n={localCurrency:e._doc.localCurrency,language:e._doc.language,receiveNewsletter:e._doc.receiveNewsletter,glideraAccessToken:e._doc.glideraAccessToken,glideraTransactions:e._doc.glideraTransactions||[],latestVersionWeb:e._doc.latestVersionWeb,glideraActivationNoticePending:e._doc.glideraActivationNoticePending,buyBTCRegion:e._doc.buyBTCRegion,username:e._doc.username,email:e._doc.email,hideBCCSweepWarning:e._doc.hideBCCSweepWarning,walletActivated:e._doc.walletActivated,knownLanguages:e._doc.knownLanguages,showArchived:e._doc.showArchived};return t.syncSettings(n)})},e.prototype._syncProfileUp=function(){var e=this;return this._$q.when(e._sdkService.getSdkByActiveNetwork()).then(function(t){var n={profilePic:e._doc.profilePic};return t.syncProfile(n)})}}(),function(){"use strict";function e(e,t,n,r,o,a){function i(e,t,n){for(var r=null,o=null,a={},i=t;i<=n+t;i++){r=e.derive(i),o=r.getAddress();var l=r.keyPair;a[o]={priv_key:l,derive_idx:i}}return a}function l(e,t,n){var r=e[0],o=e[1],a=i(o,t*n,n),l=Object.keys(a),c=[["batch",r,o.neutered().toBase58(),t,n]];return S.push(c),_.batchAddressHasTransactions(l).then(function(e){return c.push(["addresses",l,e]),!!e&&_.getBatchUnspentOutputs(l)}).then(function(e){c.push(["utxos",JSON.parse(JSON.stringify(e))]);var t=Object.keys(e);return angular.forEach(t,function(t){e[t].priv_key=a[t].priv_key,e[t].derive_idx=a[t].derive_idx}),e})}function c(e,t,n,r){return n=n||0,r=r||{},l(e,n,t).then(function(o){return o?(angular.extend(r,o),c(e,t,n+1,r)):r})}function s(e,n){var r=Object.keys(e),o=[],a=t.Transaction.SIGHASH_ALL;"bcc"===n.network.toLowerCase()&&(a|=t.Transaction.SIGHASH_BITCOINCASHBIP143);for(var i=0;i<r.length;i++){var l=r[i];angular.forEach(e[l],function(e){o.push({txid:e.hash,vout:e.index,scriptPubKey:e.script_hex,value:e.value,address:l})})}return _.estimateFee().then(function(r){for(var i=625,l=0,c=[],s=o.length,u=Math.ceil(s/i),d=0;d<u;d++){l=d*i+i;var p=o.slice(d*i,l);c.push(p)}return c.map(function(o){var i=new t.TransactionBuilder,l=0;if(angular.forEach(o,function(e,t){l+=parseInt(e.value),i.addInput(e.txid,e.vout)}),l<=blocktrailSDK.DUST)return!1;i.addOutput(n.recipient,l);var c=blocktrailSDK.Wallet.estimateIncompleteTxFee(i.tx,r);return i.tx.outs[0].value-=c,!(i.tx.outs[0].value<=blocktrailSDK.DUST)&&("bcc"===n.network.toLowerCase()&&i.enableBitcoinCash(!0),angular.forEach(o,function(t,n){var r=e[t.address].priv_key;i.sign(n,r,null,a,t.value)}),{rawTx:i.build().toHex(),feePaid:c,inputCount:o.length,totalValue:l})})})}function u(t,n,r,o,a,i){o=o?1:0,a=a||0,i=i||{};for(var l=[],s=a;s<a+r;s++){var d="m/44'/"+o+"'/"+s+"'";l.push([d+"/0",t.derivePath(d+"/0")]),l.push([d+"/1",t.derivePath(d+"/1")])}return e.all(l.map(function(e){return c(e,n)})).then(function(e){var l=!0;return angular.forEach(e,function(e){Object.keys(e).length>0&&(l=!1),angular.extend(i,e)}),l?i:u(t,n,r,o,a+r,i)})}function d(e){return a.getAccountInfo().then(function(t){return _=new r({apiKey:t.api_key,apiSecret:t.api_secret,network:e.network,testnet:e.testnet})})}function p(e,t){return d(t).then(function(){return S=[],u(e,t.batchSize,t.accountBatchSize,t.testnet)})}function f(e,r){if(!n.validateMnemonic(e))return Promise.reject("Invalid Mnemonic.");var o=n.mnemonicToSeed(e),a=new blocktrailSDK.Buffer(o,"hex"),i=t.HDNode.fromSeedBuffer(a);return p(i,r).then(function(e){return s(e,r)},function(){console.log("Discovery failed")})}function g(n,r){return e.when().then(function(){S=[];var e=n.map(function(e){return t.ECPair.fromWIF(e)}),o={};angular.forEach(e,function(e){var n=new t.ECPair(e.d,null,{network:e.network,compressed:!e.compressed});S.push(["WIF",e.getAddress(),n.getAddress()]),o[e.getAddress()]=e,o[n.getAddress()]=n});var a=Object.keys(o);return d(r).then(function(){return _.batchAddressHasTransactions(a).then(function(e){return S.push(["batchAddressHasTransactions",e]),!!e&&_.getBatchUnspentOutputs(a)}).then(function(e){S.push(["getBatchUnspentOutputs",JSON.parse(JSON.stringify(e))]);var t=Object.keys(e);return angular.forEach(t,function(t){e[t].priv_key=o[t]}),e}).then(function(e){return s(e,r)},function(){console.log("Discovery failed")})})})}function h(){var e=o.getSdkByActiveNetwork();return e.client.post("/mywallet/sweeper/submit-debug-info",null,S)}var _=null,S=[];return{bip44Sweep:f,wifSweep:g,submitDebugInfo:h}}e.$inject=["$q","bitcoinJS","bip39","BlocktrailBitcoinService","sdkService","launchService"],angular.module("blocktrail.wallet").factory("sweeperService",e)}(),function(){"use strict";function t(e,t,n,r,o,a,i,l){var c=this;c._$q=e,c._$timeout=t,c._bitcoinJS=n,c._sdkService=r,c._storageService=o,c._settingsService=a,c._contactsService=i,c._CONFIG=l}function n(e,t,n,r,o,a,i,l,c,s){var u=this;console.log("new Wallet",e.identifier),u._$q=o,u._$timeout=a,u._bitcoinJS=i,u._contactsService=s,u._settingsService=c,u._TX_FILTER_MIN_BLOCK_HEIGHT=r,u._isInitData=!1,u._pollPromise=null,u._pollTimeout=null,u._pollingInterval=15e3,u._noPolling=!1,u._sdkWallet=e,u._walletStore=l.db("wallet"),u._walletData={transactions:[],balance:0,uncBalance:0,blockHeight:0,identifier:u._sdkWallet.identifier,networkType:t,uniqueIdentifier:n},u.isReady=u._initData(),u._readonlyDoc={readonly:!0},angular.forEach(u._walletData,function(e,t){Object.defineProperty(u._readonlyDoc,t,{set:function(){throw new Error("Read only object. Blocktrail core module, wallet service.")},get:function(){return u._walletData[t]}})}),u._amountOfOfflineAddresses=30,u.isRefilling=null,u.addressRefillPromise=null}var r=409;angular.module("blocktrail.core").factory("walletService",["$q","$timeout","bitcoinJS","sdkService","storageService","settingsService","Contacts","CONFIG",function(e,n,r,o,a,i,l,c){return new t(e,n,r,o,a,i,l,c)}]),t.prototype.initWallet=function(e,t,n){var r=this;return r._$q.when(r._sdkService.getSdkByNetworkType(e)).then(r._sdkInitWallet.bind(r,t),r._errorHandler.bind(r)).then(r._initWallet.bind(r,e,n))},t.prototype._sdkInitWallet=function(e,t){return t.initWallet({identifier:e,readOnly:!0,bypassNewAddressCheck:!0})},t.prototype._initWallet=function(e,t,r){var o=this,a=new n(r,e,t,o._CONFIG.NETWORKS[e].TX_FILTER_MIN_BLOCK_HEIGHT,o._$q,o._$timeout,o._bitcoinJS,o._storageService,o._settingsService,o._contactsService);return a.isReady},t.prototype._errorHandler=function(e){throw new Error(e)},n.prototype.getReadOnlyWalletData=function(){var e=this;return e._readonlyDoc},n.prototype.getSdkWallet=function(){var e=this;return e._sdkWallet},n.prototype._initData=function(){var e=this;return e._isInitData?(console.log("_initData",!0),e._$q.when(e)):(console.log("_initData",!1),e._$q.when(e._getBalance()).then(e._pollTransactionsAndGetBlockHeight.bind(e)).then(e._getTransactions.bind(e)).then(function(){return e._isInitData=!0,e._$q.when(e)}))},n.prototype.disablePolling=function(){var e=this;console.log("disablePolling"),e._pollTimeout&&e._$timeout.cancel(e._pollTimeout),e._noPolling=!0},n.prototype.enablePolling=function(){var e=this;console.log("enablePolling"),e._noPolling=!1,e._pollTransactionsAndGetBlockHeight()},n.prototype.forcePolling=function(){var e=this;return console.log("forcePolling"),e._pollTimeout&&e._$timeout.cancel(e._pollTimeout),e._pollTransactionsAndGetBlockHeight()},n.prototype._setupTimeout=function(){var e=this;return console.log("_setupTimeout"),e._noPolling||(e._pollTimeout&&e._$timeout.cancel(e._pollTimeout),e._pollTimeout=e._$timeout(e._pollTransactionsAndGetBlockHeight.bind(e),e._pollingInterval)),!0},n.prototype._pollTransactionsAndGetBlockHeight=function(){var e=this;return console.log("_pollTransactionsAndGetBlockHeight",!!e._pollPromise),e._pollPromise?e._pollPromise:e._pollPromise=e._$q.all([e._pollTransactions(),e._getBlockHeight()]).then(e._resetPollPromise.bind(e)).then(e._setupTimeout.bind(e))},n.prototype._resetWalletData=function(){var e=this;return console.log("_resetWalletData"),e._walletStore.allDocs({include_docs:!0,attachments:!0,startkey:e._sdkWallet.identifier,endkey:e._sdkWallet.identifier+"￰"}).then(e._getAllWalletDocumentsSuccessHandler.bind(e))},n.prototype._getAllWalletDocumentsSuccessHandler=function(e){var t=this,n=[];return e.rows.forEach(function(e){n.push(t._deleteDocumentFromStorage(e.doc))}),t._$q.all(n)},n.prototype._deleteDocumentFromStorage=function(e){var t=this;return console.log("_deleteDocumentFromStorage"),t._walletStore.remove(e)},n.prototype._getBalance=function(){var e=this;return console.log("_getBalance"),e._getBalanceFromStorage().then(e._getBalanceFromSdkAndUpdateBalanceDoc.bind(e)).then(e._setBalanceToStorage.bind(e)).then(e._updateBalanceInWalletDataObject.bind(e),e._errorHandler)},n.prototype._getBalanceFromStorage=function(){var e=this;return e._$q.when(e._walletStore.get(e._getUniqueIdentifier("balance")))["catch"](function(){return{_id:e._getUniqueIdentifier("balance"),balance:0,uncBalance:0}})},n.prototype._getBalanceFromSdkAndUpdateBalanceDoc=function(e){var t=this;return t._$q.when(t._sdkWallet.getBalance()).then(function(t){return e.balance=t[0],e.uncBalance=t[1],e})["catch"](function(){return e})},n.prototype._setBalanceToStorage=function(e){var t=this;return t._$q.when(t._walletStore.put(e)).then(function(){return e},function(e){throw e.status===r&&console.error("_setBalanceToStorage CONFLICT"),e})},n.prototype._updateBalanceInWalletDataObject=function(e){var t=this;return t._walletData.balance=e.balance,t._walletData.uncBalance=e.uncBalance,t._walletData},n.prototype._getBlockHeight=function(){var e=this;return console.log("_getBlockHeight"),e._getBlockHeightFromStorage().then(e._getBlockHeightFromSdkAndUpdateBlockHeightDoc.bind(e)).then(e._setBlockHeightToStorage.bind(e)).then(e._updateBlockHeightInWalletDataObject.bind(e),e._errorHandler)},n.prototype._getBlockHeightFromStorage=function(){var e=this;return e._$q.when(e._walletStore.get(e._getUniqueIdentifier("block-height")))["catch"](function(){return{_id:e._getUniqueIdentifier("block-height"),height:null}}).then(function(e){return console.log("_getBlockHeightFromStorage",e.height,e._rev),e})},n.prototype._getBlockHeightFromSdkAndUpdateBlockHeightDoc=function(e){var t=this;return t._$q.when(t._sdkWallet.sdk.blockLatest()).then(function(t){return e.height=t.height,e})["catch"](function(){return e})},n.prototype._setBlockHeightToStorage=function(e){var t=this;return console.log("_setBlockHeightToStorage",e.height,e._rev),t._$q.when(t._walletStore.put(e)).then(function(){return e},function(e){throw e.status===r&&console.error("_setBlockHeightToStorage CONFLICT"),e})},n.prototype._updateBlockHeightInWalletDataObject=function(e){var t=this;return t._walletData.blockHeight=e.height,t._walletData},n.prototype._getLastBlockHashFromStorage=function(){var e=this;return e._walletStore.get(e._getUniqueIdentifier("last-block-hash"))["catch"](function(){return{_id:e._getUniqueIdentifier("last-block-hash"),hash:null}})},n.prototype._setLastBlockHashToStorage=function(e){var t=this;return t._walletStore.put(e).then(function(){return e},function(e){throw e.status===r&&console.error("_setLastBlockHashToStorage CONFLICT"),e})},n.prototype._getTransactions=function(){var e=this;return e._$q.when(e._getTransactionsHistoryFromStorage()).then(e._prepareTransactionsList.bind(e)).then(e._processTransactionDocs.bind(e),e._errorHandler).then(e._updateTransactionsList.bind(e))},n.prototype._pollTransactions=function(){var e=this;return console.log("_pollTransactions"),e._$q.when(e._getLastBlockHashFromStorage()).then(e._getTransactionsHistoryFromStorageAndTransactionsFromSdk.bind(e)).then(e._processTransactionsAndGetBalance.bind(e)).then(e._setLastBlockHashToStorageAndTransactionHistoryToStorage.bind(e)).then(e._addNewTransactionsToList.bind(e))["catch"](e._pollTransactionsCatchHandler.bind(e))},n.prototype._getTransactionsHistoryFromStorage=function(){var e=this;return e._walletStore.get(e._getUniqueIdentifier("transactions-history"))["catch"](function(){return{_id:e._getUniqueIdentifier("transactions-history"),confirmed:[],unconfirmed:[]}})},n.prototype._setTransactionHistoryToStorage=function(e){var t=this;return t._walletStore.put(e).then(function(){return e},function(e){throw e.status===r&&console.error("_setTransactionHistoryToStorage CONFLICT"),e})},n.prototype._setTransactionToStorage=function(e){var t=this;return t._$q.when(t._walletStore.put(e)).then(function(){return e},function(t){throw t.status===r&&console.error("_setTransactionToStorage["+e.data.hash+"] CONFLICT"),t})},n.prototype._getTransactionsFromSdk=function(e){var t=this,n={sort_dir:"desc",lastBlockHash:e};return t._$q.when(t._sdkWallet.transactions(n)).then(function(e){return e.data.length?e:t._$q.reject(new blocktrail.WalletPollError("NO_TX"))})},n.prototype._getTransactionsHistoryFromStorageAndTransactionsFromSdk=function(e){var t=this;return console.log("_getTransactionsHistoryFromStorageAndTransactionsFromSdk"),t._$q.all([t._$q.when(e),t._getTransactionsHistoryFromStorage(),t._getTransactionsFromSdk(e.hash)])},n.prototype._processTransactionsAndGetBalance=function(e){var t=this;return console.log("_processTransactionsAndGetBalance"),t._$q.all([t._processTransactions(e),t._getBalance()]).then(function(e){return e[0]})},n.prototype._processTransactions=function(e){var t=this;console.log("_processTransactions");var n=e[0],r=e[1],o=e[2].data,a=r.unconfirmed,i=[],l=[],c=[];return n.hash=e[2].lastBlockHash,r.unconfirmed=[],o.forEach(function(e){e.block_height?a.indexOf(e.hash)!==-1?(r.confirmed.unshift(e.hash),l.push(e),c.push(t._updateTransaction(e))):r.confirmed.indexOf(e.hash)===-1&&(r.confirmed.unshift(e.hash),i.push(e),c.push(t._addTransaction(e))):(r.unconfirmed.indexOf(e.hash)===-1&&r.unconfirmed.unshift(e.hash),a.indexOf(e.hash)===-1&&(i.push(e),c.push(t._addTransaction(e))))}),t._$q.all(c).then(function(){return{newTransactions:i,confirmedTransactions:l,lastBlockHashDoc:n,transactionHistoryDoc:r}})},n.prototype._getTransactionFromStorageByHash=function(e,t){var n=this;return n._$q.when(n._walletStore.get(n._getUniqueIdentifier("transaction",e)))["catch"](function(){return{_id:n._getUniqueIdentifier("transaction",t.hash),data:t?t:{}}})},n.prototype._addTransaction=function(e){var t=this;return t._setTransactionToStorage({_id:t._getUniqueIdentifier("transaction",e.hash),data:e})},n.prototype._updateTransaction=function(e){var t=this;return t._getTransactionFromStorageByHash(e.hash,e).then(t._updateTransactionDoc.bind(t,e)).then(t._setTransactionToStorage.bind(t))},n.prototype._updateTransactionDoc=function(e,t){return t.data=e,t},n.prototype._resetPollPromise=function(){var e=this;return e._pollPromise=null,!0},n.prototype._setLastBlockHashToStorageAndTransactionHistoryToStorage=function(e){var t=this;return console.log("_setLastBlockHashToStorageAndTransactionHistoryToStorage"),t._$q.all([t._setLastBlockHashToStorage(e.lastBlockHashDoc),t._setTransactionHistoryToStorage(e.transactionHistoryDoc)]).then(function(){return e.transactionHistoryDoc})},n.prototype._pollTransactionsCatchHandler=function(e){var t=this;return console.log("_pollTransactionsCatchHandler",e.message),"NO_TX"===e.message?t._$q.when(!0):"ORPHAN"===e.message?(console.error("ORPHAN"),t._resetWalletData().then(function(){return t._$q.when(t._getBalance.bind(t)).then(t._getBlockHeight.bind(t)).then(t._pollTransactions.bind(t))})):void t._errorHandler(e)},n.prototype._addNewTransactionsToList=function(e){var t=this;return t._$q.when(t._prepareTransactionsList(e)).then(t._processTransactionDocs.bind(t),t._errorHandler).then(t._updateTransactionsList.bind(t))},n.prototype._prepareTransactionsList=function(e){var t=this,n=e.unconfirmed.concat(e.confirmed),r=[];return n.forEach(function(e){r.push(t._getTransactionFromStorageByHash(e))}),t._$q.all(r)},n.prototype._processTransactionDocs=function(e){return e.map(function(e){return e.data})},n.prototype._updateTransactionsList=function(e){var t=this;return t._extentTransactionsWithContactsAndGlideraData(e).then(function(){return t._TX_FILTER_MIN_BLOCK_HEIGHT&&(e=e.filter(function(e){return null===e.block_height||e.block_height>=t._TX_FILTER_MIN_BLOCK_HEIGHT})),t._walletData.transactions.splice.apply(t._walletData.transactions,[0,t._walletData.transactions.length].concat(e)),t._walletData})},n.prototype._extentTransactionsWithContactsAndGlideraData=function(e){var t=this;return t._settingsService.getSettings().then(function(n){var r=[],o=n.glideraTransactions.filter(function(e){return!!e.transactionHash||"COMPLETE"===e.status});return e.forEach(function(e){e.contacts.length?r.push(t._addContactToTransaction(e,e.contacts[0])):e.contact=null;var a=!1;if(o.length&&o.forEach(function(n){var r=n.transactionHash&&n.transactionHash===e.hash,o=n.address&&e.self_addresses.indexOf(n.address)!==-1;!n.transactionHash&&o&&(n.transactionHash=e.hash,r=!0),r&&(e.buybtc={broker:"glidera",qty:n.qty,currency:n.currency,price:n.price},n.walletIdentifier||(n.walletIdentifier=t._sdkWallet.identifier,a=!0))}),a)return t._settingsService.updateGlideraTransactions(n.glideraTransactions)}),t._$q.all(r).then(function(){return e})})},n.prototype._addContactToTransaction=function(e,t){var n=this;return n._contactsService.findByHash(t).then(function(t){t?e.contact=t:e.contact=null})},n.prototype._getUniqueIdentifier=function(e,t){var n,r=this;switch(e){case"balance":n=r._walletData.uniqueIdentifier+":bc";break;case"block-height":n=r._walletData.uniqueIdentifier+":bh";break;case"addresses":n=r._walletData.uniqueIdentifier+":ad";break;case"transaction":t||r._errorHandler({message:"method _addIdPrefix, id for transaction should be defined"}),n=r._walletData.uniqueIdentifier+":tx:"+t;break;case"transactions-history":n=r._walletData.uniqueIdentifier+":th";break;case"last-block-hash":n=r._walletData.uniqueIdentifier+":lh";break;default:r._errorHandler({message:"method _addIdPrefix, type of prefix should be defined"})}return n},n.prototype._errorHandler=function(e){throw new Error(e.message)},n.prototype.validateAddress=function(e){var t=this;return t._$q.when(t._sdkWallet).then(function(t){return t.decodeAddress(e).address})},n.prototype.unlockWithPassword=function(e){var t=this;return t._$q.when(t._sdkWallet).then(function(t){return t.unlock({password:e}).then(function(){return t})})},n.prototype.refillOfflineAddresses=function(t){var n=this;return n.isRefilling?n.addressRefillPromise:(n.isRefilling=!0,n.addressRefillPromise=n._walletStore.get(n._getUniqueIdentifier("addresses")).then(function(e){return e},function(){return{_id:n._getUniqueIdentifier("addresses"),available:[]}}).then(function(e){var o=n._amountOfOfflineAddresses-e.available.length,a=Math.min(o,t,5);return a>0?Q.all(repeat(a,function(t){return n._sdkWallet.getNewAddress().then(function(t){e.available.push(t[0])})})).then(function(){n._walletStore.get(n._getUniqueIdentifier("addresses")).then(function(e){return e},function(e){return{_id:n._getUniqueIdentifier("addresses"),available:[]}}).then(function(t){return t.available=t.available.concat(e.available).unique(),n._walletStore.put(t)["catch"](function(e){throw e.status===r&&console.error("refillOfflineAddresses CONFLICT"),e})}).then(function(){return n.isRefilling=!1,!0})}):(n.isRefilling=!1,!0)})["catch"](function(t){return n.isRefilling=!1,n._$q.reject(e)}))},n.prototype.getNewAddress=function(){var e=this;return e.getNewOfflineAddress().then(function(e){return e},function(){return e._sdkWallet.getNewAddress().then(function(e){return e[0]})})},n.prototype.getNewOfflineAddress=function(){var e=this;return e._walletStore.get(e._getUniqueIdentifier("addresses")).then(function(t){var n=t.available.shift();return n?e._walletStore.put(t).then(function(){return n},function(e){throw e.status===r&&console.error("getNewOfflineAddress CONFLICT"),e}):e._$q.reject("no more offline addresses")},function(e){throw e})}}(),function(){"use strict";function e(e,t,n,r){var o=this;o._$q=e,o._CONFIG=t,o._sdkService=n,o._walletService=r,o._wallets={},o._walletsList=[],o._activeWallet=null}angular.module("blocktrail.core").factory("walletsManagerService",["$q","CONFIG","sdkService","walletService",function(t,n,r,o){return new e(t,n,r,o)}]),e.prototype.fetchWalletsList=function(){var e=this;return e._sdkService.getSdkByActiveNetwork().getAllWallets({mywallet:1,limit:200}).then(function(t){return e._walletsList=[],t.data.forEach(function(t){e._CONFIG.NETWORKS_ENABLED.indexOf(t.network)!==-1&&(t.uniqueIdentifier=e._getWalletUniqueIdentifier(t.network,t.identifier),e._walletsList.push(t))}),e._walletsList})},e.prototype.getWalletsList=function(){var e=this;return e._walletsList},e.prototype.getActiveWallet=function(){var e=this;return e._activeWallet},e.prototype.setActiveWalletByNetworkTypeAndIdentifier=function(e,t){var n=this,r=n._getWalletUniqueIdentifier(e,t);if(!e)throw new TypeError("Blocktrail core module, wallets manager service. Network type should be defined.");if(!t)throw new TypeError("Blocktrail core module, wallets manager service. Identifier should be defined.");if(!n._isExistingWalletByUniqueIdentifier(r)){var o=n._filterWalletsByNetworkType(e);if(!o.length)throw new TypeError("Blocktrail core module, wallets manager service. No wallets for "+e+" network type.");t=o[0].identifier,r=n._getWalletUniqueIdentifier(e,t)}return n._setActiveWallet(e,t,r)},e.prototype.setActiveWalletByUniqueIdentifier=function(e){var t=this,n=t._walletsList.filter(function(t){return t.uniqueIdentifier===e})[0];if(!n)throw new Error("Blocktrail core module, wallets manager service. Wallet with unique identifier "+e+" is not exist.");return t._setActiveWallet(n.network,n.identifier,n.uniqueIdentifier)},e.prototype._setActiveWallet=function(e,t,n){var r=this,o=null;return r._activeWallet?r._activeWallet.getReadOnlyWalletData().uniqueIdentifier!==n?(r._activeWallet.disablePolling(),r._wallets[n]?(r._wallets[n].enablePolling(),r._activeWallet=r._wallets[n],o=r._$q.when(r._activeWallet)):o=r._initWallet(e,t,n)):o=r._$q.when(r._activeWallet):o=r._initWallet(e,t,n),r._$q.when(o)},e.prototype._initWallet=function(e,t,n){var r=this;return r._walletService.initWallet(e,t,n).then(function(e){return r._wallets[e.getReadOnlyWalletData().uniqueIdentifier]=e,r._activeWallet=r._wallets[e.getReadOnlyWalletData().uniqueIdentifier],r._activeWallet})},e.prototype._isExistingWalletByUniqueIdentifier=function(e){var t=this;return!!t._walletsList.filter(function(t){return t.uniqueIdentifier===e}).length},e.prototype._filterWalletsByNetworkType=function(e){var t=this;return t._walletsList.filter(function(t){return t.network===e})},e.prototype._getWalletUniqueIdentifier=function(e,t){return e+"_"+t}}(),function(){"use strict";function e(e,t,n){e.CONFIG=t,e.bannedIp=n.bannedIp}e.$inject=["$scope","CONFIG","$stateParams"],angular.module("blocktrail.setup").controller("BannedIpCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d,p){function f(t,n){return i.alert({title:u.instant("CHANGE_PASSWORD"),bodyHtml:o.trustAsHtml(u.instant("CHANGE_PASSWORD_BACKUP")),ok:u.instant("BACKUP_DOWNLOAD_ADDITIONAL_PAGE_PDF")}).result.then(function(){var r=new blocktrailSDK.BackupGenerator(t,{encryptedSecret:n},{},{page1:!1,page2:!0,page3:!1});try{r.generatePDF(function(n,r){n?(l.error(n),e.alert({title:u.instant("ERROR"),body:""+n})):r.save("BlockTrail Additional Recovery Data Sheet - "+t+".pdf")})}catch(o){l.error("Backup generation error",o)}})}function g(){return i.prompt(u.instant("SETUP_LOGIN"),u.instant("MSG_MISSING_TWO_FACTOR_TOKEN")).result.then(function(e){
_=e})}e.bip39EN=blocktrailSDK.bip39wordlist,e.stepCount=0,e.working=!1,e.error=null,e.form={email:"",ERS:"",newPassword:"",newPasswordRepeat:"",passwordCheck:null},e.walletVersions=["v1","v2","v3"];var h=null,_=null,S=t.token,m=t.version,y="1"===t.requires_2fa,w=p.requestRecoverySecret(S),E=e.$watch("form.ERS",function(t,n){function r(e,t){return e<t?-1:e>t?1:0}if(e.form.ERS&&e.form.ERS.length>0&&(e.form.ERS=e.form.ERS.replace(/[\r\n]+/g," ")),t&&n){var o=n.split(" ");1==t.split(" ").length&&o.length>1&&(delete o[o.length-1],r(n,t+" "+t[0])?e.form.ERS=o.join(" ")+t+" ":e.form.ERS=o.join(" ").slice(0,-1))}});e.checkPassword=function(){return e.form.newPassword!==e.form.newPasswordRepeat?(e.form.passwordCheck={score:-1},r.when(!1)):e.form.newPassword&&e.form.newPasswordRepeat?a.checkPassword(e.form.newPassword,[e.form.email,"BTC.com","wallet"]).then(function(t){return t.duration=c("duration")(1e3*t.crack_times_seconds.online_no_throttling_10_per_second),e.form.passwordCheck=t,t}):(e.form.passwordCheck=null,r.when(!1))},e.encryptNewERS=function(){e.checkPassword().then(function(t){if(t===!1)return i.alert(u.instant("RECOVERY_ERROR"),u.instant("MSG_BAD_PASSWORD_REPEAT")).result;if(t.score<d.REQUIRED_PASSWORD_STRENGTH)return i.alert(u.instant("RECOVERY_ERROR"),u.instant("MSG_WEAK_PASSWORD")).result;if(y&&!_)return g().then(function(){e.encryptNewERS()});var r=p.encryptSecretWithPassword(h,e.form.newPassword,m),o={token:S,new_password_hash:r.password_hash,new_encrypted_secret:r.encrypted_secret,password_score:t.score};y&&_&&(o.two_factor_token=_),n.post(d.API_URL+"/v1/"+d.API_NETWORK+"/recovery/change-password",o).then(function(t){f("",r.secret_mnemonic),e.stepCount=2},function(e){return _=null,e.data&&e.data.msg&&"invalid recovery token"===e.data.msg?i.alert(u.instant("INVALID_RECOVERY_TOKEN"),u.instant("MSG_INVALID_RECOVER_TOKEN")).result:e.data&&e.data.msg&&"invalid 2FA token"===e.data.msg?(_=null,i.alert(u.instant("BAD_TOKEN"),u.instant("MSG_BAD_TOKEN")).result):i.alert(u.instant("RECOVERY_ERROR"),u.instant("MSG_CHANGE_PASSWORD_UNKNOWN_ERROR")).result})})},e.decryptERS=function(){return!e.working&&(e.error=null,e.working=!0,void(e.form.ERS.length>0&&w.then(function(t){try{t=t.trim();var n=e.form.ERS.trim().replace(new RegExp("\r\n","g")," ").replace(new RegExp("\n","g")," ").replace(/\s\s+/g," ").replace("[ \t]+$","");if(e.walletVersions.indexOf(m)<0)return e.working=!1,i.alert(u.instant("INVALID_WALLET_VERSION"),u.instant("MSG_INVALID_WALLET_VERSION")).result;if(64!==t.length)return e.working=!1,i.alert(u.instant("RECOVERY_ERROR"),u.instant("MSG_CORRUPTED_SECRET")).result;try{var r=p.decryptSecretMnemonicWithPassword(n,t,m);h=r[0];r[1]}catch(o){return l.error(o,o.message),e.working=!1,i.alert(u.instant("RECOVERY_ERROR"),u.instant("MSG_RECOVERY_DECRYPT_FAILED")).result}E(),e.stepCount=1,e.working=!1}catch(o){e.working=!1,l.error(o,o.message)}})))}}e.$inject=["$scope","$stateParams","$http","$q","$sce","passwordStrengthService","dialogService","$log","$filter","sdkService","$translate","CONFIG","passwordRecoveryService"],angular.module("blocktrail.setup").controller("SetupChangePasswordCtrl",e)}(),function(){"use strict";function e(e,t,n){e.mobileOs=n.android?"android":n.ios?"ios":"both",e.dismiss=function(){t.close()}}e.$inject=["$scope","$modalInstance","bowserJS"],angular.module("blocktrail.setup").controller("SetupDownloadMobileModalController",e)}(),function(){"use strict";function e(e,t,n,r){e.working=!1,e.error=null,e.form={email:null},e.stepCount=0,e.doForgotPass=function(o){return!e.working&&(e.error=null,!o.$invalid&&(e.working=!0,void t.requestRecoveryMail(e.form.email).then(function(){e.stepCount=1,e.working=!1})["catch"](function(t){if(t&&t.data&&t.data.error&&"v2"===t.data.error)return e.working=!1,n.alert(r.instant("RECOVERY_ERROR"),r.instant("MSG_RECOVERY_V2_UPGRADED")).result})))}}e.$inject=["$scope","passwordRecoveryService","dialogService","$translate"],angular.module("blocktrail.setup").controller("SetupForgotPasswordCtrl",e)}(),function(){"use strict";function e(e,t){e.CONFIG=t}e.$inject=["$scope","CONFIG"],angular.module("blocktrail.setup").controller("SetupLoggedoutCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c){function s(t,n){e.error=null,e.errorDetailed=null,t.networkType!==n.networkType&&c.setNetworkType(t.networkType)}function u(t){return e.error=null,e.errorDetailed=null,i.setAllDirty(t),!t.$invalid&&(e.isLoading=!0,_=null,void d())}function d(){var t={login:e.form.username,password:e.form.password,twoFactorToken:_,networkType:e.form.networkType};return l.login(t).then(p,f)}function p(t){e.form.forceNewWallet||(e.setupInfo.identifier=t.existing_wallet||e.setupInfo.identifier),e.setupInfo.password=e.form.password,e.setupInfo.network=e.form.network,n.go("app.setup.wallet")}function f(o){switch(o.type){case"BANNED_IP":n.go("app.bannedip",{bannedIp:o.data});break;case"SHA_512":return a.alert({title:t.instant("SETUP_LOGIN_FAILED"),bodyHtml:r.trustAsHtml(t.instant("MSG_UPGRADE_REQUIRED"))});case"2FA_MISSING":return a.prompt(t.instant("SETUP_LOGIN"),t.instant("MSG_MISSING_TWO_FACTOR_TOKEN")).result.then(function(e){return _=e,d()},function(t){throw e.isLoading=!1,t});case"2FA_INVALID":return a.prompt(t.instant("SETUP_LOGIN"),t.instant("MSG_INCORRECT_TWO_FACTOR_TOKEN")).result.then(function(e){return _=e,d()},function(t){throw e.isLoading=!1,t});case"MSG_BAD_LOGIN":e.error="MSG_BAD_LOGIN",e.isLoading=!1;break;case"MSG_BAD_LOGIN_UNKNOWN":e.error="MSG_BAD_LOGIN_UNKNOWN",e.errorDetailed=o.data,e.isLoading=!1}}function g(){h&&h(),e.alert.dismiss()}var h,_=null;e.showMobileDialogOnce(),e.alert=a.alertSingleton(),e.isDebugMode=o.DEBUG,e.isLoading=!1,e.error=null,e.errorDetailed=null,e.form={username:"",password:"",forceNewWallet:!1,networkType:c.getNetworkType()},h=e.$watch("form",s,!0),e.$on("$destroy",g),e.onSubmitFormLogin=u}e.$inject=["$scope","$translate","$state","$sce","CONFIG","dialogService","FormHelper","loginFormService","sdkService"],angular.module("blocktrail.setup").controller("SetupLoginCtrl",e)}(),function(){"use strict";function e(e,t,n,r){if(t["continue"])e.location.replace("/#/loggedout");else{var o=r.getActiveWallet();o&&o.disablePolling(),n.resetAll().then(function(){e.location.replace("/#/logout?continue=1"),e.location.reload()})}}e.$inject=["$window","$stateParams","storageService","walletsManagerService"],angular.module("blocktrail.setup").controller("LogoutCtrl",e)}(),function(){"use strict";function e(e,t,n){"1"===t.refresh&&(n.location.replace("/#/lostlock?refresh=0"),n.location.reload())}e.$inject=["$scope","$stateParams","$window"],angular.module("blocktrail.setup").controller("LostLockCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d){function p(t,n){e.errMsg=!1,t.networkType!==n.networkType&&d.setNetworkType(t.networkType)}function f(t){return t?l.checkPassword(e.form.password,[e.form.username,e.form.email,"BTC.com","wallet"]).then(function(t){return t.duration=c("duration")(1e3*t.crack_times_seconds.online_no_throttling_10_per_second),e.form.passwordCheck=t,t}):(e.passwordCheck=null,n.when(!1))}function g(){E=u.newPoWtcha(),E.then(function(e){e.startingWorkingBG()})}function h(t){return e.errMsg=null,i.setAllDirty(t),!t.$invalid&&(e.form.termsOfService?!e.form.passwordCheck||e.form.passwordCheck.score<r.REQUIRED_PASSWORD_STRENGTH?(e.errMsg="MSG_WEAK_PASSWORD",!1):_().result.then(function(t){e.form.password===t.trim()?(e.isLoading=!0,S()):e.errMsg="MSG_BAD_PASSWORD_REPEAT"}):(e.errMsg="MSG_BAD_LEGAL",!1))}function _(){return o.prompt({title:a.instant("MSG_REPEAT_PASSWORD"),body:a.instant("SETUP_PASSWORD_REPEAT_PLACEHOLDER"),input_type:"password",icon:"key"})}function S(){return s.register(e.form,E).then(m,y)}function m(){e.setupInfo.password=e.form.password,e.isLoading=!1,t.go("app.setup.wallet")}function y(t){g(),e.errMsg=t,e.isLoading=!1}function w(){v&&v(),b&&b(),e.alert.dismiss()}var E,v,b;e.showMobileDialogOnce(),e.alert=o.alertSingleton(),e.isLoading=!1,e.errMsg=!1,e.form={email:null,password:null,passwordCheck:null,networkType:d.getNetworkType(),termsOfService:!1},v=e.$watch("form",p,!0),b=e.$watch("form.password",f,!0),e.$on("$destroy",w),e.onSubmitFormRegister=h,g()}e.$inject=["$scope","$state","$q","CONFIG","dialogService","$translate","FormHelper","passwordStrengthService","$filter","newAccountFormService","powtchaService","sdkService"],angular.module("blocktrail.setup").controller("SetupNewAccountCtrl",e)}(),function(){"use strict";function e(e,t){e["goto"]=t["goto"]}e.$inject=["$scope","$stateParams"],angular.module("blocktrail.setup").controller("SetupRebrandCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d){if(t.displayTextBackup=!0,t.backupSaved=!1,t.backupSavedCheck=!1,t.working=!1,t.qrSettings={correctionLevel:7,SIZE:150,inputMode:"M",image:!0},t.setupInfo.identifier=e.identifier,t.setupInfo.backupInfo={walletVersion:e.walletVersion,encryptedPrimarySeed:e.encryptedPrimarySeed,encryptedSecret:e.encryptedSecret,backupSeed:e.backupSeed,recoveryEncryptedSecret:e.recoveryEncryptedSecret,supportSecret:e.supportSecret},!t.setupInfo.backupInfo.blocktrailPublicKeys){var p=l.getSdkByActiveNetwork();t.setupInfo.backupInfo.blocktrailPublicKeys={},angular.forEach(e.blocktrailPublicKeys,function(e,n){t.setupInfo.backupInfo.blocktrailPublicKeys[e.keyIndex]=a.HDNode.fromBase58(e.pubKey,p.network)})}t.backupPageError=!1,t["export"]=function(){var e=[];i.getUserInfo().then(function(n){n.username&&e.push({title:"Username",value:n.username}),n.email&&e.push({title:"Email",value:n.email}),t.setupInfo.backupInfo.supportSecret&&e.push({title:"Support Secret",subtitle:"this can be shared with helpdesk to proof ownership of backup document",value:t.setupInfo.backupInfo.supportSecret});var a=new blocktrailSDK.BackupGenerator(t.setupInfo.identifier,t.setupInfo.backupInfo,e,{network:u.NETWORKS[l.getNetworkType()].NETWORK_LONG});try{a.generatePDF(function(e,n){e?(o.error(e),c.alert(e,r.instant("ERROR"),r.instant("OK"))):(t.backupSaved=!0,t.backupPDF=n,t.backupPDF.save("BTC.com "+u.NETWORKS[l.getNetworkType()].NETWORK_LONG+" Wallet Recovery Backup Sheet - "+t.setupInfo.identifier+".pdf"))})}catch(i){o.error("Backup generation error",i)}})},t["continue"]=function(){t.working||(t.working=!0,t.backupSaved&&t.backupSavedCheck?s.clearBackupInfo().then(function(){return s.getWalletInfo().then(function(e){return d.fetchWalletsList().then(function(){return d.setActiveWalletByNetworkTypeAndIdentifier(l.getNetworkType(),e.identifier)})})}).then(function(){n.go("app.wallet.summary")})["catch"](function(){t.working=!1}):t.backupPageError=r.instant("SETUP_WALLET_BACKUP_CHECKBOX"))}}e.$inject=["backupInfo","$scope","$state","$translate","$log","bitcoinJS","setupService","sdkService","dialogService","launchService","CONFIG","walletsManagerService"],angular.module("blocktrail.setup").controller("SetupWalletBackupCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d){if(t.progressStatus={},t.alert=s.alertSingleton(),t.$on("$destroy",function(){t.alert.dismiss()}),!t.setupInfo.password)return r.clearAccountInfo().then(function(){return n.go("app.setup.login")});t.setupWallet=function(){return!t.working&&(t.updateProgress({title:"LOADING_WALLET"}),t.working=!0,void t.createWallet())},t.progressWidth=5;var p={title:null,body:null,header_class:"text-neutral",ok:!1};t.updateProgress=function(e){e=angular.extend({},p,e),a.debug("updateProgress: "+e.title+" - "+e.body),l(function(){t.progressWidth+=15,t.progressWidth>=90&&(t.progressWidth=100),t.progressStatus=e})},t.createWallet=function(){return e.when(r.getAccountInfo()).then(function(e){return o.setAccountInfo(e),o.getSdkByActiveNetwork()}).then(function(e){return t.sdk=e,t.sdkReadOnlyObject=o.getReadOnlySdkData(),a.debug("initialising wallet: "+t.setupInfo.identifier,t.sdk),t.sdk.initWallet({identifier:t.setupInfo.identifier,password:t.setupInfo.password})}).then(function(e){return u.eventTrack("initWallet",{category:"Events"}),e.walletVersion!==blocktrailSDK.Wallet.WALLET_VERSION_V3?(t.updateProgress({title:"UPGRADING_WALLET",body:"UPGRADING_WALLET_BODY"}),e.upgradeToV3(t.setupInfo.password).progress(function(e){switch(e){case blocktrailSDK.CREATE_WALLET_PROGRESS_START:t.updateProgress({title:"UPGRADING_WALLET",body:"UPGRADING_WALLET_BODY"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_ENCRYPT_SECRET:t.updateProgress({title:"UPGRADING_WALLET",body:"CREATING_GENERATE_PRIMARYKEY"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_ENCRYPT_PRIMARY:t.updateProgress({title:"UPGRADING_WALLET",body:"CREATING_GENERATE_BACKUPKEY"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_ENCRYPT_RECOVERY:t.updateProgress({title:"UPGRADING_WALLET",body:"CREATING_GENERATE_RECOVERY"})}}).then(function(){return t.updateProgress({title:"UPGRADING_WALLET",body:"UPGRADING_WALLET_BODY"}),t.progressWidth=90,e})):(a.debug("wallet initialised",e),t.progressWidth=90,e)},function(n){if(n.message.match(/not found/)||n.message.match(/couldn't be found/)){a.debug("creating new wallet"),t.updateProgress({title:"CREATING_WALLET",body:"PLEASE_WAIT"});var r=(new Date).getTime();u.eventTrack("createNewWallet",{category:"Events"});var o=randDigits(6);return t.sdk.createNewWallet({walletVersion:c.DEFAULT_WALLET_VERSION,identifier:t.setupInfo.identifier,password:t.setupInfo.password,support_secret:o,keyIndex:c.DEVKEYINDEX||0}).progress(function(e){switch(e){case blocktrailSDK.CREATE_WALLET_PROGRESS_START:t.updateProgress({title:"CREATING_WALLET",body:"PLEASE_WAIT"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_ENCRYPT_SECRET:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_GENERATE_PRIMARYKEY"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_ENCRYPT_PRIMARY:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_GENERATE_BACKUPKEY"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_ENCRYPT_RECOVERY:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_GENERATE_RECOVERY"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_PRIMARY:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_INIT_KEYS"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_BACKUP:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_INIT_KEYS"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_SUBMIT:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_SUBMIT_WALLET"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_INIT:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_INIT_WALLET"});break;case blocktrailSDK.CREATE_WALLET_PROGRESS_DONE:t.updateProgress({title:"CREATING_WALLET",body:"CREATING_DONE"})}}).spread(function(n,i,l){return a.debug("new wallet created in ["+((new Date).getTime()-r)+"ms]"),t.setupInfo.backupInfo=i,t.setupInfo.backupInfo.supportSecret=o,e.when(n)})}return n.message.match(/password/)||n instanceof blocktrailSDK.WalletDecryptError?(a.debug("wallet with identifier ["+t.setupInfo.identifier+"] already exists, prompting for old password"),t.alert({title:i.instant("SETUP_EXISTING_WALLET"),body:i.instant("MSG_WALLET_PASSWORD_MISMATCH")}).result.then(function(){return t.promptWalletPassword()})):e.reject(n)}).then(function(e){var t=null;t="v2"===e.walletVersion?e.secret:e.secret.toString("hex"),r.stashWalletSecret(t),e.lock()}).then(function(){return a.debug("setting wallet as main wallet"),t.updateProgress({title:"PREPARING_WALLET"}),t.sdk.setMainMobileWallet(t.setupInfo.identifier)}).then(function(){return a.debug("saving wallet info",t.setupInfo.identifier,null),r.storeWalletInfo(t.setupInfo.identifier,t.sdkReadOnlyObject.networkType)}).then(function(){if(t.setupInfo.password=null,t.setupInfo.backupInfo){a.debug("saving backup info");var e=[];return angular.forEach(t.setupInfo.backupInfo.blocktrailPublicKeys,function(t,n){e.push({keyIndex:n,pubKey:t.toBase58()})}),r.storeBackupInfo({identifier:t.setupInfo.identifier,walletVersion:t.setupInfo.backupInfo.walletVersion,encryptedPrimarySeed:t.setupInfo.backupInfo.encryptedPrimarySeed,encryptedSecret:t.setupInfo.backupInfo.encryptedSecret,backupSeed:t.setupInfo.backupInfo.backupSeed,recoveryEncryptedSecret:t.setupInfo.backupInfo.recoveryEncryptedSecret,blocktrailPublicKeys:e,supportSecret:t.setupInfo.backupInfo.supportSecret})}}).then(function(){a.debug("All done. Onwards to victory!"),t.setupInfo.backupInfo?(d.trackEvent(d.EVENTS.SIGN_UP),n.go("app.setup.walletBackup")):(d.trackEvent(d.EVENTS.LOGIN),n.go("app.wallet.summary"))})["catch"](function(e){return a.error(e),t.working=!1,"CANCELLED"!=e&&"dismiss"!=e&&void(t.progressStatus={title:"FAIL",header_class:"text-bad",body:e.toString()})})},t.promptWalletPassword=function(){return s.prompt({title:i.instant("SETUP_WALLET_PASSWORD"),body:i.instant("MSG_WALLET_PASSWORD"),input_type:"password",icon:"key"}).result.then(function(n){return t.setupInfo.password=n.trim(),a.debug("re-initialising wallet with new password: "+t.setupInfo.identifier),t.sdk.initWallet({identifier:t.setupInfo.identifier,password:t.setupInfo.password}).then(function(t){return e.when(t)},function(n){return n.message.match(/password/)||n instanceof blocktrailSDK.WalletDecryptError?t.alert(i.instant("MSG_BAD_PWD"),i.instant("MSG_TRY_AGAIN")).result.then(function(){return t.promptWalletPassword()}):e.reject(n)})},function(){return e.reject("CANCELLED")})},t.setupWallet()}e.$inject=["$q","$scope","$state","launchService","sdkService","$log","$translate","$timeout","CONFIG","dialogService","$analytics","trackingService"],angular.module("blocktrail.setup").controller("SetupWalletInitCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o){var a=!!r.mobile;e.showMobileDialogOnce=function(){a&&(e.showMobileDialog=!1,t.open({controller:"SetupDownloadMobileModalController",templateUrl:"js/modules/setup/controllers/download-mobile-modal/download-mobile-modal.tpl.html"}))},e.setupInfo={identifier:n.DEFAULT_IDENTIFIER+"-"+o(8).toString("hex"),password:"",primaryMnemonic:"",backupMnemonic:"",blocktrailPublicKeys:null}}e.$inject=["$scope","$modal","CONFIG","bowserJS","randomBytesJS"],angular.module("blocktrail.setup").controller("SetupWrapperCtrl",e)}(),function(){"use strict";function e(e,t){return{restrict:"E",transclude:!0,scope:{},templateUrl:"js/modules/setup/directives/landing-page/landing-page.tpl.html",link:function(n){n.CONFIG=e,n.$state=t}}}e.$inject=["CONFIG","$state"],angular.module("blocktrail.core").directive("landingPage",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s){var u=this;u._$http=e,u._$q=t,u._lodash=n,u._cryptoJS=r,u._navigator=o,u._CONFIG=a,u._launchService=i,u._setupService=l,u._sdkService=c,u._trackingService=s}angular.module("blocktrail.setup").factory("loginFormService",["$http","$q","_","cryptoJS","navigator","CONFIG","launchService","setupService","sdkService","trackingService",function(t,n,r,o,a,i,l,c,s,u){return new e(t,n,r,o,a,i,l,c,s,u)}]),e.prototype.login=function(e){var t=this,n={login:e.login,password:t._cryptoJS.SHA512(e.password).toString(),platform:"Web",version:t._CONFIG.VERSION||t._CONFIG.VERSION_REV,two_factor_token:e.twoFactorToken,device_name:t._navigator.userAgent||"Unknown Browser",browser_fingerprint:null},r=t._CONFIG.API_URL+"/v1/"+e.networkType+"/mywallet/enable";return t._$q.when(n).then(function(e){return t._trackingService.getBrowserFingerprint().then(function(t){return e.browser_fingerprint=t.hash,e},function(){return e})}).then(function(n){return t._$http.post(r,n).then(t._decryptSecret.bind(t,e.password)).then(t._storeAccountInfo.bind(t))})["catch"](t._errorHandler.bind(t))},e.prototype._decryptSecret=function(e,t){var n=this,r=null;if(t.data.encrypted_secret){try{r=n._cryptoJS.AES.decrypt(t.data.encrypted_secret,e).toString(n._cryptoJS.enc.Utf8)}catch(o){r=null}r&&44===r.length||(r=null)}return{responseData:t.data,secret:r}},e.prototype._storeAccountInfo=function(e){var t=this,n=t._lodash.merge({},{secret:e.secret},e.responseData);return t._launchService.storeAccountInfo(n).then(function(){return t._setupService.setUserInfo({username:e.responseData.username,displayName:e.responseData.username,email:e.responseData.email})}).then(function(){return e.responseData})},e.prototype._errorHandler=function(e){var t={type:"MSG_BAD_NETWORK",data:null};if(e.data){var n=blocktrailSDK.Request.handleFailure(e.data);n.is_banned?(t.type="BANNED_IP",t.data=t.is_banned):n.requires_sha512?t.type="SHA_512":n instanceof blocktrailSDK.WalletMissing2FAError?t.type="2FA_MISSING":n instanceof blocktrailSDK.WalletInvalid2FAError||n.message&&n.message.match(/invalid two-factor/)?t.type="2FA_INVALID":t.type="MSG_BAD_LOGIN"}else t&&(t.type="MSG_BAD_LOGIN_UNKNOWN",t.data=""+(t.message||t.msg||t),t.data===""+{}&&(t.data=null));return this._$q.reject(t)}}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u){var d=this;d._$http=e,d._$q=t,d._lodash=n,d._cryptoJS=r,d._navigator=o,d._CONFIG=a,d._launchService=i,d._setupService=l,d._sdkService=c,d._trackingService=s,d._powtchaService=u}angular.module("blocktrail.setup").factory("newAccountFormService",["$http","$q","_","cryptoJS","navigator","CONFIG","launchService","setupService","sdkService","trackingService","powtchaService",function(t,n,r,o,a,i,l,c,s,u,d){return new e(t,n,r,o,a,i,l,c,s,u,d)}]),e.prototype.register=function(e,t){var n=this,r={username:null,email:e.email,password:n._cryptoJS.SHA512(e.password).toString(),password_score:e.passwordCheck&&e.passwordCheck.score||0,platform:"Web",version:n._CONFIG.VERSION||n._CONFIG.VERSION_REV,device_name:n._navigator.userAgent||"Unknown Browser",super_secret:n._CONFIG.SUPER_SECRET||null,powtcha:null,browser_fingerprint:null},o=n._CONFIG.API_URL+"/v1/"+e.networkType+"/mywallet/register";return t.then(function(e){return e.findNonce().then(function(e){return r.powtcha=e,r})}).then(function(e){return n._trackingService.getBrowserFingerprint().then(function(t){return e.browser_fingerprint=t.hash,e},function(){return e})}).then(function(e){return n._$http.post(o,e).then(n._storeAccountInfo.bind(n))})["catch"](n._errorHandler.bind(n))},e.prototype._storeAccountInfo=function(e){var t=this,n=t._lodash.merge({},e.data);return t._launchService.storeAccountInfo(n).then(function(){return t._setupService.setUserInfo({username:e.data.username,displayName:e.data.username,email:e.data.email})}).then(function(){return e.data})},e.prototype._errorHandler=function(e){var t;return t=e.data.msg.toLowerCase().match(/username exists/)?"MSG_USERNAME_TAKEN":e.data.msg.toLowerCase().match(/already in use/)?"MSG_EMAIL_TAKEN":e.data.msg,this._$q.reject(t)}}(),function(){"use strict";function e(e){e.state("app.wallet",{"abstract":!0,url:"/wallet",controller:"WalletCtrl",templateUrl:"js/modules/wallet/controllers/wallet/wallet.tpl.html",resolve:{globalLock:t,handleSetupState:n,checkApiKeyStatus:r,activeWallet:o,loadingData:a}}).state("app.wallet.summary",{url:"",views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/wallet-summary/wallet-summary.tpl.html",controller:"WalletSummaryCtrl"}}}).state("app.wallet.send",{url:"/send",cache:!1,params:{protocol:null,address:null,amount:null},views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/send/send.tpl.html",controller:"SendCtrl"}}}).state("app.wallet.handleURI",{url:"/handleURI/:scheme",cache:!1,views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/payment-uri/payment-uri.tpl.html",controller:"PaymentURICtrl"}}}).state("app.wallet.receive",{url:"/receive",cache:!1,views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/receive/receive.tpl.html",controller:"ReceiveCtrl"}}}).state("app.wallet.receive.address-lookup",{url:"/address-lookup",cache:!1,views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/address-lookup/address-lookup.tpl.html",controller:"AddressLookupCtrl"}}}).state("app.wallet.settings",{url:"/settings",cache:!0,views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/settings/settings.tpl.html",controller:"SettingsCtrl"}}}).state("app.wallet.buybtc",{url:"/buy","abstract":!0,template:"<div ui-view></div>"}).state("app.wallet.buybtc.choose",{url:"/choose",views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/buy-btc-choose/buy-btc-choose.tpl.html",controller:"BuyBTCChooseCtrl"}}}).state("app.wallet.buybtc.glidera-oauth2-callback",{url:"/glidera/oaoth2/callback",views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/buy-btc-glidera-oauth-callback/buy-btc-glidera-oauth-callback.tpl.html",controller:"BuyBTCGlideraOauthCallbackCtrl"}}}).state("app.wallet.buybtc.buy",{url:"/broker/:broker",views:{"mainView@app.wallet":{templateUrl:"js/modules/wallet/controllers/buy-btc-broker/buy-btc-broker.tpl.html",controller:"BuyBTCBrokerCtrl"}}})}function t(e){e.init()}function n(e,t){return t.handleSetupState(this.toString(),e)}function r(e,t,n,r,o,a){return e.getWalletConfig().then(function(e){var i=e.is_banned_ip;i?o.go("app.bannedip",{bannedIp:i}):e.api_key&&"ok"!==e.api_key&&(t.alert({title:r.instant("INVALID_SESSION"),bodyHtml:n("nl2br")(r.instant("INVALID_SESSION_LOGOUT_NOW"))}).result["finally"](function(){o.go("app.logout")}),a.resetAll())})}function o(e,t,n,r,o){return t.all([n.getAccountInfo(),n.getWalletInfo()]).then(function(t){var n=t[0],a=t[1];if(!a.networkType||!a.identifier)throw e.go("app.logout"),new Error("Missing networkType or identifier");return r.setAccountInfo(n),r.setNetworkType(a.networkType),o.fetchWalletsList().then(function(){var e=o.getActiveWallet();return e?r.setNetworkType(e.getReadOnlyWalletData().networkType):e=o.setActiveWalletByNetworkTypeAndIdentifier(a.networkType,a.identifier),e})}).then(function(e){var t=e.getReadOnlyWalletData();return n.storeWalletInfo(t.identifier,t.networkType).then(function(){return e})})}function a(e,t,n,r,o,a,i){return t.all([o.updatePrices(!0),e.getSettings()]).then(function(e){return r.debug("Initial load complete"),n.bitcoinPrices=e[0],n.changeLanguage(e[1].language),!0})}e.$inject=["$stateProvider"],t.$inject=["globalLockService"],n.$inject=["$state","launchService"],r.$inject=["launchService","dialogService","$filter","$translate","$state","storageService"],o.$inject=["$state","$q","launchService","sdkService","walletsManagerService"],a.$inject=["settingsService","$q","$rootScope","$log","Currencies","activeWallet","handleSetupState"],angular.module("blocktrail.wallet").config(e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u){e.broker=o.broker,e.brokerNotExistent=!1,e.initializing=!0,e.fetchingMainPrice=!0,e.priceBTC=null,e.fetchingInputPrice=!1,e.fiatFirst=!1,e.buyInput={currencyType:null,fiatCurrency:"USD",amount:null,btcValue:null,fiatValue:null,feeValue:null,feePercentage:null},e.currencies=[],e.altCurrency={};var d=200,p=null,f=null;switch(e.broker){case"glidera":u.trackEvent(u.EVENTS.BUYBTC.GLIDERA_OPEN),e.buyInput.currencyType="USD",e.buyInput.fiatCurrency="USD";break;default:return null}var g=function(){switch(e.broker){case"glidera":return r;default:return null}},h=function(){switch(e.broker){case"glidera":return e.currencies=[{code:"USD",symbol:"USD"}],!0;default:return!1}},_=function(){return e.fetchingMainPrice=!0,null==g()?(e.brokerNotExistent=!0,e.initializing=!1,e.fetchingMainPrice=!1,null):g().buyPrices(1,null).then(function(t){e.priceBTC=t.total,e.fetchingMainPrice=!1})};e.triggerUpdate=function(){clearTimeout(p),p=setTimeout(function(){e.updateInputPrice()["catch"](function(){e.fetchingInputPrice=!1})},d)},e.updateInputPrice=function(){return a.when(!0).then(function(){if(e.fetchingInputPrice=!0,"BTC"===e.buyInput.currencyType){if(e.fiatFirst=!1,e.buyInput.btcValue=parseFloat(e.buyInput.amount||0)||0,e.buyInput.fiatValue=null,e.buyInput.feeValue=null,e.altCurrency={},!e.buyInput.amount||!e.buyInput.btcValue)return;return g().buyPrices(e.buyInput.btcValue,null).then(function(t){i(function(){f=t,e.buyInput.fiatValue=parseFloat(t.total),isNaN(e.buyInput.fiatValue)&&(e.buyInput.fiatValue=null),t.fees&&(e.buyInput.feeValue=parseFloat(t.fees)),t.fees&&(e.buyInput.feePercentage=e.buyInput.feeValue/e.buyInput.fiatValue*100),e.altCurrency={code:e.buyInput.fiatCurrency,amount:e.buyInput.fiatValue},e.fetchingInputPrice=!1})})}if(e.fiatFirst=!0,e.buyInput.fiatValue=parseFloat(e.buyInput.amount||0)||0,e.buyInput.btcValue=null,e.buyInput.feeValue=null,e.altCurrency={},e.buyInput.amount&&e.buyInput.fiatValue)return g().buyPrices(null,e.buyInput.fiatValue).then(function(t){i(function(){f=t,e.buyInput.btcValue=parseFloat(t.qty),isNaN(e.buyInput.btcValue)&&(e.buyInput.btcValue=null),t.fees&&(e.buyInput.feeValue=parseFloat(t.fees)),t.fees&&(e.buyInput.feePercentage=e.buyInput.feeValue/e.buyInput.fiatValue*100),e.altCurrency={code:"BTC",amount:e.buyInput.btcValue},e.fetchingInputPrice=!1})})})},e.updateCurrentType=function(t){h(),e.currencies.unshift({code:"BTC",symbol:"BTC"}),e.currencies=e.currencies.filter(function(e){return e.code!==t}),"BTC"===t?e.buyInput.fiatCurrency===e.buyInput.currencyType?e.buyInput.amount=e.buyInput.btcValue:e.buyInput.amount=null:e.buyInput.fiatCurrency===t?e.buyInput.amount=e.buyInput.fiatValue:(e.buyInput.amount=null,e.buyInput.fiatCurrency=t),e.buyInput.currencyType=t,e.updateInputPrice()},e.updateCurrentType("BTC");var S,m=function(){_().then(function(){i(function(){e.initializing=!1})}),S=l(function(){_(),e.updateInputPrice()},6e4)};e.$on("$destroy",function(){S&&l.cancel(S)}),i(function(){m()}),e.buyBTC=function(){var o,a=e.buyInput.btcValue,i=e.buyInput.fiatValue;if(i+a<=0)return n.prompt({body:c.instant("MSG_BUYBTC_ZERO_AMOUNT"),title:c.instant("MSG_BUYBTC_CONFIRM_TITLE"),prompt:!1}).result;switch(e.broker){case"glidera":return r.buyPricesUuid(a,i).then(function(a){return u.trackEvent(u.EVENTS.BUYBTC.GLIDERA_BUY_CONFIRM),n.prompt({body:c.instant("MSG_BUYBTC_CONFIRM_BODY",{qty:s("number")(a.qty,6),price:s("number")(a.total,2),fee:s("number")(a.fees,2),currencySymbol:s("toCurrencySymbol")(e.buyInput.fiatCurrency)}),title:c.instant("MSG_BUYBTC_CONFIRM_TITLE"),prompt:!1}).result.then(function(){return o=n.spinner({title:"BUYBTC_BUYING"}),r.buy(a.qty,a.priceUuid).then(function(){o.close(),u.trackEvent(u.EVENTS.BUYBTC.GLIDERA_BUY_DONE),n.alert({body:c.instant("MSG_BUYBTC_BOUGHT_BODY",{qty:s("number")(a.qty,6),price:s("number")(a.total,2),fee:s("number")(a.fees,2),currencySymbol:s("toCurrencySymbol")("USD")}),title:c.instant("MSG_BUYBTC_BOUGHT_TITLE")}),t.go("app.wallet.summary")},function(e){throw u.trackEvent(u.EVENTS.BUYBTC.GLIDERA_BUY_ERR),e})})}).then(function(){},function(e){o&&o.close(),"CANCELLED"!=e&&"dismiss"!=e&&n.alert({title:"ERROR_TITLE_1",body:""+e})})}},e.$watch("broker",function(){g()})}e.$inject=["$scope","$state","dialogService","glideraService","$stateParams","$q","$timeout","$interval","$translate","$filter","trackingService"],angular.module("blocktrail.core").controller("BuyBTCBrokerCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i){function l(){c(e.currentPage,e.itemsPerPage,e.searchSortOrder,e.searchText,e.checkOnlyUsed,e.checkOnlyLabeled).then(function(t){e.items=t.data,e.totalItems=t.total,e.pagesCount=Math.ceil(e.totalItems/e.itemsPerPage),e.isLoading=!1,f=e.$watchGroup(["searchText","checkOnlyUsed","checkOnlyLabeled","currentPage"],s)})}function c(e,t,n,r,i,l){r||(r="");var c=[r,t,n,i,l,e].join(":"),s=g.get(c);return a.when(s).then(function(a){if(a)return a;var s={page:e,limit:t,sort_dir:n,hide_unused:i,hide_unlabeled:l};return r.length>0&&(s.search=r,s.search_label=r),o.getSdkWallet().addresses(s).then(function(e){return g.put(c,e),e})})}function s(t,n){t!==n&&(e.isPageLoading=!0,c(e.currentPage,e.itemsPerPage,e.searchSortOrder,e.searchText,e.checkOnlyUsed,e.checkOnlyLabeled).then(function(t){e.items=t.data,e.totalItems=t.total,e.pagesCount=Math.ceil(e.totalItems/e.itemsPerPage),e.isPageLoading=!1}))}function u(t){return n.prompt({title:r.instant("EDIT_LABEL"),body:r.instant("ENTER_NEW_LABEL"),input_type:"text",icon:"",prefill:e.items[t].label||""}).result.then(function(n){return n.length>100?void e.alert({title:r.instant("EDIT_LABEL"),body:r.instant("LABEL_MAX_LENGTH_INFO"),
ok:r.instant("OK")}):o.getSdkWallet().labelAddress(e.items[t].address,n).then(function(){return g.removeAll(),e.items[t].label=n,o.forcePolling()})["catch"](function(e){})})}function d(t){return n.alert({title:r.instant("DELETE_LABEL"),body:r.instant("CONFIRM_DELETE_LABEL_QUESTION"),ok:r.instant("OK"),cancel:r.instant("CANCEL")}).result.then(function(){return o.getSdkWallet().labelAddress(e.items[t].address,"").then(function(){return g.removeAll(),e.items[t].label="",o.forcePolling()})})}function p(){g.removeAll(),f&&f()}var f,g=i.get("address-lookup")||i("address-lookup",{capacity:10});t.pageTitle="ADDRESS_LOOKUP",e.items=[],e.totalItems=null,e.itemsPerPage=15,e.currentPage=1,e.searchText="",e.isLoading=!0,e.isPageLoading=!1,e.checkOnlyUsed=!1,e.checkOnlyLabeled=!1,e.searchSortOrder="asc",e.alert=n.alertSingleton(),e.addLabel=u,e.removeLabel=d,e.$on("$destroy",p),l()}e.$inject=["$scope","$rootScope","dialogService","$translate","activeWallet","$q","$cacheFactory"],angular.module("blocktrail.wallet").controller("AddressLookupCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u){var d=a.getReadOnlySettingsData();t.brokers=[],t.chooseRegion=null,e.all([,c.regions().then(function(e){t.regions=e}),c.usStates().then(function(e){t.usStates=e})]).then(function(){return t.chooseRegion=r.defaults({},d.buyBTCRegion,{code:null,name:null}),c.regionBrokers(t.chooseRegion.code).then(function(e){t.brokers=e,t.chooseRegion.regionOk=t.brokers.length})}),t.selectRegion=function(e,n){s.debug("selectRegion: "+e+" ("+n+")"),t.chooseRegion.code=e,t.chooseRegion.name=n,c.regionBrokers(t.chooseRegion.code).then(function(e){t.brokers=e,t.chooseRegion.regionOk=t.brokers.length,t.chooseRegion.regionOk?u.trackEvent(u.EVENTS.BUYBTC.REGION_OK):u.trackEvent(u.EVENTS.BUYBTC.REGION_NOTOK);var n={buyBTCRegion:r.defaults({},t.chooseRegion)};return a.updateSettingsUp(n)})},t.goBuyBTCState=function(e){n.go("app.wallet.buybtc.buy",{broker:e})},t.goGlideraBrowser=function(){l.userCanTransact().then(function(e){return e?void n.go("app.wallet.buybtc.buy",{broker:"glidera"}):l.accessToken().then(function(e){if(e){if(2==d.glideraAccessToken.userCanTransactInfo.code)return u.trackEvent(u.EVENTS.BUYBTC.GLIDERA_SETUP_UPDATE),o.prompt({body:i.instant("MSG_BUYBTC_SETUP_MORE_GLIDERA_BODY",{message:d.glideraAccessToken.userCanTransactInfo.message}),title:i.instant("MSG_BUYBTC_SETUP_MORE_GLIDERA_TITLE"),prompt:!1}).result.then(function(){return l.setup()},function(){});throw d.glideraAccessToken.userCanTransactInfo?new Error("User can't transact because: "+d.glideraAccessToken.userCanTransactInfo.message):new Error("User can't transact for unknown reason!")}return u.trackEvent(u.EVENTS.BUYBTC.GLIDERA_SETUP_INIT),o.prompt({body:i.instant("MSG_BUYBTC_SETUP_GLIDERA_BODY"),title:i.instant("MSG_BUYBTC_SETUP_GLIDERA_TITLE"),prompt:!1}).result.then(function(){return l.oauth2()},function(){})})}).then(function(){},function(e){o.isCancel(e)||alert(e)})},t.resetBuyBTC=function(){return e.when().then(function(){var e={glideraAccessToken:null,buyBTCRegion:null,glideraTransactions:[]};return a.updateSettingsUp(e)}).then(function(){n.go("app.wallet.summary")},function(e){alert(e)})}}e.$inject=["$q","$scope","$state","_","dialogService","settingsService","$translate","glideraService","buyBTCService","$log","trackingService"],angular.module("blocktrail.core").controller("BuyBTCChooseCtrl",e)}(),function(){"use strict";function e(e){e.usSelected=!1,e.selectUS=function(){e.usSelected=!0}}e.$inject=["$scope"],angular.module("blocktrail.core").controller("BuyBTCChooseRegionCtrl",e)}(),function(){"use strict";function e(e,t){t.handleOauthCallback(window.location.href).then(function(){return t.userCanTransact().then(function(t){t?e.go("app.wallet.buybtc.buy",{broker:"glidera"}):e.go("app.wallet.buybtc.choose")})},function(t){console.error(""+t),e.go("app.wallet.buybtc.choose")})}e.$inject=["$state","glideraService"],angular.module("blocktrail.core").controller("BuyBTCGlideraOauthCallbackCtrl",e)}(),function(){"use strict";function e(e,t,n){e.image=n,e.croppedImage="",e.dismiss=function(){t.dismiss()},e.ok=function(){t.close(e.croppedImage)}}e.$inject=["$scope","$modalInstance","imgData"],angular.module("blocktrail.wallet").controller("ModalCropImageCtrl",e)}(),function(){"use strict";function e(e,t){var n=t.scheme,r=angular.element("<a>").attr("href",n)[0];if("bitcoin:"===r.protocol){var o=/bitcoin:([13][1-9A-HJ-NP-Za-km-z]{25,34})/,a=o.exec(n)[1],i=parseQuery(n);i.amount||a?e.go("app.wallet.send",{protocol:r.protocol.slice(0,-1),amount:i.amount,address:a}):e.go("app.wallet.summary")}}e.$inject=["$state","$stateParams"],angular.module("blocktrail.wallet").controller("PaymentURICtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c){function s(){u(y),n.when(p()).then(function(){f(),_=e.$watchGroup(["newRequest.btcValue","newRequest.address","currencyType"],g),e.isLoading=!1})}function u(t){e.currencies=l.getCurrencies(),e.currencies=e.currencies.filter(function(e){return e.isFiat||e.code===y}),e.currencies=e.currencies.filter(function(e){return e.code!==t}),e.currencyType=t,d()}function d(){e.currencyType===y?(e.altCurrency.code=m.localCurrency,e.altCurrency.amount=parseFloat(i.fromBTC(e.newRequest.btcValue,m.localCurrency,2))||0):(e.altCurrency.code=y,e.altCurrency.amount=parseFloat(i.toBTC(e.newRequest.btcValue,e.currencyType,6))||0),e.altCurrency.amount>0&&c.trackEvent(c.EVENTS.RECEIVE_CUSTOM_AMOUNT)}function p(){return e.newRequest.address=null,n.when(o.getNewAddress()).then(function(t){e.newRequest.address=t})["catch"](function(e){console.log(e)})}function f(){return!!e.newRequest.address&&(e.newRequest.bitcoinUri="bitcoin:"+e.newRequest.address,e.newRequest.qrValue=0,e.currencyType===y?e.newRequest.qrValue=parseFloat(e.newRequest.btcValue):e.newRequest.qrValue=parseFloat(e.altCurrency.amount),void(isNaN(e.newRequest.qrValue)||"0.00000000"===e.newRequest.qrValue.toFixed(8)||(e.newRequest.bitcoinUri+="?amount="+e.newRequest.qrValue.toFixed(8))))}function g(e,t){e!==t&&(d(),f())}function h(){_&&_()}var _,S=o.getReadOnlyWalletData(),m=a.getReadOnlySettingsData(),y=r.NETWORKS[S.networkType].TICKER;t.pageTitle="RECEIVE",e.isLoading=!0,e.address=null,e.path=null,e.bitcoinUri=null,e.qrcode=null,e.newRequest={address:null,path:null,btcValue:"",fiatValue:0,message:null,bitcoinUri:""},e.qrSettings={correctionLevel:7,SIZE:225,inputMode:"M",image:!0},e.swapInputs=function(){e.fiatFirst=!e.fiatFirst},e.currencies=null,e.currencyType=null,e.altCurrency={},e.updateCurrentType=u,e.setAltCurrency=d,e.$on("enabled_currency",function(){u(e.currencyType)}),e.$on("$destroy",h),s()}e.$inject=["$scope","$rootScope","$q","CONFIG","activeWallet","settingsService","CurrencyConverter","Currencies","trackingService"],angular.module("blocktrail.wallet").controller("ReceiveCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d,p,f,g,h,_,S,m){function y(){b(P),p.all([f.getAccountInfo(),T()]).then(function(t){var n=t[0],r=t[1][blocktrailSDK.Wallet.FEE_STRATEGY_MIN_RELAY_FEE];e.requires2FA=n.requires2FA,e.prioboost.credits=r.prioboost_remaining,e.prioboost.discountP=100*(1-r.fees.min_relay_fee/r.fees.optimal),e.isLoading=!1})}function w(){if("bitcoin"===_.protocol||"bitcoincash"===_.protocol)u(function(){return"bitcoin"===_.protocol&&"BCC"===N.networkType?E("BTC",N.identifier):"bitcoincash"===_.protocol&&"BTC"===N.networkType?E("BCC",N.identifier):void v(_.address,_.amount)});else if(null!==_.protocol)throw new Error("Unknown protocol type for payment URL")}function E(n,r){return e.isLoading=!0,S.setActiveWalletByNetworkTypeAndIdentifier(n,r).then(function(){t.reload(),e.isLoading=!1})}function v(t,n){t&&s.validateAddress(t).then(function(t){t&&(e.sendInput.recipientAddress=t)}),n&&(n=parseFloat(_.amount),n&&(e.sendInput.amount=n),A())}function b(t){e.currencies=c.getCurrencies(),e.currencies=e.currencies.filter(function(e){return e.isFiat||e.code===P}),e.currencies=e.currencies.filter(function(e){return e.code!==t}),e.currencyType=t,A()}function A(){e.currencyType===P?(e.altCurrency.code=e.settings.localCurrency,e.altCurrency.amount=parseFloat(l.fromBTC(e.sendInput.amount,e.settings.localCurrency,2))||0):(e.altCurrency.code=P,e.altCurrency.amount=parseFloat(l.toBTC(e.sendInput.amount,e.currencyType,6))||0)}function T(){return null!==B?p.when(B):null!==U?U:U=p.all([s.getSdkWallet().maxSpendable(e.useZeroConf,blocktrailSDK.Wallet.FEE_STRATEGY_OPTIMAL),s.getSdkWallet().maxSpendable(e.useZeroConf,blocktrailSDK.Wallet.FEE_STRATEGY_LOW_PRIORITY),s.getSdkWallet().maxSpendable(e.useZeroConf,blocktrailSDK.Wallet.FEE_STRATEGY_MIN_RELAY_FEE)]).then(function(e){return B={},B[blocktrailSDK.Wallet.FEE_STRATEGY_OPTIMAL]=e[0],B[blocktrailSDK.Wallet.FEE_STRATEGY_LOW_PRIORITY]=e[1],B[blocktrailSDK.Wallet.FEE_STRATEGY_MIN_RELAY_FEE]=e[2],U=null,B})}function k(){e.fees.lowPriority=null,e.fees.optimal=null,e.fees.minRelayFee=null,e.displayFee=!1,e.prioboost.possible=null,e.prioboost.estSize=null,e.prioboost.zeroConf=null;var t={},n=0;if(n=e.currencyType===P?e.sendInput.amount:e.altCurrency.amount,n=parseInt(l.toSatoshi(n,"BTC")),n<=0)return p.reject(new Error("Amount needs to be > 0"));if(e.sendInput.recipientAddress)t[e.sendInput.recipientAddress]=n;else{var r=i.script.scriptHash.output.encode(new blocktrailSDK.Buffer("0000000000000000000000000000000000000000","hex")),a=i.address.fromOutputScript(r,s.getSdkWallet().sdk.network);t[a.toString()]=n}return p.all([s.getSdkWallet().coinSelection(t,!1,e.useZeroConf,blocktrailSDK.Wallet.FEE_STRATEGY_LOW_PRIORITY).spread(function(e,t,n,r){return o.debug("lowPriority fee: "+t),t})["catch"](function(e){if(e instanceof blocktrail.WalletFeeError||e instanceof Error&&"Wallet balance too low"===e.message)return T().then(function(e){var t=e[blocktrailSDK.Wallet.FEE_STRATEGY_LOW_PRIORITY].fee;return o.debug("lowPriority fee MAXSPENDABLE: "+t),t});throw e}),s.getSdkWallet().coinSelection(t,!1,e.useZeroConf,blocktrailSDK.Wallet.FEE_STRATEGY_OPTIMAL).spread(function(e,t,n,r){return o.debug("optimal fee: "+t),t})["catch"](function(e){if(e instanceof blocktrail.WalletFeeError||e instanceof Error&&"Wallet balance too low"===e.message)return T().then(function(e){var t=e[blocktrailSDK.Wallet.FEE_STRATEGY_OPTIMAL].fee;return o.debug("optiomal fee MAXSPENDABLE: "+t),t});throw e}),s.getSdkWallet().coinSelection(t,!1,e.useZeroConf,blocktrailSDK.Wallet.FEE_STRATEGY_MIN_RELAY_FEE).spread(function(t,n,r,a){return o.debug("minRelayFee fee: "+n),e.prioboost.estSize=a.size,e.prioboost.credits=a.prioboost_remaining,e.prioboost.zeroConf=a.zeroconf,e.prioboost.tooLarge=e.prioboost.estSize>e.PRIOBOOST_MAX_SIZE,e.prioboost.possible=!e.prioboost.zeroConf&&!e.prioboost.tooLarge&&e.prioboost.credits>0,n})["catch"](function(e){if(e instanceof blocktrail.WalletFeeError||e instanceof Error&&"Wallet balance too low"===e.message)return T().then(function(e){var t=e[blocktrailSDK.Wallet.FEE_STRATEGY_MIN_RELAY_FEE].fee;return o.debug("minRelayFee fee MAXSPENDABLE: "+t),t});throw e})]).then(function(t){var n=t[0],r=t[1],o=t[2];return e.fees.lowPriority=n,e.fees.optimal=r,e.fees.minRelayFee=o,e.displayFee=!0,I()},function(e){o.debug("fetchFee ERR "+e)})}function I(){if(e.sendInput.feeChoice===e.OPTIMAL_FEE)e.fee=e.fees.optimal;else if(e.sendInput.feeChoice===e.LOW_PRIORITY_FEE)e.fee=e.fees.lowPriority;else{if(e.sendInput.feeChoice!==e.PRIOBOOST)throw new Error("Invalid");e.fee=e.fees.minRelayFee}}function C(){return e.isLoading=!0,e.fetchFee().then(R).then(function(t){e.isLoading=!1,a.open({controller:"SendConfirmModalCtrl",templateUrl:"js/modules/wallet/controllers/send-confirm-modal/send-confirm-modal.tpl.html",size:"md",backdrop:"static",resolve:{activeWallet:function(){return s},sendData:function(){return{feeChoice:e.sendInput.feeChoice,recipientAddress:e.sendInput.recipientAddress,amount:t,requires2FA:e.requires2FA}}}})},function(){e.isLoading=!1})}function R(){var t=0,n=!0;if(D(),e.sendInput.feeChoice===e.PRIOBOOST&&e.prioboost.possible===!1){var o=e.prioboost.credits<=0?r.instant("PRIOBOOST_NO_CREDITS"):e.prioboost.tooLarge?r.instant("PRIOBOOST_TOO_LARGE"):r.instant("PRIOBOOST_ZERO_CONF"),a=r.instant("PRIOBOOST_NOT_POSSIBLE");d.alert({body:o,title:a}),n=!1}return e.sendInput.amount&&e.sendInput.amount.toString().match("^[0-9]*(?:.[0-9]{0,8})?$")||(e.errors.amount="MSG_INVALID_AMOUNT",n=!1),"0.00000000"===parseFloat(e.sendInput.amount).toFixed(8)&&(e.errors.amount="MSG_INVALID_AMOUNT",n=!1),t=e.currencyType===P?e.sendInput.amount:e.altCurrency.amount,parseInt(l.toSatoshi(t,"BTC"))>=e.walletData.balance+e.walletData.uncBalance&&(e.errors.amount="MSG_INSUFFICIENT_FUNDS",n=!1),e.sendInput.recipientAddress||(e.errors.recipient="MSG_MISSING_RECIPIENT",n=!1),n?s.validateAddress(e.sendInput.recipientAddress).then(function(){return t})["catch"](function(){return e.errors.recipient="MSG_INVALID_RECIPIENT",p.reject()}):p.reject()}function D(){e.errors.amount=!1,e.errors.recipient=!1}function O(t){e.errors[t]=!1}var N=s.getReadOnlyWalletData(),L=h.getReadOnlySettingsData(),P=g.NETWORKS[N.networkType].TICKER,B=null,U=null;n.pageTitle="SEND",e.isLoading=!0,e.settings=L,e.OPTIMAL_FEE="optimal",e.LOW_PRIORITY_FEE="low_priority",e.PRIOBOOST="prioboost",e.PRIOBOOST_MAX_SIZE=1300,e.prioboost={discountP:null,credits:2,possible:null,estSize:null,tooLarge:!1,zeroConf:!1},e.sendInput={recipientAddress:"",referenceMessage:"",pin:null,amount:"",feeChoice:e.OPTIMAL_FEE},e.fees={optimal:null,lowPriority:null,minRelayFee:null},e.errors={amount:!1,recipient:!1},e.complete=!1,e.displayFee=!1,e.useZeroConf=!0,e.requires2FA=null,e.currencies=null,e.currencyType=null,e.altCurrency={},e.$on("enabled_currency",function(){b(e.currencyType)}),e.updateCurrentType=b,e.setAltCurrency=A,e.fetchFee=k,e.resetError=O,e.onSubmitFormSend=C,y(),w(),m.checkAndPromptBitcoinURIHandler()}e.$inject=["$scope","$state","$rootScope","$translate","$log","$modal","bitcoinJS","CurrencyConverter","Currencies","activeWallet","$timeout","dialogService","$q","launchService","CONFIG","settingsService","$stateParams","walletsManagerService","NotificationsService"],angular.module("blocktrail.wallet").controller("SendCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d){e.sendData=l,e.walletData=d.getReadOnlyWalletData(),e.complete=!1,e.working=!1,e.error=null,e.detailedError=null,e.form={password:null,two_factor_token:null},e.pay={},e.pay[e.sendData.recipientAddress]=parseInt(i.toSatoshi(e.sendData.amount,"BTC")),e.feeStrategy="prioboost"===e.sendData.feeChoice?blocktrailSDK.Wallet.FEE_STRATEGY_MIN_RELAY_FEE:e.sendData.feeChoice,e.useZeroConf=!0,e.passwordCapsLockOn=!1,e.dismiss=function(){e.error=null,t.dismiss()},e.submit=function(n){e.complete?(t.dismiss(),a.go("app.wallet.summary")):e.confirmSend(n)},d._sdkWallet.coinSelection(e.pay,!1,e.useZeroConf,e.feeStrategy).spread(function(t,n,r,o){e.$apply(function(){e.fee=n})})["catch"](function(t){n.debug(t),e.fee=!1}),e.confirmSend=function(t){if(!e.working){if(c.setAllDirty(t),t.$invalid)return!1;e.error=null,e.detailedError=null,e.working=!0,e.progressWidth=5,e.progressTimeout=o(function(){return e.progressWidth>=90?void(e.progressWidth=100):void(e.progressWidth+=20)},500),r.when(d.unlockWithPassword(e.form.password)).then(function(t){return n.info("wallet: unlocked"),n.info("wallet: paying",e.pay),s.eventTrack("pre-pay",{category:"Events"}),r.when(t.pay(e.pay,!1,e.useZeroConf,!0,e.feeStrategy,e.form.two_factor_token,{prioboost:"prioboost"===e.sendData.feeChoice})).then(function(e){return t.lock(),r.when(e)},function(e){return t.lock(),r.reject(e)})}).then(function(t){s.eventTrack("pay",{category:"Events"}),e.form.password=null,n.info("wallet: paid",t),e.error=null,e.detailedError=null,e.complete=!0,e.working=!1,e.txHash=t,d.forcePolling()})["catch"](function(r){e.error=null,e.detailedError=null,e.working=!1,o.cancel(e.progressTimeout),r instanceof blocktrail.ContactAddressError?e.error="MSG_BAD_CONTACT":r instanceof blocktrail.WalletPinError||r instanceof blocktrail.WalletChecksumError||r instanceof blocktrail.WalletDecryptError?c.setValidityOnce(t.password,"invalid"):r instanceof blocktrail.WalletMissing2FAError?(e.sendData.requires2FA||(e.sendData.requires2FA=!0,u.updateAccountInfo({requires2FA:!0})),c.setValidityOnce(t.two_factor_token,"required")):r instanceof blocktrail.WalletInvalid2FAError?c.setValidityOnce(t.two_factor_token,"invalid"):r instanceof blocktrail.WalletFeeError?e.error="MSG_LOW_BALANCE_FOR_FEE":(n.error(r),e.error="MSG_SEND_FAIL_UNKNOWN",e.detailedError=(""+r).replace(/^Error: /,""))})}}}e.$inject=["$scope","$modalInstance","$log","$q","$timeout","$state","CurrencyConverter","sendData","FormHelper","$analytics","launchService","activeWallet"],angular.module("blocktrail.wallet").controller("SendConfirmModalCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d,p,f,g,h,_){function S(t){e.currencies=t.currencies,e.languages=h.getLanguages(),e.formSettings=angular.copy(t.settings),e.isEnabled2faToggle=t.isEnabled2faToggle,G=t.isEnabled2faToggle,W=angular.copy(t.settings),B=e.$watch("formSettings",T,!0),U=e.$watch("isEnabled2faToggle",R),e.isLoading=!1}function m(t,n){t.preventDefault(),n!==e.formSettings.localCurrency&&(e.formSettings.localCurrency=n)}function y(t,n){t.preventDefault(),n!==e.formSettings.language&&(e.formSettings.language=n)}function w(e,t){"profileIcon"===e&&I(t)}function E(t){e.errors[t]&&(e.errors[t]=!1)}function v(){var t=/^[a-zA-Z0-9.!#$%&’*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,n=/(^[a-zA-Z\d]+$)|(^$)/;if(k(),t.test(e.formSettings.email)||(e.errors.email=!0,O()),e.formSettings.username.length&&(e.formSettings.username.length<4||!n.test(e.formSettings.username))&&(e.errors.name=!0,D()),!e.errors.email&&!e.errors.name){var r={};e.isLoading=!0,angular.forEach(e.formSettings,function(e,t){W[t]!==e&&(r[t]=e)}),angular.isDefined(r.receiveNewsletter)&&(r.receiveNewsletter=r.receiveNewsletter?1:0),h.saveData(r).then(b,A)}}function b(){e.isLoading=!1,e.isSubmitFormSettingsBtnDisabled=!0,e.formSettings.language!==W.language&&n.changeLanguage(e.formSettings.language),W=angular.copy(e.formSettings)}function A(t){e.isLoading=!1,p.alert({title:c.instant("SETTINGS"),body:t.message||t})}function T(){e.isSubmitFormSettingsBtnDisabled=angular.equals(W,e.formSettings)}function k(){e.errors.email=!1,e.errors.name=!1}function I(e){var t=g.open({controller:"ModalCropImageCtrl",templateUrl:"js/modules/wallet/controllers/modal-crop-image/modal-crop-image.tpl.html",windowClass:"modal-max-height",size:"lg",backdrop:"static",resolve:{imgData:function(){return e}}});t.result.then(C)}function C(t){e.formSettings.profilePic=t}function R(e,t){e!=t&&e!=G&&(e?N():L())}function D(){return p.alert(c.instant("ERROR_TITLE_2"),c.instant("MSG_INVALID_USERNAME")).result}function O(){return p.alert(c.instant("ERROR_TITLE_2"),c.instant("MSG_BAD_EMAIL")).result}function N(){var t;return r.when(null).then(function(){return p.prompt({title:c.instant("SETTINGS_2FA"),subtitle:c.instant("SETTINGS_2FA_STEP1"),body:c.instant("SETTINGS_2FA_STEP1_BODY"),label:c.instant("SETTINGS_2FA_PASSWORD"),input_type:"password",ok:c.instant("CONTINUE")}).result.then(function(n){return t=p.alert({title:c.instant("SETTINGS_2FA"),body:c.instant("PLEASE_WAIT"),body_class:"text-center",showSpinner:!0,ok:!1}),h.sdkSetup2FA(n).then(function(n){return t.dismiss(),p.alert({title:c.instant("SETTINGS_2FA"),subtitle:c.instant("SETTINGS_2FA_STEP2"),bodyHtml:d.trustAsHtml(c.instant("SETTINGS_2FA_STEP2_BODY")),bodyExtra:c.instant("SETINGS_2FA_STEP2_CODE",{secret:n.secret}),ok:c.instant("CONTINUE"),cancel:c.instant("CANCEL"),qr:{correctionLevel:7,SIZE:225,inputMode:"M",image:!0,text:n.otp_uri}}).result.then(function(){return p.prompt({title:c.instant("SETTINGS_2FA"),subtitle:c.instant("SETTINGS_2FA_STEP3"),body:c.instant("SETTINGS_2FA_STEP3_BODY"),label:c.instant("TWO_FACTOR_TOKEN"),ok:c.instant("SETTINGS_2FA_VERIFY_TOKEN")}).result.then(function(n){return t=p.alert({title:c.instant("SETTINGS_2FA"),body:c.instant("PLEASE_WAIT"),body_class:"text-center",showSpinner:!0,ok:!1}),h.sdkEnable2FA(n).then(function(){return t.update({title:c.instant("SETTINGS_2FA"),body:c.instant("SETTINGS_2FA_DONE"),body_class:"text-center",ok:!1}),h.updateLaunchService2FA(e.isEnabled2faToggle).then(function(){G=e.isEnabled2faToggle,s(function(){t.dismiss()},1e3)})},function(n){e.isEnabled2faToggle=G,t&&t.dismiss(),p.alert({title:c.instant("SETTINGS_2FA"),body:n.message||n})})})},function(){e.isEnabled2faToggle=G})},function(n){e.isEnabled2faToggle=G,t&&t.dismiss(),p.alert({title:c.instant("SETTINGS_2FA"),body:n.message||n})})},function(){e.isEnabled2faToggle=G})})}function L(){var t;return r.when(null).then(function(){return p.prompt({title:c.instant("SETTINGS_2FA"),subtitle:c.instant("SETTINGS_2FA_DISABLE_2FA"),body:c.instant("SETTINGS_2FA_DISABLE_BODY"),label:c.instant("TWO_FACTOR_TOKEN"),ok:c.instant("SETTINGS_2FA_DISABLE_2FA")}).result.then(function(n){return t=p.alert({title:c.instant("SETTINGS_2FA"),body:c.instant("PLEASE_WAIT"),body_class:"text-center",showSpinner:!0,ok:!1}),h.sdkDisable2FA(n).then(function(){return t.update({title:c.instant("SETTINGS_2FA"),body:c.instant("SETTINGS_2FA_DISABLE_DONE"),body_class:"text-center",ok:!1}),h.updateLaunchService2FA(e.isEnabled2faToggle).then(function(){G=e.isEnabled2faToggle,s(function(){t.dismiss()},1500)})},function(n){e.isEnabled2faToggle=G,t&&t.dismiss(),p.alert({title:c.instant("SETTINGS_2FA"),body:n.message||n})})},function(){e.isEnabled2faToggle=G})})}function P(){i.getAccountInfo().then(function(n){if(l._sdkWallet.walletVersion===blocktrailSDK.Wallet.WALLET_VERSION_V1)throw new Error("You're using a beta wallet, can't upgrade! Contact the Blocktrail team!");return p.prompt({title:c.instant("CHANGE_PASSWORD"),body:c.instant("ENTER_CURRENT_PASSWORD"),input_type:"password",icon:"key"}).result.then(function(r){return e.alert(c.instant("CHANGE_PASSWORD"),c.instant("VERIFYING"),!1),t.post(f.API_URL+"/v1/BTC/mywallet/check",{login:n.email||n.username,password:o.SHA512(r).toString()}).then(function(t){var r=!!t.data.requires_2fa;return n.requires2FA!=r?i.updateAccountInfo({requires2FA:r}).then(function(t){return n=t,e.alert.dismiss(),!0}):(e.alert.dismiss(),!0)},function(e){throw e?new Error("MSG_BAD_LOGIN"):new Error("MSG_BAD_NETWORK")}).then(function(){return r})}).then(function(t){return p.prompt({title:c.instant("CHANGE_PASSWORD"),body:c.instant("ENTER_NEW_PASSWORD"),input_type:"password",icon:"key"}).result.then(function(e){return p.prompt({title:c.instant("CHANGE_PASSWORD"),body:c.instant("ENTER_REPEAT_PASSWORD"),input_type:"password",icon:"key"}).result.then(function(t){if(e!=t)throw new Error(c.instant("MSG_BAD_PASSWORD_REPEAT"));return e})}).then(function(s){return r.when(null).then(function(){return n.requires2FA?p.prompt({title:c.instant("CHANGE_PASSWORD"),body:c.instant("MSG_MISSING_TWO_FACTOR_TOKEN")}).result:null}).then(function(r){return e.alert(c.instant("CHANGE_PASSWORD"),c.instant("CHANGE_PASSWORD_WALLET_INPROGRESS"),!1),l.unlockWithPassword(t).then(function(l){return l.doPasswordChange(s).then(function(f){var g=f[0],h=f[1],_=n.secret?o.AES.encrypt(n.secret,s).toString():null,S=function(){return a.getSdkByActiveNetwork().passwordChange(o.SHA512(t).toString(),o.SHA512(s).toString(),_,r,[{identifier:l.identifier,encrypted_secret:g}]).then(function(){return l.encryptedSecret=g,l.lock(),i.storeBackupInfo({encryptedSecret:g}),e.alert({title:c.instant("CHANGE_PASSWORD"),bodyHtml:d.trustAsHtml(c.instant("CHANGE_PASSWORD_BACKUP")),ok:c.instant("BACKUP_CREATE_PDF")}).result.then(function(){var t=new blocktrailSDK.BackupGenerator(l.identifier,{encryptedSecret:h},{},{page1:!1,page2:!0,page3:!1});try{t.generatePDF(function(t,n){t?(u.error(t),e.alert({title:c.instant("ERROR"),body:""+t})):(n.save("BlockTrail Updated Recovery Data Sheet - "+l.identifier+".pdf"),i.clearBackupInfo())})}catch(n){u.error("Backup generation error",n)}})},function(e){if(l.lock(),e instanceof blocktrailSDK.WalletInvalid2FAError)return p.prompt({title:c.instant("CHANGE_PASSWORD"),body:c.instant("MSG_INVALID_TWO_FACTOR_TOKEN")}).result.then(function(e){return r=e,S()});throw e?new Error("MSG_BAD_LOGIN"):new Error("MSG_BAD_NETWORK")})};return S()})})})})})})["catch"](function(t){t&&t.message&&e.alert(c.instant("CHANGE_PASSWORD"),t.message)})}var B,U,W={username:"",email:"",localCurrency:"USD",language:"en",receiveNewsletter:!1,profilePic:null},G=!1;n.pageTitle="SETTINGS",e.network=l.getReadOnlyWalletData().networkType,e.alert=p.alertSingleton(),e.isLoading=!0,e.isSubmitFormSettingsBtnDisabled=!0,e.isEnabled2faToggle=!1,e.formSettings={username:"",email:"",localCurrency:"USD",language:"en",receiveNewsletter:!1,profilePic:"/"+f.STATICSURL+"/img/blank_profile.png"},e.errors={email:!1,name:!1},e.currencies=h.getCurrencies(),e.languages=h.getLanguages(),e.onChangeCurrency=m,e.onChangeLanguage=y,e.onFileDataUpdate=w,e.onResetError=E,e.onChangePassword=P,e.onSubmitFormSettings=v,h.fetchData().then(S),e.sweepCoins=function(){g.open({controller:"SweepCoinsModalController",templateUrl:"js/modules/wallet/controllers/sweep-coins-modal/sweep-coins-modal.tpl.html",size:"md"})},e.addProtocolHandler=function(){return _.promptBitcoinURIHandler().result.then(function(){try{u.debug("Trying to register bitcoin URI scheme"),navigator.registerProtocolHandler("bitcoin",f.WALLET_URL+"/#/wallet/handleURI/%s","BTC.com Bitcoin Wallet")}catch(e){if(u.error("Couldn't register bitcoin: URL scheme",e,e.message),"SecurityError"===e.name)return p.alert(c.instant("ERROR_TITLE_2"),c.instant("BROWSER_SECURITY_ERROR"),c.instant("OK")).result}})},e.$on("$destroy",function(){B&&B(),U&&U()})}e.$inject=["$scope","$http","$rootScope","$q","cryptoJS","sdkService","launchService","activeWallet","$translate","$timeout","$log","$sce","dialogService","CONFIG","$modal","formSettingsService","NotificationsService"],angular.module("blocktrail.wallet").controller("SettingsCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d){function p(){return n.all([n.when(t.getPrice()),n.when(g()),n.when(h())]).then(function(){e.isLoading=!1},function(e){console.log("err",e)})}function f(){e.showBCCSweepWarning=!1,c.updateSettingsUp({hideBCCSweepWarning:!0})}function g(){return n.when(l.getAccountInfo()).then(function(t){var n=86400;if(!t.requires2FA)return c.getSettings().then(function(t){var r=t.twoFactorWarningLastDisplayed;if(!r||r<(new Date).getTime()-1e3*n){var o={twoFactorWarningLastDisplayed:(new Date).getTime()};c.updateSettingsUp(o),e.isTwoFactorWarning=!0}})})}function h(){return c.getSettings().then(function(t){e.buybtcPendingOrders=[],t.glideraTransactions.forEach(function(t){if(!t.transactionHash&&"COMPLETE"!==t.status&&t.walletIdentifier===e.walletData.identifier){var n={qty:d.toSatoshi(t.qty,"BTC"),qtyBTC:t.qty,currency:t.currency,price:t.price,total:(t.price*t.qty).toFixed(2),time:t.time,avatarUrl:s.BROKERS.glidera.avatarUrl,displayName:s.BROKERS.glidera.displayName};e.buybtcPendingOrders.push(n)}}),e.buybtcPendingOrders.reverse()})}function _(){e.transactionsListLimit<e.walletData.transactions.length?e.transactionsListLimit=e.transactionsListLimit+v:!e.isLoading&&e.walletData.transactions.length&&e.transactionsListLimit>=e.walletData.transactions.length&&(e.isShowNoMoreTransactions=!0,A&&r.cancel(A),A=r(function(){A=null,e.isShowNoMoreTransactions=!1},T))}function S(e){var t=!1,n=new Date(1e3*e.time);return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),b!==n.valueOf()&&(b=n.valueOf(),t=!0),t}function m(){return b}function y(t){u.open({controller:"WalletTransactionInfoModalCtrl",templateUrl:"js/modules/wallet/controllers/wallet-transaction-info-modal/wallet-transaction-info-modal.tpl.html",resolve:{data:function(){return{walletData:e.walletData,transaction:angular.copy(t),localCurrency:E.localCurrency}}}})}function w(){A&&r.cancel(A)}var E=c.getReadOnlySettingsData(),v=15,b=0,A=null,T=2e3;t.pageTitle="TRANSACTIONS",e.walletData=o.getReadOnlyWalletData(),e.isLoading=!0,e.isShowNoMoreTransactions=!1,e.isTwoFactorWarning=!1,e.showBCCSweepWarning=!1,e.lastDateHeader=b,e.buybtcPendingOrders=[],e.transactionsListLimit=v,e.isHeader=S,e.getTransactionHeader=m,e.onShowTransaction=y,e.onShowMoreTransactions=_,e.dismissBCCSweepWarning=f,e.$on("$destroy",w),p(),"BCC"===e.walletData.networkType&&o.isReady.then(function(){e.showBCCSweepWarning=!e.walletData.transactions.length&&!e.settings.hideBCCSweepWarning})}e.$inject=["$scope","$rootScope","$q","$timeout","activeWallet","$log","CONFIG","launchService","settingsService","buyBTCService","$modal","CurrencyConverter"],angular.module("blocktrail.wallet").controller("WalletSummaryCtrl",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d){var p=o.getActiveWallet();e.walletData=p.getReadOnlyWalletData(),u.trackEvent(u.EVENTS.SWEEP.SWEEP_START),e.bip39EN=blocktrailSDK.bip39wordlist,e.working=!0,e.discovering=!1,e.STEPS={WELCOME:"WELCOME",WIF:"WIF",BIP44:"BIP44",SWEEP:"SWEEP",PUBLISH:"PUBLISH"},e.form={step:e.STEPS.WELCOME,mnemonic:null,inputWIF:null},e.sweepData=[{rawTx:null,txId:null,feePaid:null,inputCount:null,totalValue:null}],e.displaySweepData={totalValue:null,totalFeePaid:null};var f={batchSize:50,accountBatchSize:5,network:e.walletData.networkType,testnet:!1};"t"===f.network.substr(0,1)&&(f.network=f.network.substr(1),f.testnet=!0),p.getNewAddress().then(function(t){f.recipient=t,e.working=!1}),e.$watch("form.mnemonic",function(t,n){function r(e,t){return e<t?-1:e>t?1:0}if(e.form.mnemonic&&e.form.mnemonic.length>0&&(e.form.mnemonic=e.form.mnemonic.replace(/[\r\n]+/g," ").toLowerCase()),t&&n){var o=n.split(" ");1==t.split(" ").length&&o.length>1&&(delete o[o.length-1],r(n,t+" "+t[0])?e.form.mnemonic=o.join(" ")+t+" ":e.form.mnemonic=o.join(" ").slice(0,-1))}}),e.startSweeping=function(){e.form.step===e.STEPS.BIP44?e.startSweepingBIP44():e.startSweepingWIF()};var g=function(t){e.working=!1,e.discovering=!1,n.submitDebugInfo();var r=t.some(function(e){return!!e}),o=!t.every(function(e){return!!e});t.map(function(t){e.displaySweepData.totalValue+=t.totalValue,e.displaySweepData.totalFeePaid+=t.feePaid});var a=function(){return t&&t.length&&r?(u.trackEvent(u.EVENTS.SWEEP.SWEEP_BALANCE),e.sweepData=t,e.form.step=e.STEPS.SWEEP,void 0):(u.trackEvent(u.EVENTS.SWEEP.SWEEP_NO_BALANCE),i.alert(l.instant("IMPORT_ERROR"),l.instant("NO_BALANCES_FOUND")).result)};return t&&o?i.alert(l.instant("IMPORT_ERROR"),l.instant("SOME_TRANSACTIONS_FAILED")).result.then(function(){a()}):void a()};e.startSweepingBIP44=function(){e.working=!0,e.discovering=!0,n.bip44Sweep((e.form.mnemonic||"").trim().replace(/  +/g," "),f).then(function(e){g(e)})["catch"](function(t){return e.working=!1,e.discovering=!1,c.error(t),i.alert(l.instant("IMPORT_ERROR"),l.instant("INVALID_MNEMONIC")).result})},e.startSweepingWIF=function(){e.working=!0,e.discovering=!0;var t=(e.form.inputWIF||"").trim().replace(/  +/g," ").replace(/\r\n/g,",").replace(/\n/g,",").replace(/ /g,",");t=t.split(",").filter(function(e){return!!e.trim()}),n.wifSweep(t,f).then(function(e){g(e)})["catch"](function(t){return e.working=!1,e.discovering=!1,c.error(t),i.alert(l.instant("IMPORT_ERROR"),l.instant("INVALID_MNEMONIC")).result})},e.publishRawTransaction=function(){var t=p.getSdkWallet().sdk,n=e.sweepData.map(function(e){return t.sendRawTransaction(e.rawTx).then(function(t){return e.txId=t.hash,{status:!0,sweep:e,txId:t.hash}},function(t){return{status:!1,sweep:e,err:t}})});d.all(n).then(function(t){e.working=!1;var n=0;if(t.map(function(e){e.status||(n+=1)}),n){u.trackEvent(u.EVENTS.SWEEP.SWEEP_FAIL);var r="TX_CANT_BE_PUSHED";return n>1&&(r="TX_CANT_BE_PUSHED_MULTIPLE"),i.alert(l.instant("IMPORT_ERROR"),l.instant(r,{amount:n})).result}s(function(){e.form.step=e.STEPS.PUBLISH}),u.trackEvent(u.EVENTS.SWEEP.SWEEP_SUCCESS)})},e.done=function(){s(function(){$state.go("app.wallet.summary")}),t.close()},e.dismiss=function(){t.close()}}e.$inject=["$scope","$modalInstance","sweeperService","sdkService","walletsManagerService","CONFIG","dialogService","$translate","$log","$timeout","trackingService","$q"],
angular.module("blocktrail.wallet").controller("SweepCoinsModalController",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s,u,d,p,f,g,h,_,S,m,y,w){function E(t){var n=[];e.settings.showArchived||(t=t.filter(function(e){return!e.archived})),t.forEach(function(e){n.push({value:e.uniqueIdentifier,wallet:e})});var r=n.slice();return n.sort(function(t,n){return t.value===e.walletData.uniqueIdentifier?-1:n.value===e.walletData.uniqueIdentifier?1:r.indexOf(t)<r.indexOf(n)?-1:1}),n}if(e.settings=c.getReadOnlySettingsData(),e.walletData=a.getReadOnlyWalletData(),e.$watch("walletData.networkType",function(){w.init()}),e.sideNavList=[{stateHref:t.href("app.wallet.summary"),activeStateName:"app.wallet.summary",linkText:"MY_WALLET",linkIcon:"bticon-doc-text",isHidden:!1},{stateHref:t.href("app.wallet.send"),activeStateName:"app.wallet.send",linkText:"SEND",linkIcon:"bticon-forward-outline",isHidden:!1},{stateHref:t.href("app.wallet.receive"),activeStateName:"app.wallet.receive",linkText:"RECEIVE",linkIcon:"bticon-reply-outline",isHidden:!1},{stateHref:t.href("app.wallet.buybtc.choose"),activeStateName:"app.wallet.buybtc",linkText:"BUYBTC_NAVTITLE",linkIcon:"bticon-credit-card",isHidden:!l.NETWORKS[e.walletData.networkType].BUYBTC},{stateHref:t.href("app.wallet.settings"),activeStateName:"app.wallet.settings",linkText:"SETTINGS",linkIcon:"bticon-cog",isHidden:!1}],e.isLoadingNewWallet=!1,!e.settings.walletActivated)var v=r(function(){e.walletData.balance+e.walletData.uncBalance>0&&(c.updateSettingsUp({walletActivated:!0}),y.trackEvent(y.EVENTS.ACTIVATED),r.cancel(v))},6e4);e.debugMode=l.DEBUG,e.sdkActiveNetwork=i.getReadOnlySdkData().networkType,e.activeWalletUniqueIdentifier=e.walletData.uniqueIdentifier,e.walletsListOptions=E(o.getWalletsList()),e.onClickSetActiveWallet=function(n){n!==e.walletData.uniqueIdentifier&&(e.isLoadingNewWallet=!0,o.setActiveWalletByUniqueIdentifier(n).then(function(){e.isLoadingNewWallet=!1,t.reload()}))},s.getUserInfo().then(function(t){if(t.username||t.displayName||t.email){var n={username:t.username||e.settings.username,displayName:t.displayName||e.settings.displayName,email:t.email||e.settings.email};s.clearUserInfo(),c.updateSettingsUp(n)}},function(e){console.error("getUserInfo",e)}),e.$on("glidera_complete",function(e,t){f.alert({body:g.instant("MSG_BUYBTC_GLIDERA_COMPLETE_BODY",{qty:t.qty}),title:"MSG_BUYBTC_GLIDERA_COMPLETE"})}),n.fetchExtraLanguages=d.getWalletConfig().then(function(e){return c.getSettings().then(function(t){_.checkVersion(t.latestVersionWeb,e.versionInfo.web,_.CHECKS.LOGGEDIN),t.latestVersionWeb&&!semver.gt(l.VERSION,t.latestVersionWeb)||u(function(){var e={latestVersionWeb:l.VERSION};c.updateSettingsUp(e)},500)}),e.currencies&&e.currencies.forEach(function(e){h.enableCurrency(e)}),e.extraLanguages.concat(l.EXTRA_LANGUAGES).unique()}).then(function(e){return c.getSettings().then(function(t){var r=(t.knownLanguages||[]).slice();e.forEach(function(e){p.enableLanguage(e)});var o=e.filter(function(e){return r.indexOf(e)===-1});if(o.length){var a={extraLanguages:p.getLanguages(),knownLanguages:p.getLanguages()};return c.updateSettingsUp(a).then(function(e){var t=p.preferredAvailableLanguage();if(t&&e.language&&t!==e.language&&o.indexOf(t)!==-1)return f.prompt({body:g.instant("MSG_BETTER_LANGUAGE",{oldLanguage:g.instant(p.languageName(e.language)),newLanguage:g.instant(p.languageName(t))}),title:g.instant("MSG_BETTER_LANGUAGE_TITLE"),prompt:!1}).result.then(function(){var e={language:t};return n.changeLanguage(t),c.updateSettingsUp(e)},function(e){if("dismiss"!==e)throw e})})}})}).then(function(){},function(e){console.error("extraLanguages",e&&(e.msg||e.message||""+e))}),n.getPrice=function(){return h.updatePrices(!1).then(function(e){n.bitcoinPrices=e})},n.syncContacts=function(){S.list()["catch"](function(e){$log.error(e)})},u(function(){n.syncContacts()},500),u(function(){n.getPrice()},1e3),u(function(){c.syncSettingsDown()},302e3)}e.$inject=["$scope","$state","$rootScope","$interval","walletsManagerService","activeWallet","sdkService","CONFIG","settingsService","setupService","$timeout","launchService","blocktrailLocalisation","dialogService","$translate","Currencies","AppVersionService","Contacts","$filter","trackingService","glideraService"],angular.module("blocktrail.wallet").controller("WalletCtrl",e)}(),function(){"use strict";function e(e,t,n){e.walletData=n.walletData,e.transaction=n.transaction,e.localCurrency=n.localCurrency,e.dismiss=function(){t.dismiss()}}e.$inject=["$scope","$modalInstance","data"],angular.module("blocktrail.wallet").controller("WalletTransactionInfoModalCtrl",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,templateUrl:"js/modules/wallet/directives/app-bcc-sweep-warning/app-bcc-sweep-warning.tpl.html"}}angular.module("blocktrail.wallet").directive("appBccSweepWarning",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{pageTitle:"=",walletData:"=",bitcoinPrices:"=",settings:"="},templateUrl:"js/modules/wallet/directives/app-header/app-header.tpl.html"}}angular.module("blocktrail.wallet").directive("appHeader",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{},templateUrl:"js/modules/wallet/directives/app-two-factor-warning/app-two-factor-warning.tpl.html"}}angular.module("blocktrail.wallet").directive("appTwoFactorWarning",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{},templateUrl:"js/modules/wallet/directives/wallet-no-more-transactions/wallet-no-more-transactions.tpl.html"}}angular.module("blocktrail.wallet").directive("walletNoMoreTransactions",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{language:"="},templateUrl:"js/modules/wallet/directives/wallet-app-store-buttons/wallet-app-store-buttons.tpl.html"}}angular.module("blocktrail.wallet").directive("walletAppStoreButtons",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{},templateUrl:"js/modules/wallet/directives/wallet-no-transactions/wallet-no-transactions.tpl.html"}}angular.module("blocktrail.wallet").directive("walletNoTransactions",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{transaction:"=",walletData:"=",onShowTransaction:"&"},templateUrl:"js/modules/wallet/directives/wallet-transaction/wallet-transaction.tpl.html",controller:t}}function t(e){e.isReceived=e.transaction.wallet_value_change>0}t.$inject=["$scope"],angular.module("blocktrail.wallet").directive("walletTransaction",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{list:"="},templateUrl:"js/modules/wallet/directives/wallet-side-nav/wallet-side-nav.tpl.html"}}angular.module("blocktrail.wallet").directive("walletSideNav",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{transaction:"="},templateUrl:"js/modules/wallet/directives/wallet-transaction-avatar/wallet-transaction-avatar.tpl.html",controller:t}}function t(e,t,n){e.contactInitials="",e.isReceived=e.transaction.wallet_value_change>0,e.avatarUrl=t.STATICSURL+"/img/blank_profile.png",e.isAnonymous=!0;var r="";if(!e.transaction.contact&&e.transaction.buybtc){var o=n.BROKERS[e.transaction.buybtc.broker];r=o.displayName,e.avatarUrl=o.avatarUrl,e.isAnonymous=!1}if(e.transaction.contact){var a=e.transaction.contact.firstName,i=e.transaction.contact.lastName;!i&&a?e.contactInitials=a.substr(0,2):!a&&i?e.contactInitials=i.substr(0,2):a&&i?e.contactInitials=a.substr(0,1)+i.substr(0,1):r?e.contactInitials=r.substr(0,2):e.transaction.contact.displayName&&(e.contactInitials=e.transaction.contact.displayName.substr(0,1)),e.avatarUrl="data:image/jpeg;base64,"+e.transaction.contact.avatarUrl,e.isAnonymous=!1}}t.$inject=["$scope","CONFIG","buyBTCService"],angular.module("blocktrail.wallet").directive("walletTransactionAvatar",e)}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{transaction:"="},templateUrl:"js/modules/wallet/directives/wallet-transaction-description/wallet-transaction-description.tpl.html",controller:t}}function t(e,t){if(e.isReceived=e.transaction.wallet_value_change>0,e.altDisplay="",e.displayName="",!e.transaction.contact&&e.transaction.buybtc){var n=t.BROKERS[e.transaction.buybtc.broker];e.displayName=n.displayName}else e.transaction.contact&&(e.displayName=e.transaction.contact.displayName);e.transaction.wallet_value_change>0?e.altDisplay="TX_INFO_RECEIVED":e.transaction.is_internal?e.altDisplay="INTERNAL_TRANSACTION_TITLE":e.altDisplay="TX_INFO_SENT"}t.$inject=["$scope","buyBTCService"],angular.module("blocktrail.wallet").directive("walletTransactionDescription",e)}(),function(){"use strict";function e(e,t,n,r,o,a,i,l,c,s){var u=this;u._$rootScope=e,u._$q=t,u._$http=n,u._$translate=r,u._sdkService=o,u._cryptoJS=a,u._launchService=i,u._settingsService=l,u._currencyService=c,u._blocktrailLocalisationService=s}angular.module("blocktrail.core").factory("formSettingsService",["$rootScope","$q","$http","$translate","sdkService","cryptoJS","launchService","settingsService","Currencies","blocktrailLocalisation",function(t,n,r,o,a,i,l,c,s,u){return new e(t,n,r,o,a,i,l,c,s,u)}]),e.prototype.fetchData=function(){var e=this,t=e._settingsService.getSettings(),n=e._launchService.getAccountInfo(),r=e._$rootScope.fetchExtraLanguages;return e._$q.all([t,n,r]).then(function(t){var n=t[0];return{settings:{username:n.username||"",email:n.email,localCurrency:n.localCurrency,language:e._$translate.use(),receiveNewsletter:n.receiveNewsletter,profilePic:n.profilePic},isEnabled2faToggle:t[1].requires2FA||!1,currencies:e.getCurrencies(),languages:e.getLanguages()}})},e.prototype.saveData=function(e){var t=this;return t._settingsService.updateSettingsUp(e)},e.prototype.getCurrencies=function(){var e=this;return e._currencyService.getFiatCurrencies()},e.prototype.getLanguages=function(){var e=this;return e._blocktrailLocalisationService.getLanguages().map(function(t){var n=e._blocktrailLocalisationService.languageName(t);return n?{code:t,name:n}:null}).clean()},e.prototype.sdkSetup2FA=function(e){var t=this;return t._$q.when(t._getSdk()).then(function(n){return n.setup2FA(t._cryptoJS.SHA512(e).toString())})},e.prototype.sdkEnable2FA=function(e){var t=this;return t._$q.when(t._getSdk()).then(function(t){return t.enable2FA(e)})},e.prototype.sdkDisable2FA=function(e){var t=this;return t._$q.when(t._getSdk()).then(function(t){return t.disable2FA(e)})},e.prototype.updateLaunchService2FA=function(e){var t=this;return t._$q.when(t._getAccountInfo()).then(function(n){return n.requires2FA=e,t._launchService.storeAccountInfo(n)})},e.prototype._getSdk=function(){var e=this;return e._sdkService.getSdkByActiveNetwork()},e.prototype._getAccountInfo=function(){var e=this;return e._launchService.getAccountInfo()}}();
//# sourceMappingURL=app.js.map
